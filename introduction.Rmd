# Introduction

## Prerequisites

```{r}
library("tidyverse")
```
We also load the **haven** package to load Stata `dta` files,
```{r}
library("haven")
```
and the **rio** package to load multiple types of files.
```{r}
library("rio")
```
We also create a helper function for loading in the data.
```{r}
qss_data_url <- function(chapter, file) {
  # ensure chapter name is uppercase regardless of user-input
  chapter_name <- stringr::str_to_upper(chapter)
  # add chapter and file names to the base URL to get the full URL to the file
  stringr::str_c("https://raw.githubusercontent.com/kosukeimai/qss/master/",
                 chapter_name, "/", file)
}
# e.g. see what this returns
# qss_data_url("intro", "Kenya.csv")
# > "https://raw.githubusercontent.com/kosukeimai/qss/master/INTRO/Kenya.csv"
```


## Introduction to R

### Data Files

Don't use `setwd()` within scripts.
It is much better to organize your code in projects.

When reading from csv files use `readr::read_csv` instead of the base R function `read.csv`. 
It is slightly faster, and returns a `tibble` instead of a data frame.
See `r R4DS` [Ch 11: Data Import](http://r4ds.had.co.nz/tibbles.html#introduction-4)
for more dicussion.

We also can load it directly from a URL.
```{r}
UNpop <- read_csv(qss_data_url("INTRO", "UNpop.csv"))
class(UNpop)
UNpop
```

The single bracket, `[`, is useful to select rows and columns in simple cases,
but the **dplyr** functions `slice()` to select rows by number, `filter` to select by certain criteria, or `select()` to select columns.

```{r}
UNpop[c(1, 2, 3), ]
```
is equivalent to 
```{r}
UNpop %>% slice(1:3)
```

```{r}
UNpop[, "world.pop"]
```
is almost equivalent to 
```{r}
select(UNpop, world.pop)
```
However, note that `select()` **always** returns a tibble, and never a vector, 
even if only one column is selected.
Also, note that since `world.pop` is a tibble, using `[` also returns tibbles 
rather than a vector if it is only one column.

```{r}
UNpop[1:3, "year"]
```
is almost equivalent to 
```{r}
UNpop %>%
  slice(1:3) %>%
  select(year)
```
For this example using these functions and `%>%` to chain them together may 
seem a little excessive, but later we will see how chaining simple functions 
together like that becomes a very powerful way to build up complicated logic.


```{r}
UNpop$world.pop[seq(from = 1, to = nrow(UNpop), by = 2)]
```
can be rewritten as
```{r}
UNpop %>%
  slice(seq(1, n(), by = 2)) %>%
  select(world.pop) 
```

The function `n()` when used in a **dplyr** function returns the number of rows
in the data frame (or the number of rows in the group if used with `group_by`).

### Saving Objects

**Do not save** the work space using `save.image`.
This is an extremely bad idea for reproducibility.
See `r R4DS` chapter [Workflow Projects](http://r4ds.had.co.nz/workflow-projects.html). 
You should uncheck the options in RStudio to avoid saving and restoring from `.RData` files. 
This will help ensure that your R code runs the way you think it does, instead of depending on some long forgotten code that is only saved in the workspace image. 

Everything important should be in a script. Anything saved or loaded from file
should be done explicitly.

As with reading CSV files, use the **readr** package functions. 
In this case, `write_csv` writes a csv file

```{r eval=FALSE}
write_csv(UNpop, "UNpop.csv")
```

### Packages

Instead of **foreign** for reading and writing Stata and SPSS files, use **haven**. 
One reason to do so is that it is better maintained. 
The R function `read.dta` does not read files created by the most recent versions of Stata (13+).

```{r}
read_dta(qss_data_url("INTRO", "UNpop.dta"))
```

There is also the equivalent `write_dta` function to create Stata datasets.
```{r, eval=FALSE}
write_dta(UNpop, "UNpop.dta")
```

Also see the [rio](https://cran.r-project.org/package=rio) package which makes loading data even easier with smart defaults.

You can use the `import` function to load many types of files:
```{r}
import(qss_data_url("INTRO", "UNpop.csv"))
import(qss_data_url("INTRO", "UNpop.RData"))
import(qss_data_url("INTRO", "UNpop.dta"))
```

### Style Guide

Follow [Hadley Wickham's Style Guide](http://adv-r.had.co.nz/Style.html) not the Google R style guide.

In addition to `r pkg("lintr")` the R package `r pkg("formatR")` has methods to clean up your code.
