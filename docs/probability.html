<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Quantatitive Social Science: The R Tidyverse Code</title>
  <meta name="description" content="<p>This supplement for Kosuke Imai’s “Quantitative Social Science: An Introduction” contains Tidyverse R code versions of the code in the original text.</p>">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Quantatitive Social Science: The R Tidyverse Code" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://jrnold.github.io/qss-tidy" />
  
  <meta property="og:description" content="<p>This supplement for Kosuke Imai’s “Quantitative Social Science: An Introduction” contains Tidyverse R code versions of the code in the original text.</p>" />
  <meta name="github-repo" content="jrnold/qss-tidy" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Quantatitive Social Science: The R Tidyverse Code" />
  
  <meta name="twitter:description" content="<p>This supplement for Kosuke Imai’s “Quantitative Social Science: An Introduction” contains Tidyverse R code versions of the code in the original text.</p>" />
  

<meta name="author" content="Jeffrey B. Arnold">


<meta name="date" content="2018-06-12">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="discovery.html">
<link rel="next" href="uncertainty.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">QSS Tidyverse Code</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#colophon"><i class="fa fa-check"></i>Colophon</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#overview-of-the-book"><i class="fa fa-check"></i><b>1.1</b> Overview of the Book</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#how-to-use-the-book"><i class="fa fa-check"></i><b>1.2</b> How to use the Book</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#introduction-to-r"><i class="fa fa-check"></i><b>1.3</b> Introduction to R</a><ul>
<li class="chapter" data-level="1.3.1" data-path="introduction.html"><a href="introduction.html#arithmetic-operations"><i class="fa fa-check"></i><b>1.3.1</b> Arithmetic Operations</a></li>
<li class="chapter" data-level="1.3.2" data-path="introduction.html"><a href="introduction.html#objects"><i class="fa fa-check"></i><b>1.3.2</b> Objects</a></li>
<li class="chapter" data-level="1.3.3" data-path="introduction.html"><a href="introduction.html#vectors"><i class="fa fa-check"></i><b>1.3.3</b> Vectors</a></li>
<li class="chapter" data-level="1.3.4" data-path="introduction.html"><a href="introduction.html#functions"><i class="fa fa-check"></i><b>1.3.4</b> Functions</a></li>
<li class="chapter" data-level="1.3.5" data-path="introduction.html"><a href="introduction.html#data-files"><i class="fa fa-check"></i><b>1.3.5</b> Data Files</a></li>
<li class="chapter" data-level="1.3.6" data-path="introduction.html"><a href="introduction.html#saving-objects"><i class="fa fa-check"></i><b>1.3.6</b> Saving Objects</a></li>
<li class="chapter" data-level="1.3.7" data-path="introduction.html"><a href="introduction.html#programming-and-learning-tips"><i class="fa fa-check"></i><b>1.3.7</b> Programming and Learning Tips</a></li>
<li class="chapter" data-level="1.3.8" data-path="introduction.html"><a href="introduction.html#style-guide"><i class="fa fa-check"></i><b>1.3.8</b> Style Guide</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="causality.html"><a href="causality.html"><i class="fa fa-check"></i><b>2</b> Causality</a><ul>
<li class="chapter" data-level="" data-path="causality.html"><a href="causality.html#prerequisites-1"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="2.1" data-path="causality.html"><a href="causality.html#racial-discrimination-in-the-labor-market"><i class="fa fa-check"></i><b>2.1</b> Racial Discrimination in the Labor Market</a></li>
<li class="chapter" data-level="2.2" data-path="causality.html"><a href="causality.html#subsetting-data-in-r"><i class="fa fa-check"></i><b>2.2</b> Subsetting Data in R</a><ul>
<li class="chapter" data-level="2.2.1" data-path="causality.html"><a href="causality.html#subsetting"><i class="fa fa-check"></i><b>2.2.1</b> Subsetting</a></li>
<li class="chapter" data-level="2.2.2" data-path="causality.html"><a href="causality.html#simple-conditional-statements"><i class="fa fa-check"></i><b>2.2.2</b> Simple conditional statements</a></li>
<li class="chapter" data-level="2.2.3" data-path="causality.html"><a href="causality.html#factor-variables"><i class="fa fa-check"></i><b>2.2.3</b> Factor Variables</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="causality.html"><a href="causality.html#causal-affects-and-the-counterfactual"><i class="fa fa-check"></i><b>2.3</b> Causal Affects and the Counterfactual</a></li>
<li class="chapter" data-level="2.4" data-path="causality.html"><a href="causality.html#observational-studies"><i class="fa fa-check"></i><b>2.4</b> Observational Studies</a><ul>
<li class="chapter" data-level="2.4.1" data-path="causality.html"><a href="causality.html#confounding-bias"><i class="fa fa-check"></i><b>2.4.1</b> Confounding Bias</a></li>
<li class="chapter" data-level="2.4.2" data-path="causality.html"><a href="causality.html#before-and-after-and-difference-in-difference-designs"><i class="fa fa-check"></i><b>2.4.2</b> Before and After and Difference-in-Difference Designs</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="causality.html"><a href="causality.html#descriptive-statistics-for-a-single-variable"><i class="fa fa-check"></i><b>2.5</b> Descriptive Statistics for a Single Variable</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="measurement.html"><a href="measurement.html"><i class="fa fa-check"></i><b>3</b> Measurement</a><ul>
<li class="chapter" data-level="" data-path="measurement.html"><a href="measurement.html#prerequisites-2"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="3.1" data-path="measurement.html"><a href="measurement.html#measuring-civilian-victimization-during-wartime"><i class="fa fa-check"></i><b>3.1</b> Measuring Civilian Victimization during Wartime</a></li>
<li class="chapter" data-level="3.2" data-path="measurement.html"><a href="measurement.html#handling-missing-data-in-r"><i class="fa fa-check"></i><b>3.2</b> Handling Missing Data in R</a></li>
<li class="chapter" data-level="3.3" data-path="measurement.html"><a href="measurement.html#visualizing-the-univariate-distribution"><i class="fa fa-check"></i><b>3.3</b> Visualizing the Univariate Distribution</a><ul>
<li class="chapter" data-level="3.3.1" data-path="measurement.html"><a href="measurement.html#barplot"><i class="fa fa-check"></i><b>3.3.1</b> Barplot</a></li>
<li class="chapter" data-level="3.3.2" data-path="measurement.html"><a href="measurement.html#histogram"><i class="fa fa-check"></i><b>3.3.2</b> Histogram</a></li>
<li class="chapter" data-level="3.3.3" data-path="measurement.html"><a href="measurement.html#boxplot"><i class="fa fa-check"></i><b>3.3.3</b> Boxplot</a></li>
<li class="chapter" data-level="3.3.4" data-path="measurement.html"><a href="measurement.html#printing-and-saving-graphics"><i class="fa fa-check"></i><b>3.3.4</b> Printing and saving graphics</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="measurement.html"><a href="measurement.html#survey-sampling"><i class="fa fa-check"></i><b>3.4</b> Survey Sampling</a><ul>
<li class="chapter" data-level="3.4.1" data-path="measurement.html"><a href="measurement.html#the-role-of-randomization"><i class="fa fa-check"></i><b>3.4.1</b> The Role of Randomization</a></li>
<li class="chapter" data-level="3.4.2" data-path="measurement.html"><a href="measurement.html#non-response-and-other-sources-of-bias"><i class="fa fa-check"></i><b>3.4.2</b> Non-response and other sources of bias</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="measurement.html"><a href="measurement.html#measuring-political-polarization"><i class="fa fa-check"></i><b>3.5</b> Measuring Political Polarization</a><ul>
<li class="chapter" data-level="3.5.1" data-path="measurement.html"><a href="measurement.html#correlation"><i class="fa fa-check"></i><b>3.5.1</b> Correlation</a></li>
<li class="chapter" data-level="3.5.2" data-path="measurement.html"><a href="measurement.html#quantile-quantile-plot"><i class="fa fa-check"></i><b>3.5.2</b> Quantile-Quantile Plot</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="measurement.html"><a href="measurement.html#clustering"><i class="fa fa-check"></i><b>3.6</b> Clustering</a><ul>
<li class="chapter" data-level="3.6.1" data-path="measurement.html"><a href="measurement.html#matrices"><i class="fa fa-check"></i><b>3.6.1</b> Matrices</a></li>
<li class="chapter" data-level="3.6.2" data-path="measurement.html"><a href="measurement.html#lists"><i class="fa fa-check"></i><b>3.6.2</b> Lists</a></li>
<li class="chapter" data-level="3.6.3" data-path="measurement.html"><a href="measurement.html#k-means-algorithms"><i class="fa fa-check"></i><b>3.6.3</b> k-means algorithms</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="prediction.html"><a href="prediction.html"><i class="fa fa-check"></i><b>4</b> Prediction</a><ul>
<li class="chapter" data-level="" data-path="prediction.html"><a href="prediction.html#prerequisites-3"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="4.1" data-path="prediction.html"><a href="prediction.html#predicting-election-outcomes"><i class="fa fa-check"></i><b>4.1</b> Predicting Election Outcomes</a><ul>
<li class="chapter" data-level="4.1.1" data-path="prediction.html"><a href="prediction.html#loops-in-r"><i class="fa fa-check"></i><b>4.1.1</b> Loops in R</a></li>
<li class="chapter" data-level="4.1.2" data-path="prediction.html"><a href="prediction.html#general-conditional-statements-in-r"><i class="fa fa-check"></i><b>4.1.2</b> General Conditional Statements in R</a></li>
<li class="chapter" data-level="4.1.3" data-path="prediction.html"><a href="prediction.html#poll-predictions"><i class="fa fa-check"></i><b>4.1.3</b> Poll Predictions</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="prediction.html"><a href="prediction.html#linear-regression"><i class="fa fa-check"></i><b>4.2</b> Linear Regression</a><ul>
<li class="chapter" data-level="4.2.1" data-path="prediction.html"><a href="prediction.html#facial-appearance-and-election-outcomes"><i class="fa fa-check"></i><b>4.2.1</b> Facial Appearance and Election Outcomes</a></li>
<li class="chapter" data-level="4.2.2" data-path="prediction.html"><a href="prediction.html#correlation-and-scatter-plots"><i class="fa fa-check"></i><b>4.2.2</b> Correlation and Scatter Plots</a></li>
<li class="chapter" data-level="4.2.3" data-path="prediction.html"><a href="prediction.html#least-squares"><i class="fa fa-check"></i><b>4.2.3</b> Least Squares</a></li>
<li class="chapter" data-level="4.2.4" data-path="prediction.html"><a href="prediction.html#regression-towards-the-mean"><i class="fa fa-check"></i><b>4.2.4</b> Regression towards the mean</a></li>
<li class="chapter" data-level="4.2.5" data-path="prediction.html"><a href="prediction.html#merging-data-sets-in-r"><i class="fa fa-check"></i><b>4.2.5</b> Merging Data Sets in R</a></li>
<li class="chapter" data-level="4.2.6" data-path="prediction.html"><a href="prediction.html#model-fit"><i class="fa fa-check"></i><b>4.2.6</b> Model Fit</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="prediction.html"><a href="prediction.html#regression-and-causation"><i class="fa fa-check"></i><b>4.3</b> Regression and Causation</a><ul>
<li class="chapter" data-level="4.3.1" data-path="prediction.html"><a href="prediction.html#randomized-experiments"><i class="fa fa-check"></i><b>4.3.1</b> Randomized Experiments</a></li>
<li class="chapter" data-level="4.3.2" data-path="prediction.html"><a href="prediction.html#regression-with-multiple-predictors"><i class="fa fa-check"></i><b>4.3.2</b> Regression with multiple predictors</a></li>
<li class="chapter" data-level="4.3.3" data-path="prediction.html"><a href="prediction.html#heterogeneous-treatment-effects"><i class="fa fa-check"></i><b>4.3.3</b> Heterogeneous Treatment Effects</a></li>
<li class="chapter" data-level="4.3.4" data-path="prediction.html"><a href="prediction.html#regression-discontinuity-design"><i class="fa fa-check"></i><b>4.3.4</b> Regression Discontinuity Design</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="discovery.html"><a href="discovery.html"><i class="fa fa-check"></i><b>5</b> Discovery</a><ul>
<li class="chapter" data-level="5.1" data-path="discovery.html"><a href="discovery.html#textual-data"><i class="fa fa-check"></i><b>5.1</b> Textual data</a><ul>
<li class="chapter" data-level="" data-path="discovery.html"><a href="discovery.html#prerequisites-4"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="5.1.1" data-path="discovery.html"><a href="discovery.html#document-term-matrix"><i class="fa fa-check"></i><b>5.1.1</b> Document-Term Matrix</a></li>
<li class="chapter" data-level="5.1.2" data-path="discovery.html"><a href="discovery.html#topic-discovery"><i class="fa fa-check"></i><b>5.1.2</b> Topic Discovery</a></li>
<li class="chapter" data-level="5.1.3" data-path="discovery.html"><a href="discovery.html#authorship-prediction"><i class="fa fa-check"></i><b>5.1.3</b> Authorship Prediction</a></li>
<li class="chapter" data-level="5.1.4" data-path="discovery.html"><a href="discovery.html#cross-validation"><i class="fa fa-check"></i><b>5.1.4</b> Cross-Validation</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="discovery.html"><a href="discovery.html#network-data"><i class="fa fa-check"></i><b>5.2</b> Network data</a><ul>
<li class="chapter" data-level="" data-path="discovery.html"><a href="discovery.html#prerequisites-5"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="5.2.1" data-path="discovery.html"><a href="discovery.html#twitter-following-network"><i class="fa fa-check"></i><b>5.2.1</b> Twitter Following Network</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="discovery.html"><a href="discovery.html#spatial-data"><i class="fa fa-check"></i><b>5.3</b> Spatial Data</a><ul>
<li class="chapter" data-level="" data-path="discovery.html"><a href="discovery.html#prerequisites-6"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="5.3.1" data-path="discovery.html"><a href="discovery.html#spatial-data-in-r"><i class="fa fa-check"></i><b>5.3.1</b> Spatial Data in R</a></li>
<li class="chapter" data-level="5.3.2" data-path="discovery.html"><a href="discovery.html#colors-in-r"><i class="fa fa-check"></i><b>5.3.2</b> Colors in R</a></li>
<li class="chapter" data-level="5.3.3" data-path="discovery.html"><a href="discovery.html#united-states-presidential-elections"><i class="fa fa-check"></i><b>5.3.3</b> United States Presidential Elections</a></li>
<li class="chapter" data-level="5.3.4" data-path="discovery.html"><a href="discovery.html#expansion-of-walmart"><i class="fa fa-check"></i><b>5.3.4</b> Expansion of Walmart</a></li>
<li class="chapter" data-level="5.3.5" data-path="discovery.html"><a href="discovery.html#animation-in-r"><i class="fa fa-check"></i><b>5.3.5</b> Animation in R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="probability.html"><a href="probability.html"><i class="fa fa-check"></i><b>6</b> Probability</a><ul>
<li class="chapter" data-level="" data-path="probability.html"><a href="probability.html#prerequisites-7"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="6.1" data-path="probability.html"><a href="probability.html#probability-1"><i class="fa fa-check"></i><b>6.1</b> Probability</a><ul>
<li class="chapter" data-level="6.1.1" data-path="probability.html"><a href="probability.html#frequentist-vs.bayesian"><i class="fa fa-check"></i><b>6.1.1</b> Frequentist vs. Bayesian</a></li>
<li class="chapter" data-level="6.1.2" data-path="probability.html"><a href="probability.html#definition-and-axioms"><i class="fa fa-check"></i><b>6.1.2</b> Definition and Axioms</a></li>
<li class="chapter" data-level="6.1.3" data-path="probability.html"><a href="probability.html#permutations"><i class="fa fa-check"></i><b>6.1.3</b> Permutations</a></li>
<li class="chapter" data-level="6.1.4" data-path="probability.html"><a href="probability.html#sampling-without-replacement"><i class="fa fa-check"></i><b>6.1.4</b> Sampling without replacement</a></li>
<li class="chapter" data-level="6.1.5" data-path="probability.html"><a href="probability.html#combinations"><i class="fa fa-check"></i><b>6.1.5</b> Combinations</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="probability.html"><a href="probability.html#conditional-probability"><i class="fa fa-check"></i><b>6.2</b> Conditional Probability</a><ul>
<li class="chapter" data-level="6.2.1" data-path="probability.html"><a href="probability.html#conditional-marginal-and-joint-probabilities"><i class="fa fa-check"></i><b>6.2.1</b> Conditional, Marginal, and Joint Probabilities</a></li>
<li class="chapter" data-level="6.2.2" data-path="probability.html"><a href="probability.html#independence"><i class="fa fa-check"></i><b>6.2.2</b> Independence</a></li>
<li class="chapter" data-level="6.2.3" data-path="probability.html"><a href="probability.html#bayes-rule"><i class="fa fa-check"></i><b>6.2.3</b> Bayes’ Rule</a></li>
<li class="chapter" data-level="6.2.4" data-path="probability.html"><a href="probability.html#predicting-race-using-surname-and-residence-location"><i class="fa fa-check"></i><b>6.2.4</b> Predicting Race Using Surname and Residence Location</a></li>
<li class="chapter" data-level="6.2.5" data-path="probability.html"><a href="probability.html#predicting-election-outcomes-with-uncertainty"><i class="fa fa-check"></i><b>6.2.5</b> Predicting Election Outcomes with Uncertainty</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="probability.html"><a href="probability.html#random-variables-and-probability-distributions"><i class="fa fa-check"></i><b>6.3</b> Random Variables and Probability Distributions</a><ul>
<li class="chapter" data-level="6.3.1" data-path="probability.html"><a href="probability.html#bernoulli-and-uniform-distributions"><i class="fa fa-check"></i><b>6.3.1</b> Bernoulli and Uniform Distributions</a></li>
<li class="chapter" data-level="6.3.2" data-path="probability.html"><a href="probability.html#binomial-distribution"><i class="fa fa-check"></i><b>6.3.2</b> Binomial distribution</a></li>
<li class="chapter" data-level="6.3.3" data-path="probability.html"><a href="probability.html#normal-distribution"><i class="fa fa-check"></i><b>6.3.3</b> Normal distribution</a></li>
<li class="chapter" data-level="6.3.4" data-path="probability.html"><a href="probability.html#expectation-and-variance"><i class="fa fa-check"></i><b>6.3.4</b> Expectation and Variance</a></li>
<li class="chapter" data-level="6.3.5" data-path="probability.html"><a href="probability.html#predicting-election-outcomes-with-uncertainty-1"><i class="fa fa-check"></i><b>6.3.5</b> Predicting Election Outcomes with Uncertainty</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="probability.html"><a href="probability.html#large-sample-theorems"><i class="fa fa-check"></i><b>6.4</b> Large Sample Theorems</a><ul>
<li class="chapter" data-level="6.4.1" data-path="probability.html"><a href="probability.html#law-of-large-numbers"><i class="fa fa-check"></i><b>6.4.1</b> Law of Large Numbers</a></li>
<li class="chapter" data-level="6.4.2" data-path="probability.html"><a href="probability.html#central-limit-theorem"><i class="fa fa-check"></i><b>6.4.2</b> Central Limit Theorem</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="uncertainty.html"><a href="uncertainty.html"><i class="fa fa-check"></i><b>7</b> Uncertainty</a><ul>
<li class="chapter" data-level="" data-path="uncertainty.html"><a href="uncertainty.html#prerequisites-8"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="7.1" data-path="uncertainty.html"><a href="uncertainty.html#estimation"><i class="fa fa-check"></i><b>7.1</b> Estimation</a><ul>
<li class="chapter" data-level="7.1.1" data-path="uncertainty.html"><a href="uncertainty.html#unbiasedness-and-consistency"><i class="fa fa-check"></i><b>7.1.1</b> Unbiasedness and Consistency</a></li>
<li class="chapter" data-level="7.1.2" data-path="uncertainty.html"><a href="uncertainty.html#standard-error"><i class="fa fa-check"></i><b>7.1.2</b> Standard Error</a></li>
<li class="chapter" data-level="7.1.3" data-path="uncertainty.html"><a href="uncertainty.html#confidence-intervals"><i class="fa fa-check"></i><b>7.1.3</b> Confidence Intervals</a></li>
<li class="chapter" data-level="7.1.4" data-path="uncertainty.html"><a href="uncertainty.html#margin-of-error-and-sample-size-calculation-in-polls"><i class="fa fa-check"></i><b>7.1.4</b> Margin of Error and Sample Size Calculation in Polls</a></li>
<li class="chapter" data-level="7.1.5" data-path="uncertainty.html"><a href="uncertainty.html#analysis-of-randomized-controlled-trials"><i class="fa fa-check"></i><b>7.1.5</b> Analysis of Randomized Controlled Trials</a></li>
<li class="chapter" data-level="7.1.6" data-path="uncertainty.html"><a href="uncertainty.html#analysis-based-on-students-t-distribution"><i class="fa fa-check"></i><b>7.1.6</b> Analysis Based on Student’s t-Distribution</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="uncertainty.html"><a href="uncertainty.html#hypothesis-testing"><i class="fa fa-check"></i><b>7.2</b> Hypothesis Testing</a><ul>
<li class="chapter" data-level="7.2.1" data-path="uncertainty.html"><a href="uncertainty.html#tea-testing-experiment"><i class="fa fa-check"></i><b>7.2.1</b> Tea-Testing Experiment</a></li>
<li class="chapter" data-level="7.2.2" data-path="uncertainty.html"><a href="uncertainty.html#the-general-framework"><i class="fa fa-check"></i><b>7.2.2</b> The General Framework</a></li>
<li class="chapter" data-level="7.2.3" data-path="uncertainty.html"><a href="uncertainty.html#one-sample-tests"><i class="fa fa-check"></i><b>7.2.3</b> One-Sample Tests</a></li>
<li class="chapter" data-level="7.2.4" data-path="uncertainty.html"><a href="uncertainty.html#two-sample-tests"><i class="fa fa-check"></i><b>7.2.4</b> Two-sample tests</a></li>
<li class="chapter" data-level="7.2.5" data-path="uncertainty.html"><a href="uncertainty.html#power-analysis"><i class="fa fa-check"></i><b>7.2.5</b> Power Analysis</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="uncertainty.html"><a href="uncertainty.html#linear-regression-model-with-uncertainty"><i class="fa fa-check"></i><b>7.3</b> Linear Regression Model with Uncertainty</a><ul>
<li class="chapter" data-level="7.3.1" data-path="uncertainty.html"><a href="uncertainty.html#linear-regression-as-a-generative-model"><i class="fa fa-check"></i><b>7.3.1</b> Linear Regression as a Generative Model</a></li>
<li class="chapter" data-level="7.3.2" data-path="uncertainty.html"><a href="uncertainty.html#inference-about-coefficients"><i class="fa fa-check"></i><b>7.3.2</b> Inference about coefficients</a></li>
<li class="chapter" data-level="7.3.3" data-path="uncertainty.html"><a href="uncertainty.html#inference-about-predictions"><i class="fa fa-check"></i><b>7.3.3</b> Inference about predictions</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Quantatitive Social Science: The R Tidyverse Code</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="probability" class="section level1">
<h1><span class="header-section-number">6</span> Probability</h1>
<div id="prerequisites-7" class="section level2 unnumbered">
<h2>Prerequisites</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;forcats&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;stringr&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;broom&quot;</span>)</code></pre></div>
<!-- lint disable no-duplicate-headings -->
</div>
<div id="probability-1" class="section level2">
<h2><span class="header-section-number">6.1</span> Probability</h2>
<!-- lint enable no-duplicate-headings -->
<div id="frequentist-vs.bayesian" class="section level3">
<h3><span class="header-section-number">6.1.1</span> Frequentist vs. Bayesian</h3>
</div>
<div id="definition-and-axioms" class="section level3">
<h3><span class="header-section-number">6.1.2</span> Definition and Axioms</h3>
</div>
<div id="permutations" class="section level3">
<h3><span class="header-section-number">6.1.3</span> Permutations</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">birthday &lt;-<span class="st"> </span><span class="cf">function</span>(k) {
  logdenom &lt;-<span class="st"> </span>k <span class="op">*</span><span class="st"> </span><span class="kw">log</span>(<span class="dv">365</span>) <span class="op">+</span><span class="st"> </span><span class="kw">lfactorial</span>(<span class="dv">365</span> <span class="op">-</span><span class="st"> </span>k)
  lognumer &lt;-<span class="st"> </span><span class="kw">lfactorial</span>(<span class="dv">365</span>)
  pr &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st">   </span><span class="kw">exp</span>(lognumer <span class="op">-</span><span class="st"> </span>logdenom)
  pr
}

bday &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">k =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">50</span>, <span class="dt">pr =</span> <span class="kw">birthday</span>(k))

<span class="kw">ggplot</span>(bday, <span class="kw">aes</span>(<span class="dt">x =</span> k, <span class="dt">y =</span> pr)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="fl">0.5</span>, <span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="kw">str_c</span>(<span class="st">&quot;Probability that at least two&quot;</span>,
                           <span class="st">&quot;people have the same birthday&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>),
                     <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">by =</span> <span class="fl">0.1</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Number of people&quot;</span>)</code></pre></div>
<p><img src="probability_files/figure-html/unnamed-chunk-3-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p><strong>Note:</strong> The logarithm is used for numerical stability. Basically, “floating-point” numbers are approximations of numbers. If you perform arithmetic with numbers that are very large, very small, or vary differently in magnitudes, you could have problems. Logarithms help with some of those issues. See “Falling Into the Floating Point Trap” in <a href="http://www.burns-stat.com/pages/Tutor/R_inferno.pdf">The R Inferno</a> for a summary of floating point numbers. See these John Fox posts <a href="http://www.johndcook.com/blog/2008/09/26/comparing-three-methods-of-computing-standard-deviation/">1</a> <a href="http://www.johndcook.com/blog/2008/09/28/theoretical-explanation-for-numerical-results/">2</a> for an example of numerical stability gone wrong. Also see this article on the <a href="http://andrewgelman.com/2016/06/11/log-sum-of-exponentials/">log sum of exponentials</a>.</p>
</div>
<div id="sampling-without-replacement" class="section level3">
<h3><span class="header-section-number">6.1.4</span> Sampling without replacement</h3>
<p>Instead of using a <code>for</code> loop, we could do the simulations using a functional as described in <a href="http://r4ds.had.co.nz/">R for Data Science</a> chapter “Iterations”.</p>
<p>Define the function <code>sim_bdays</code> which randomly samples <code>k</code> birthdays, and returns <code>TRUE</code> if there are any duplicate birthdays, and <code>FALSE</code> if there are none.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_bdays &lt;-<span class="st"> </span><span class="cf">function</span>(k) {
  days &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">365</span>, k, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
  <span class="kw">length</span>(<span class="kw">unique</span>(days)) <span class="op">&lt;</span><span class="st"> </span>k
}</code></pre></div>
<p>We can test the code for <code>k = 10</code> birthdays.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sim_bdays</span>(<span class="dv">10</span>)
<span class="co">#&gt; [1] FALSE</span></code></pre></div>
<p>Since the function is randomly sampling birthdays, running it multiple times will produce different answers.</p>
<p>One helpful feature of a functional style of writing code vs. a <code>for</code> loop is that the function encapsulates the code and allows you to test that it works for different inputs before repeating it for many inputs. It is more difficult to debug functions that produce random outputs, but some sanity checks are that the function:</p>
<ul>
<li>returns a logical vector of length one (<code>TRUE</code> or <code>FALSE</code>)</li>
<li>always returns <code>FALSE</code> when <code>k = 1</code> since there can never be a duplicates with one person</li>
<li>always returns <code>TRUE</code> when <code>k &gt; 365</code> by the <a href="https://en.wikipedia.org/wiki/Pigeonhole_principle">pidgeonhole principle</a>.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sim_bdays</span>(<span class="dv">1</span>)
<span class="co">#&gt; [1] FALSE</span>
<span class="kw">sim_bdays</span>(<span class="dv">366</span>)
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>Set the parameters for 1,000 simulations, and 23 individuals. We use <code>map_lgl</code> since <code>sim_bdays</code> returns a logical value (<code>TRUE</code>, <code>FALSE</code>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sims &lt;-<span class="st"> </span><span class="dv">1000</span>
k &lt;-<span class="st"> </span><span class="dv">23</span>
<span class="kw">map_lgl</span>(<span class="kw">seq_len</span>(sims), <span class="op">~</span><span class="st"> </span><span class="kw">sim_bdays</span>(k)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mean</span>()
<span class="co">#&gt; [1] 0.489</span></code></pre></div>
<p>An alternative way of running this is using the <a href="https://www.rdocumentation.org/packages/purrr/topics/rerun">rerun</a> and using <code>flatten</code> to turn the output to a numeric vector:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rerun</span>(sims, <span class="kw">sim_bdays</span>(k)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">flatten_dbl</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mean</span>()
<span class="co">#&gt; [1] 0.477</span></code></pre></div>
</div>
<div id="combinations" class="section level3">
<h3><span class="header-section-number">6.1.5</span> Combinations</h3>
<p>The function for <span class="math inline">\(84\choose{6}\)</span> is:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">choose</span>(<span class="dv">84</span>, <span class="dv">6</span>)
<span class="co">#&gt; [1] 4.06e+08</span></code></pre></div>
<p>However, due to the the larges values that the binomial coefficient, it is almost always better to use the log of the binomial coefficient, <span class="math inline">\(\log{84\choose{6}}\)</span>,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">lchoose</span>(<span class="dv">84</span>, <span class="dv">6</span>)
<span class="co">#&gt; [1] 19.8</span></code></pre></div>
</div>
</div>
<div id="conditional-probability" class="section level2">
<h2><span class="header-section-number">6.2</span> Conditional Probability</h2>
<div id="conditional-marginal-and-joint-probabilities" class="section level3">
<h3><span class="header-section-number">6.2.1</span> Conditional, Marginal, and Joint Probabilities</h3>
<p>Load Florida voting data from the <strong>qss</strong> package:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(FLVoters, <span class="dt">package =</span> <span class="st">&quot;qss&quot;</span>)
<span class="kw">dim</span>(FLVoters)
<span class="co">#&gt; [1] 10000     6</span>
<span class="kw">glimpse</span>(FLVoters)
<span class="co">#&gt; Observations: 10,000</span>
<span class="co">#&gt; Variables: 6</span>
<span class="co">#&gt; $ surname &lt;chr&gt; &quot;PIEDRA&quot;, &quot;LYNCH&quot;, &quot;CHESTER&quot;, &quot;LATHROP&quot;, &quot;HUMMEL&quot;, &quot;CH...</span>
<span class="co">#&gt; $ county  &lt;int&gt; 115, 115, 115, 115, 115, 115, 115, 115, 1, 1, 115, 115...</span>
<span class="co">#&gt; $ VTD     &lt;int&gt; 66, 13, 103, 80, 8, 55, 84, 48, 41, 39, 26, 45, 11, 48...</span>
<span class="co">#&gt; $ age     &lt;int&gt; 58, 51, 63, 54, 77, 49, 77, 34, 56, 60, 44, 45, 80, 83...</span>
<span class="co">#&gt; $ gender  &lt;chr&gt; &quot;f&quot;, &quot;m&quot;, &quot;m&quot;, &quot;m&quot;, &quot;f&quot;, &quot;m&quot;, &quot;f&quot;, &quot;f&quot;, &quot;f&quot;, &quot;m&quot;, &quot;m&quot;,...</span>
<span class="co">#&gt; $ race    &lt;chr&gt; &quot;white&quot;, &quot;white&quot;, NA, &quot;white&quot;, &quot;white&quot;, &quot;white&quot;, &quot;whit...</span>
FLVoters &lt;-<span class="st"> </span>FLVoters <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">na.omit</span>()
<span class="kw">dim</span>(FLVoters)
<span class="co">#&gt; [1] 9113    6</span></code></pre></div>
<p>Note the difference between <code>glimpse()</code> and <code>dim()</code>. What is different in how they handle NA observations?</p>
<p>Instead of using <a href="https://www.rdocumentation.org/packages/base/topics/prop.base">prop.base</a>, we calculate the probabilities with a data frame. Calculate the marginal probabilities of each race:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">margin_race &lt;-
<span class="st">  </span>FLVoters <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(race) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n))
margin_race
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   race         n    prop</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;int&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 asian      175 0.0192 </span>
<span class="co">#&gt; 2 black     1194 0.131  </span>
<span class="co">#&gt; 3 hispanic  1192 0.131  </span>
<span class="co">#&gt; 4 native      29 0.00318</span>
<span class="co">#&gt; 5 other      310 0.0340 </span>
<span class="co">#&gt; 6 white     6213 0.682</span></code></pre></div>
<p>Calculate the marginal probabilities of each gender:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">margin_gender &lt;-
<span class="st">  </span>FLVoters <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(gender) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n))
margin_gender
<span class="co">#&gt; # A tibble: 2 x 3</span>
<span class="co">#&gt;   gender     n  prop</span>
<span class="co">#&gt;   &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 f       4883 0.536</span>
<span class="co">#&gt; 2 m       4230 0.464</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">FLVoters <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(gender <span class="op">==</span><span class="st"> &quot;f&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(race) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n))
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   race         n    prop</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;int&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 asian       83 0.0170 </span>
<span class="co">#&gt; 2 black      678 0.139  </span>
<span class="co">#&gt; 3 hispanic   666 0.136  </span>
<span class="co">#&gt; 4 native      17 0.00348</span>
<span class="co">#&gt; 5 other      158 0.0324 </span>
<span class="co">#&gt; 6 white     3281 0.672</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">joint_p &lt;-
<span class="st">  </span>FLVoters <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(gender, race) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n))
joint_p
<span class="co">#&gt; # A tibble: 12 x 4</span>
<span class="co">#&gt;   gender race         n    prop</span>
<span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt;    &lt;int&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 f      asian       83 0.00911</span>
<span class="co">#&gt; 2 f      black      678 0.0744 </span>
<span class="co">#&gt; 3 f      hispanic   666 0.0731 </span>
<span class="co">#&gt; 4 f      native      17 0.00187</span>
<span class="co">#&gt; 5 f      other      158 0.0173 </span>
<span class="co">#&gt; 6 f      white     3281 0.360  </span>
<span class="co">#&gt; # ... with 6 more rows</span></code></pre></div>
<p>We can convert the data frame to have gender as columns:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">joint_p <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>n) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">spread</span>(gender, prop)
<span class="co">#&gt; # A tibble: 6 x 3</span>
<span class="co">#&gt;   race           f       m</span>
<span class="co">#&gt;   &lt;chr&gt;      &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 asian    0.00911 0.0101 </span>
<span class="co">#&gt; 2 black    0.0744  0.0566 </span>
<span class="co">#&gt; 3 hispanic 0.0731  0.0577 </span>
<span class="co">#&gt; 4 native   0.00187 0.00132</span>
<span class="co">#&gt; 5 other    0.0173  0.0167 </span>
<span class="co">#&gt; 6 white    0.360   0.322</span></code></pre></div>
<p>Sum over race:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">joint_p <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(race) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">prop =</span> <span class="kw">sum</span>(prop))
<span class="co">#&gt; # A tibble: 6 x 2</span>
<span class="co">#&gt;   race        prop</span>
<span class="co">#&gt;   &lt;chr&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt; 1 asian    0.0192 </span>
<span class="co">#&gt; 2 black    0.131  </span>
<span class="co">#&gt; 3 hispanic 0.131  </span>
<span class="co">#&gt; 4 native   0.00318</span>
<span class="co">#&gt; 5 other    0.0340 </span>
<span class="co">#&gt; 6 white    0.682</span></code></pre></div>
<p>Sum over gender:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">joint_p <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(gender) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">prop =</span> <span class="kw">sum</span>(prop))
<span class="co">#&gt; # A tibble: 2 x 2</span>
<span class="co">#&gt;   gender  prop</span>
<span class="co">#&gt;   &lt;chr&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 f      0.536</span>
<span class="co">#&gt; 2 m      0.464</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">FLVoters &lt;-
<span class="st">  </span>FLVoters <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age_group =</span> <span class="kw">cut</span>(age, <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">20</span>, <span class="dv">40</span>, <span class="dv">60</span>, <span class="ot">Inf</span>), <span class="dt">right =</span> <span class="ot">TRUE</span>,
                         <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;&lt;= 20&quot;</span>, <span class="st">&quot;20-40&quot;</span>, <span class="st">&quot;40-60&quot;</span>, <span class="st">&quot;&gt; 60&quot;</span>)))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">joint3 &lt;-
<span class="st">  </span>FLVoters <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(race, age_group, gender) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n))
joint3
<span class="co">#&gt; # A tibble: 47 x 5</span>
<span class="co">#&gt;   race  age_group gender     n     prop</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;fct&gt;     &lt;chr&gt;  &lt;int&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 asian &lt;= 20     f          1 0.000110</span>
<span class="co">#&gt; 2 asian &lt;= 20     m          2 0.000219</span>
<span class="co">#&gt; 3 asian 20-40     f         24 0.00263 </span>
<span class="co">#&gt; 4 asian 20-40     m         26 0.00285 </span>
<span class="co">#&gt; 5 asian 40-60     f         38 0.00417 </span>
<span class="co">#&gt; 6 asian 40-60     m         47 0.00516 </span>
<span class="co">#&gt; # ... with 41 more rows</span></code></pre></div>
<p>Marginal probabilities by age groups</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">margin_age &lt;-
<span class="st">  </span>FLVoters <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(age_group) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prop =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n))
margin_age
<span class="co">#&gt; # A tibble: 4 x 3</span>
<span class="co">#&gt;   age_group     n   prop</span>
<span class="co">#&gt;   &lt;fct&gt;     &lt;int&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 &lt;= 20       161 0.0177</span>
<span class="co">#&gt; 2 20-40      2469 0.271 </span>
<span class="co">#&gt; 3 40-60      3285 0.360 </span>
<span class="co">#&gt; 4 &gt; 60       3198 0.351</span></code></pre></div>
<p>Calculate the probabilities that each group is in a given age group, and show <span class="math inline">\(P(\text{black} \land \text{female} \land \text{age} &gt; 60)\)</span>: (<em>Note: the symbol <span class="math inline">\(\land\)</span> is the logical symbol for ‘and’, implying the joint probability.</em>)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">left_join</span>(joint3,
          <span class="kw">select</span>(margin_age, age_group, <span class="dt">margin_age =</span> prop),
          <span class="dt">by =</span> <span class="st">&quot;age_group&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prob_age_group =</span> prop <span class="op">/</span><span class="st"> </span>margin_age) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(race <span class="op">==</span><span class="st"> &quot;black&quot;</span>, gender <span class="op">==</span><span class="st"> &quot;f&quot;</span>, age_group <span class="op">==</span><span class="st"> &quot;&gt; 60&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(race, age_group, gender, prob_age_group)
<span class="co">#&gt; # A tibble: 1 x 4</span>
<span class="co">#&gt;   race  age_group gender prob_age_group</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;fct&gt;     &lt;chr&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1 black &gt; 60      f              0.0538</span></code></pre></div>
<p>Two-way joint probability table for age group and gender</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">joint2 &lt;-<span class="st"> </span>FLVoters <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(age_group, gender) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prob_age_gender =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n))
joint2
<span class="co">#&gt; # A tibble: 8 x 4</span>
<span class="co">#&gt;   age_group gender     n prob_age_gender</span>
<span class="co">#&gt;   &lt;fct&gt;     &lt;chr&gt;  &lt;int&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1 &lt;= 20     f         88         0.00966</span>
<span class="co">#&gt; 2 &lt;= 20     m         73         0.00801</span>
<span class="co">#&gt; 3 20-40     f       1304         0.143  </span>
<span class="co">#&gt; 4 20-40     m       1165         0.128  </span>
<span class="co">#&gt; 5 40-60     f       1730         0.190  </span>
<span class="co">#&gt; 6 40-60     m       1555         0.171  </span>
<span class="co">#&gt; # ... with 2 more rows</span></code></pre></div>
<p>The joint probability <span class="math inline">\(P(\text{age} &gt; 60 \land \text{female})\)</span>,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">joint2 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(age_group <span class="op">==</span><span class="st"> &quot;&gt; 60&quot;</span>, gender <span class="op">==</span><span class="st"> &quot;f&quot;</span>)
<span class="co">#&gt; # A tibble: 1 x 4</span>
<span class="co">#&gt;   age_group gender     n prob_age_gender</span>
<span class="co">#&gt;   &lt;fct&gt;     &lt;chr&gt;  &lt;int&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt; 1 &gt; 60      f       1761           0.193</span></code></pre></div>
<p>The conditional probabilities <span class="math inline">\(P(\text{race } | \text{ gender, age})\)</span>,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">condprob_race &lt;-
<span class="st">  </span><span class="kw">left_join</span>(joint3, <span class="kw">select</span>(joint2, <span class="op">-</span>n), <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;age_group&quot;</span>, <span class="st">&quot;gender&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prob_race =</span> prop <span class="op">/</span><span class="st"> </span>prob_age_gender) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(age_group, gender) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(age_group, gender, race, prob_race)</code></pre></div>
<p>Each row is the <span class="math inline">\(P(\text{race } | \text{ age group} \land \text{gender})\)</span>, so <span class="math inline">\(P(\text{black } | \text{ female} \land \text{age} &gt; 60)\)</span>,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">filter</span>(condprob_race, gender <span class="op">==</span><span class="st"> &quot;f&quot;</span>, age_group <span class="op">==</span><span class="st"> &quot;&gt; 60&quot;</span>, race <span class="op">==</span><span class="st"> &quot;black&quot;</span>)
<span class="co">#&gt; # A tibble: 1 x 4</span>
<span class="co">#&gt;   age_group gender race  prob_race</span>
<span class="co">#&gt;   &lt;fct&gt;     &lt;chr&gt;  &lt;chr&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 &gt; 60      f      black    0.0977</span></code></pre></div>
</div>
<div id="independence" class="section level3">
<h3><span class="header-section-number">6.2.2</span> Independence</h3>
<p>Create a table with the products of margins of race and age. Using the function <a href="https://www.rdocumentation.org/packages/tidyr/topics/crossing">crossing</a> to create a tibble with all combinations of race and gender and the independent prob.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">race_gender_indep &lt;-
<span class="st">  </span><span class="kw">crossing</span>(<span class="kw">select</span>(margin_race, race, <span class="dt">prob_race =</span> prop),
           <span class="kw">select</span>(margin_gender, gender, <span class="dt">prob_gender =</span> prop)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prob_indep =</span> prob_race <span class="op">*</span><span class="st"> </span>prob_gender) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(<span class="kw">select</span>(joint_p, gender, race, <span class="dt">prob =</span> prop),
            <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;gender&quot;</span>, <span class="st">&quot;race&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(race, gender, <span class="kw">everything</span>())
race_gender_indep
<span class="co">#&gt; # A tibble: 12 x 6</span>
<span class="co">#&gt;   race     gender prob_race prob_gender prob_indep    prob</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 asian    f         0.0192       0.536    0.0103  0.00911</span>
<span class="co">#&gt; 2 asian    m         0.0192       0.464    0.00891 0.0101 </span>
<span class="co">#&gt; 3 black    f         0.131        0.536    0.0702  0.0744 </span>
<span class="co">#&gt; 4 black    m         0.131        0.464    0.0608  0.0566 </span>
<span class="co">#&gt; 5 hispanic f         0.131        0.536    0.0701  0.0731 </span>
<span class="co">#&gt; 6 hispanic m         0.131        0.464    0.0607  0.0577 </span>
<span class="co">#&gt; # ... with 6 more rows</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(race_gender_indep,
       <span class="kw">aes</span>(<span class="dt">x =</span> prob_indep, <span class="dt">y =</span> prob, <span class="dt">colour =</span> race)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">slope =</span> <span class="dv">1</span>, <span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(. <span class="op">~</span><span class="st"> </span>gender) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_fixed</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="kw">expression</span>(<span class="kw">P</span>(<span class="st">&quot;race&quot;</span>) <span class="op">*</span><span class="st"> </span><span class="kw">P</span>(<span class="st">&quot;gender&quot;</span>)),
       <span class="dt">y =</span> <span class="kw">expression</span>(<span class="kw">P</span>(<span class="st">&quot;race and gender&quot;</span>)))</code></pre></div>
<p><img src="probability_files/figure-html/unnamed-chunk-19-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>While the original code only calculates joint-independence value for values of age &gt; 60, and female, this calculates the joint probabilities for all combinations of the three variables, and facets by age and gender.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">joint_indep &lt;-
<span class="st">  </span><span class="kw">crossing</span>(<span class="kw">select</span>(margin_race, race, <span class="dt">prob_race =</span> prop),
           <span class="kw">select</span>(margin_age, age_group, <span class="dt">prob_age =</span> prop),
           <span class="kw">select</span>(margin_gender, gender, <span class="dt">prob_gender =</span> prop)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">indep_prob =</span> prob_race <span class="op">*</span><span class="st"> </span>prob_age <span class="op">*</span><span class="st"> </span>prob_gender) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(<span class="kw">select</span>(joint3, race, age_group, gender, <span class="dt">prob =</span> prop),
            <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;gender&quot;</span>, <span class="st">&quot;age_group&quot;</span>, <span class="st">&quot;race&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">replace_na</span>(<span class="kw">list</span>(<span class="dt">prob =</span> <span class="dv">0</span>))

<span class="kw">ggplot</span>(joint_indep, <span class="kw">aes</span>(<span class="dt">x =</span> prob, <span class="dt">y =</span> indep_prob, <span class="dt">colour =</span> race)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">slope =</span> <span class="dv">1</span>, <span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(age_group <span class="op">~</span><span class="st"> </span>gender) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_fixed</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;P(race and age and gender)&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;P(race) * P(age) * P(gender)&quot;</span>,
       <span class="dt">title =</span> <span class="st">&quot;Joint Independence&quot;</span>)</code></pre></div>
<p><img src="probability_files/figure-html/unnamed-chunk-20-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>While code in <em>QSS</em> only calculates the conditional independence given female, the following code calculates conditional independence for all values of <code>gender</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cond_gender &lt;-
<span class="st">  </span><span class="kw">left_join</span>(<span class="kw">select</span>(joint3, race, age_group, gender, <span class="dt">joint_prob =</span> prop),
            <span class="kw">select</span>(margin_gender, gender, <span class="dt">prob_gender =</span> prop),
            <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;gender&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">cond_prob =</span> joint_prob <span class="op">/</span><span class="st"> </span>prob_gender)</code></pre></div>
<p>Calculate the conditional distribution <span class="math inline">\(\Pr(\text{race} | \text{gender})\)</span>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">prob_race_gender &lt;-
<span class="st">  </span><span class="kw">left_join</span>(<span class="kw">select</span>(joint_p, race, gender, <span class="dt">prob_race_gender =</span> prop),
            <span class="kw">select</span>(margin_gender, gender, <span class="dt">prob_gender =</span> prop),
            <span class="dt">by =</span> <span class="st">&quot;gender&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prob_race =</span> prob_race_gender <span class="op">/</span><span class="st"> </span>prob_gender)</code></pre></div>
<p>Calculate the conditional distribution <span class="math inline">\(\Pr(\text{age} | \text{gender})\)</span>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">prob_age_gender &lt;-
<span class="st">  </span><span class="kw">left_join</span>(<span class="kw">select</span>(joint2, age_group, gender, prob_age_gender),
            <span class="kw">select</span>(margin_gender, gender, <span class="dt">prob_gender =</span> prop),
            <span class="dt">by =</span> <span class="st">&quot;gender&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prob_age =</span> prob_age_gender <span class="op">/</span><span class="st"> </span>prob_gender)

<span class="co"># indep prob of race and age</span>
indep_cond_gender &lt;-
<span class="st">  </span><span class="kw">full_join</span>(<span class="kw">select</span>(prob_race_gender, race, gender, prob_race),
            <span class="kw">select</span>(prob_age_gender, age_group, gender, prob_age),
            <span class="dt">by =</span> <span class="st">&quot;gender&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">indep_prob =</span> prob_race <span class="op">*</span><span class="st"> </span>prob_age)

<span class="kw">inner_join</span>(<span class="kw">select</span>(indep_cond_gender, race, age_group, gender, indep_prob),
           <span class="kw">select</span>(cond_gender, race, age_group, gender, cond_prob),
           <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;gender&quot;</span>, <span class="st">&quot;age_group&quot;</span>, <span class="st">&quot;race&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> cond_prob, <span class="dt">y =</span> indep_prob, <span class="dt">colour =</span> race)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">slope =</span> <span class="dv">1</span>, <span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(age_group <span class="op">~</span><span class="st"> </span>gender) <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_fixed</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;P(race and age | gender)&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;P(race | gender) * P(age | gender)&quot;</span>,
       <span class="dt">title =</span> <span class="st">&quot;Marginal independence&quot;</span>)</code></pre></div>
<p><img src="probability_files/figure-html/unnamed-chunk-23-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div id="monty-hall-problem" class="section level4">
<h4><span class="header-section-number">6.2.2.1</span> Monty-hall problem</h4>
<p>The <code>for</code> loop approach in <em>QSS</em> is valid code, but here we provide a more functional approach to solving the problem. We will define a function to choose a door, repeat the function multiple times while storing the results in a data frame, and then summarize that data frame.</p>
<p>First, create a function for a single iteration. This returns a single logical value:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">choose_door &lt;-<span class="st"> </span><span class="cf">function</span>(.iter) {
  <span class="co"># what&#39;s behind each door door:</span>
  <span class="co"># Why is it okay that this is fixed?</span>
  doors &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;goat&quot;</span>, <span class="st">&quot;goat&quot;</span>, <span class="st">&quot;car&quot;</span>)

  <span class="co"># User randomly chooses a door</span>
  first &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dv">1</span>)

  <span class="co"># randomly choose the door that Monty Hall reveals</span>
  remain &lt;-<span class="st"> </span>doors[<span class="op">-</span>first]
  monty &lt;-<span class="st"> </span><span class="kw">sample</span>( (<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>)[remain <span class="op">==</span><span class="st"> &quot;goat&quot;</span>], <span class="dt">size =</span> <span class="dv">1</span>)
  <span class="co"># did the contestant win?</span>
  <span class="kw">tibble</span>(<span class="dt">.iter =</span> .iter,
         <span class="dt">result =</span> remain[<span class="op">-</span>monty] <span class="op">==</span><span class="st"> &quot;car&quot;</span>)
}</code></pre></div>
<p>Now use <a href="https://www.rdocumentation.org/packages/purrr/topics/map_df">map_df</a> to run <code>choose_door</code> multiple times, and then summarize the results:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sims &lt;-<span class="st"> </span><span class="dv">1000</span>
<span class="kw">map_df</span>(<span class="kw">seq_len</span>(sims), choose_door) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">win_pct =</span> <span class="kw">mean</span>(result))
<span class="co">#&gt; # A tibble: 1 x 1</span>
<span class="co">#&gt;   win_pct</span>
<span class="co">#&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1   0.648</span></code></pre></div>
</div>
</div>
<div id="bayes-rule" class="section level3">
<h3><span class="header-section-number">6.2.3</span> Bayes’ Rule</h3>
</div>
<div id="predicting-race-using-surname-and-residence-location" class="section level3">
<h3><span class="header-section-number">6.2.4</span> Predicting Race Using Surname and Residence Location</h3>
<p>Start with the Census names files:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;cnames&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;qss&quot;</span>)
<span class="kw">glimpse</span>(cnames)
<span class="co">#&gt; Observations: 151,671</span>
<span class="co">#&gt; Variables: 7</span>
<span class="co">#&gt; $ surname     &lt;chr&gt; &quot;SMITH&quot;, &quot;JOHNSON&quot;, &quot;WILLIAMS&quot;, &quot;BROWN&quot;, &quot;JONES&quot;, ...</span>
<span class="co">#&gt; $ count       &lt;int&gt; 2376206, 1857160, 1534042, 1380145, 1362755, 11278...</span>
<span class="co">#&gt; $ pctwhite    &lt;dbl&gt; 73.34, 61.55, 48.52, 60.72, 57.69, 85.80, 64.73, 6...</span>
<span class="co">#&gt; $ pctblack    &lt;dbl&gt; 22.22, 33.80, 46.72, 34.54, 37.73, 10.41, 30.77, 0...</span>
<span class="co">#&gt; $ pctapi      &lt;dbl&gt; 0.40, 0.42, 0.37, 0.41, 0.35, 0.42, 0.40, 1.43, 0....</span>
<span class="co">#&gt; $ pcthispanic &lt;dbl&gt; 1.56, 1.50, 1.60, 1.64, 1.44, 1.43, 1.58, 90.82, 9...</span>
<span class="co">#&gt; $ pctothers   &lt;dbl&gt; 2.48, 2.73, 2.79, 2.69, 2.79, 1.94, 2.52, 1.09, 0....</span></code></pre></div>
<p>For each surname, <code>cnames</code> contains variables with the probability that it belongs to an individual of a given race (<code>pctwhite</code>, <code>pctblack</code>, …). We want to find the most-likely race for a given surname, by finding the race with the maximum proportion. Instead of dealing with multiple variables, it is easier to use <code>max</code> on a single variable, so we will rearrange the data to in order to use a grouped summarize, and then merge the new variable back to the original data sets. We will also remove the ‘pct’ prefix from each of the variable names.</p>
<p>Calculate the most likely race for each name:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">most_likely_race &lt;-
<span class="st">  </span>cnames <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>count) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(race_pred, pct, <span class="op">-</span>surname) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># remove pct_ prefix from variable names</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">race_pred =</span> <span class="kw">str_replace</span>(race_pred, <span class="st">&quot;^pct&quot;</span>, <span class="st">&quot;&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># # group by surname</span>
<span class="st">  </span><span class="kw">group_by</span>(surname) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># select obs with the largest percentage</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="kw">row_number</span>(<span class="kw">desc</span>(pct)) <span class="op">==</span><span class="st"> </span>1L) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># Ungroup to avoid errors later</span>
<span class="st">  </span>ungroup <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># # don&#39;t need pct anymore</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>pct) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">race_pred =</span> <span class="kw">recode</span>(race_pred, <span class="dt">asian =</span> <span class="st">&quot;api&quot;</span>, <span class="dt">other =</span> <span class="st">&quot;others&quot;</span>))</code></pre></div>
<p>Merge the data frame with the most likely race for each surname to the the original <code>cnames</code> data frame:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cnames &lt;-
<span class="st">  </span>cnames <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(most_likely_race, <span class="dt">by =</span> <span class="st">&quot;surname&quot;</span>)</code></pre></div>
<p>Instead of using <code>match</code>, use <code>inner_join</code> to merge the surnames to <code>FLVoters</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">FLVoters &lt;-
<span class="st">  </span>FLVoters <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inner_join</span>(cnames, <span class="dt">by =</span> <span class="st">&quot;surname&quot;</span>)
<span class="kw">dim</span>(FLVoters)
<span class="co">#&gt; [1] 8022   14</span></code></pre></div>
<p><code>FLVoters</code> also includes a “native” category that the surname dataset does not.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">FLVoters &lt;-
<span class="st">  </span>FLVoters <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">race2 =</span> <span class="kw">fct_recode</span>(race, <span class="dt">other =</span> <span class="st">&quot;native&quot;</span>))</code></pre></div>
<p>Check that the levels of <code>race</code> and <code>race_pred</code> are the same:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">FLVoters <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(race2)
<span class="co">#&gt; # A tibble: 5 x 2</span>
<span class="co">#&gt;   race2        n</span>
<span class="co">#&gt;   &lt;fct&gt;    &lt;int&gt;</span>
<span class="co">#&gt; 1 asian      140</span>
<span class="co">#&gt; 2 black     1078</span>
<span class="co">#&gt; 3 hispanic  1023</span>
<span class="co">#&gt; 4 other      277</span>
<span class="co">#&gt; 5 white     5504</span>
FLVoters <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">count</span>(race_pred)
<span class="co">#&gt; # A tibble: 5 x 2</span>
<span class="co">#&gt;   race_pred     n</span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;int&gt;</span>
<span class="co">#&gt; 1 api         120</span>
<span class="co">#&gt; 2 black       258</span>
<span class="co">#&gt; 3 hispanic   1121</span>
<span class="co">#&gt; 4 others        7</span>
<span class="co">#&gt; 5 white      6516</span></code></pre></div>
<p>Now we can calculate <em>True positive rate</em> for <em>all</em> races</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">FLVoters <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(race2) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">tp =</span> <span class="kw">mean</span>(race2 <span class="op">==</span><span class="st"> </span>race_pred)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(tp))
<span class="co">#&gt; # A tibble: 5 x 2</span>
<span class="co">#&gt;   race2       tp</span>
<span class="co">#&gt;   &lt;fct&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 white    0.950</span>
<span class="co">#&gt; 2 hispanic 0.847</span>
<span class="co">#&gt; 3 black    0.160</span>
<span class="co">#&gt; 4 asian    0    </span>
<span class="co">#&gt; 5 other    0</span></code></pre></div>
<p>and the <em>False discovery rate</em> for <em>all</em> races,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">FLVoters <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(race_pred) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">fp =</span> <span class="kw">mean</span>(race2 <span class="op">!=</span><span class="st"> </span>race_pred)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(fp))
<span class="co">#&gt; # A tibble: 5 x 2</span>
<span class="co">#&gt;   race_pred    fp</span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 api       1    </span>
<span class="co">#&gt; 2 others    1    </span>
<span class="co">#&gt; 3 black     0.329</span>
<span class="co">#&gt; 4 hispanic  0.227</span>
<span class="co">#&gt; 5 white     0.197</span></code></pre></div>
<p>Now add residence data using the <code>FLCensus</code> data included in the</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;FLCensus&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;qss&quot;</span>)</code></pre></div>
<p><span class="math inline">\(P(\text{race})\)</span> in Florida:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">race.prop &lt;-
<span class="st">  </span>FLCensus <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(total.pop, white, black, api, hispanic, others) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(race, pct, <span class="op">-</span>total.pop) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(race) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">weighted.mean</span>(pct, <span class="dt">weights =</span> total.pop)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(mean))
race.prop
<span class="co">#&gt; # A tibble: 5 x 2</span>
<span class="co">#&gt;   race       mean</span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 white    0.605 </span>
<span class="co">#&gt; 2 hispanic 0.213 </span>
<span class="co">#&gt; 3 black    0.139 </span>
<span class="co">#&gt; 4 api      0.0219</span>
<span class="co">#&gt; 5 others   0.0214</span></code></pre></div>
</div>
<div id="predicting-election-outcomes-with-uncertainty" class="section level3">
<h3><span class="header-section-number">6.2.5</span> Predicting Election Outcomes with Uncertainty</h3>
<p>Load the <code>pres08</code> data from the <strong>qss</strong> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;pres08&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;qss&quot;</span>)</code></pre></div>
<p>Add a column <code>p</code> which contains Obama’s vote share of the major parties:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pres08 &lt;-<span class="st"> </span>pres08 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">p =</span> Obama <span class="op">/</span><span class="st"> </span>(Obama <span class="op">+</span><span class="st"> </span>McCain))</code></pre></div>
<p>Write a function to simulate the elections. <code>df</code> is the data frame (<code>pres08</code>) with the state, EV, and <code>p</code> columns. <code>n_draws</code> is the size of the binomial distribution to draw from. <code>.id</code> is the simulation number.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_election &lt;-<span class="st"> </span><span class="cf">function</span>(.id, df, <span class="dt">n_draws =</span> <span class="dv">1000</span>) {
  <span class="co"># For each state randomly sample</span>
  <span class="kw">mutate</span>(df,
         <span class="dt">draws =</span> <span class="kw">rbinom</span>(<span class="kw">n</span>(), n_draws, p)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(draws <span class="op">&gt;</span><span class="st"> </span>(n_draws <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">EV =</span> <span class="kw">sum</span>(EV),
            <span class="dt">.id =</span> .id)
}</code></pre></div>
<p>Now simulate the election 10,000 times:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sims &lt;-<span class="st"> </span><span class="dv">10000</span>
sim_results &lt;-<span class="st"> </span><span class="kw">map_df</span>(<span class="kw">seq_len</span>(sims), <span class="op">~</span><span class="st"> </span><span class="kw">sim_election</span>(.x, pres08, <span class="dt">n_draws =</span> <span class="dv">1000</span>))</code></pre></div>
<p>In the 2008 election, Obama received 364 electoral votes</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ELECTION_EV &lt;-<span class="st"> </span><span class="dv">364</span></code></pre></div>
<p>And plot them,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(sim_results, <span class="kw">aes</span>(<span class="dt">x =</span> EV, <span class="dt">y =</span> ..density..)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">10</span>, <span class="dt">fill =</span> <span class="st">&quot;gray30&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> ELECTION_EV, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Electoral Votes&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;density&quot;</span>)</code></pre></div>
<p><img src="probability_files/figure-html/unnamed-chunk-36-1.png" width="70%" style="display: block; margin: auto;" /> Simulation mean, variance, and standard deviations:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_results <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(EV) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise_all</span>(<span class="kw">funs</span>(mean, var, sd))
<span class="co">#&gt;   mean var   sd</span>
<span class="co">#&gt; 1  352 269 16.4</span></code></pre></div>
<p>Theoretical probabilities from a binomial distribution:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># we cannot use n, because mutate will look for n() first.</span>
n_draws &lt;-<span class="st"> </span><span class="dv">1000</span>
pres08 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pb =</span> <span class="kw">pbinom</span>(n_draws <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">size =</span> n_draws, <span class="dt">prob =</span> p,
                     <span class="dt">lower.tail  =</span> <span class="ot">FALSE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">sum</span>(pb <span class="op">*</span><span class="st"> </span>EV),
            <span class="dt">V =</span> <span class="kw">sum</span>(pb <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>pb) <span class="op">*</span><span class="st"> </span>EV <span class="op">^</span><span class="st"> </span><span class="dv">2</span>),
            <span class="dt">sd =</span> <span class="kw">sqrt</span>(V))
<span class="co">#&gt;   mean   V   sd</span>
<span class="co">#&gt; 1  352 269 16.4</span></code></pre></div>
</div>
</div>
<div id="random-variables-and-probability-distributions" class="section level2">
<h2><span class="header-section-number">6.3</span> Random Variables and Probability Distributions</h2>
<div id="bernoulli-and-uniform-distributions" class="section level3">
<h3><span class="header-section-number">6.3.1</span> Bernoulli and Uniform Distributions</h3>
<p>Uniform distribution functions:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dunif</span>(<span class="fl">0.5</span>, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">1</span>)
<span class="co">#&gt; [1] 1</span>
<span class="kw">punif</span>(<span class="dv">1</span>, <span class="dt">min =</span> <span class="op">-</span><span class="dv">2</span>, <span class="dt">max =</span> <span class="dv">2</span>)
<span class="co">#&gt; [1] 0.75</span></code></pre></div>
<p>Sample from a uniform distribution, and convert to a probability:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sims &lt;-<span class="st"> </span><span class="dv">1000</span>
p &lt;-<span class="st"> </span><span class="fl">0.5</span></code></pre></div>
<p>A Bernoulli distribution is a discrete distribution which randomly samples from 0 and 1. A random variable <span class="math inline">\(X\)</span> with a Bernoulli distribution with probability parameter <span class="math inline">\(p\)</span> has the distribution, <span class="math display">\[
\begin{aligned}
P(X = 1 | p) &amp;= p \\
P(X = 0 | p) &amp;= 1 - p
\end{aligned}
\]</span></p>
<p>R does not have a <code>rbernoulli</code> for the Bernoulli distribution (because as we will see it is a special case of the Binomial distribution, and there are several other ways to sample from it): Here are three ways to sample from a Bernoulli distribution.</p>
<p>First, we can use the <code>sample</code> from values <code>c(0, 1)</code> with replacement. By default it will set sample 0 and 1 with equal probability (<span class="math inline">\(p = 0.5\)</span>), but using the <code>prob</code> argument we can sample 0 and 1 with difference probabilities. Take 50 samples from a Bernoulli distribution with <code>p = 0.6</code>,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="fl">0.6</span>
n &lt;-<span class="st"> </span><span class="dv">100</span>
y &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), n, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p, p), <span class="dt">replace =</span> <span class="ot">TRUE</span>)
<span class="kw">head</span>(y)
<span class="co">#&gt; [1] 1 0 1 1 1 1</span>
<span class="kw">mean</span>(y)
<span class="co">#&gt; [1] 0.57</span></code></pre></div>
<p>A second method to sample <span class="math inline">\(n\)</span> values from a Bernoulli distribution that has a probability parameter <span class="math inline">\(p\)</span> is,</p>
<ol style="list-style-type: decimal">
<li>Take a sample of <span class="math inline">\(n\)</span> values from a uniform distribution. Call this vector <span class="math inline">\(x\)</span>.</li>
<li>To generate a sample <span class="math inline">\(y\)</span> taking values of 0 and 1 from this vector <span class="math inline">\(x\)</span>, set <span class="math inline">\(y_i = 1\)</span> if <span class="math inline">\(x_i &gt;= p\)</span>, and <span class="math inline">\(y_i = 0\)</span> if <span class="math inline">\(x_i &lt; p\)</span>.</li>
</ol>
<p>Note how this method works. Given a value <span class="math inline">\(p\)</span> between 0 and 1, in a sample from Uniform distribution, in expectation a fraction of <span class="math inline">\(p\)</span> values will be less than <span class="math inline">\(p\)</span>, and in expectation a fraction of <span class="math inline">\(1 - p\)</span> values will be greater than <span class="math inline">\(p\)</span>. These are exactly the probabilities of sampling 1 and 0 in the probability mass of the Uniform distribution: <code>{r} y &lt;- as.integer(runif(n, min = 0, max = 1) &lt;= p) head(y) mean(y)</code>ß</p>
<p>Third, note that the Bernoulli distribution is a special case of the binomial distribution (discussed in the next section), where <span class="math inline">\(size = 1\)</span>. Thus, we can use the <code>rbinom</code> function to sample from a binomial distribution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">y &lt;-<span class="st"> </span><span class="kw">rbinom</span>(n, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> p)
<span class="kw">head</span>(y)
<span class="co">#&gt; [1] 1 1 1 0 1 1</span>
<span class="kw">mean</span>(y)
<span class="co">#&gt; [1] 0.64</span></code></pre></div>
<p>Since the R functions for the Binomial distribution don’t exist here are examples of how you would write them as examples of writing functions to sample and calculate the PDF or PMF, CDF, and quantile functions of a distribution. Sample from the distribution:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rbernoulli &lt;-<span class="st"> </span><span class="cf">function</span>(n, <span class="dt">prob =</span> <span class="fl">0.5</span>) {
  <span class="kw">sample</span>(<span class="kw">c</span>(1L, 0L), n, <span class="dt">replace =</span> <span class="ot">FALSE</span>, <span class="dt">prob =</span> <span class="kw">c</span>(prob, <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>prob))
}</code></pre></div>
<p>Probability mass function (PMF):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dbernoulli &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">prob =</span> <span class="fl">0.5</span>) {
  d &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA_real_</span>, <span class="kw">length</span>(x))
  d[x <span class="op">==</span><span class="st"> </span><span class="dv">1</span>] &lt;-<span class="st"> </span>prob
  d[x <span class="op">==</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>prob
  d
}</code></pre></div>
<p>Cumulative density function (CDF): <span class="math display">\[
P(X \leq x|p) = \begin{cases}
0 &amp; \text{if } x &lt; 0 , \\
1 - p &amp; \text{if } 0 \leq x &lt; 1 ,\\
1 &amp; \text{if } x \geq 1 .
\end{cases}
\]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pbernoulli &lt;-<span class="st"> </span><span class="cf">function</span>(q, <span class="dt">prob =</span> <span class="fl">0.5</span>) {
  p &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA_real_</span>, <span class="kw">length</span>(q))
  p[q <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>] &lt;-<span class="st"> </span><span class="dv">0</span>
  p[q <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>q <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>prob
  p[q <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1</span>
  p
}</code></pre></div>
<p>The inverse cumulative density function or quantile function, <span class="math display">\[
q =
\begin{cases}
\emptyset &amp; \text{if } x \leq 1 - p, \\
0 &amp; \text{if } 1 - p \leq x &lt; 1 ,\\
1 &amp; \text{if } x \geq 1 .
\end{cases}
\]</span> where, <span class="math display">\[
q \text{ such that } P(X \leq q|p) = x.
\]</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">qbernoulli &lt;-<span class="st"> </span><span class="cf">function</span>(p, <span class="dt">prob =</span> <span class="fl">0.5</span>) {
  q &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="ot">NA_integer_</span>, <span class="kw">length</span>(p))
  q[prob <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p <span class="op">&amp;</span><span class="st"> </span>prob <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>] &lt;-<span class="st"> </span>0L
  q[prob <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1</span>] &lt;-<span class="st"> </span>1L
  q
}</code></pre></div>
<p>Alternatively, since the Bernoulli distribution is a special case of the Binomial distribution, write <code>*bernoulli</code> functions that wrap calls to to <code>*binom</code> functions for the special case where <code>size = 1</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rbernoulli &lt;-<span class="st"> </span><span class="cf">function</span>(n, <span class="dt">prob =</span> <span class="fl">0.5</span>, ...) {
  <span class="kw">rbinom</span>(n, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> prob, ...)
}
pbernoulli &lt;-<span class="st"> </span><span class="cf">function</span>(q, <span class="dt">prob =</span> <span class="fl">0.5</span>, ...) {
  <span class="kw">rbinom</span>(q, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> prob, ...)
}
pbernoulli &lt;-<span class="st"> </span><span class="cf">function</span>(q, <span class="dt">prob =</span> <span class="fl">0.5</span>, ...) {
  <span class="kw">rbinom</span>(q, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> prob, ...)
}
dbernoulli &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">prob =</span> <span class="fl">0.5</span>, ...) {
  <span class="kw">rbinom</span>(x, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> prob, ...)
}</code></pre></div>
</div>
<div id="binomial-distribution" class="section level3">
<h3><span class="header-section-number">6.3.2</span> Binomial distribution</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">dbinom</span>(<span class="dv">2</span>, <span class="dt">size =</span> <span class="dv">3</span>, <span class="dt">prob =</span> <span class="fl">0.5</span>)
<span class="co">#&gt; [1] 0.375</span>
<span class="kw">pbinom</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="fl">0.5</span>)
<span class="co">#&gt; [1] 0.5</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">voters &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1000</span>, <span class="dv">10000</span>, <span class="dv">100000</span>)
<span class="kw">dbinom</span>(voters <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">size =</span> voters, <span class="dt">prob =</span> <span class="fl">0.5</span>)
<span class="co">#&gt; [1] 0.02523 0.00798 0.00252</span></code></pre></div>
</div>
<div id="normal-distribution" class="section level3">
<h3><span class="header-section-number">6.3.3</span> Normal distribution</h3>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pnorm</span>(<span class="dv">1</span>) <span class="op">-</span><span class="st"> </span><span class="kw">pnorm</span>(<span class="op">-</span><span class="dv">1</span>)
<span class="co">#&gt; [1] 0.683</span>
<span class="kw">pnorm</span>(<span class="dv">2</span>) <span class="op">-</span><span class="st"> </span><span class="kw">pnorm</span>(<span class="op">-</span><span class="dv">2</span>)
<span class="co">#&gt; [1] 0.954</span></code></pre></div>
<p>Write a function to calculate the area of a normal distribution <span class="math inline">\(\pm \sigma\)</span></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">normal_pm_sigma &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">mu =</span> <span class="dv">0</span>, <span class="dt">sd =</span> <span class="dv">1</span>) {
  (<span class="kw">pnorm</span>(mu <span class="op">+</span><span class="st"> </span>sd <span class="op">*</span><span class="st"> </span>x, <span class="dt">mean =</span> mu, <span class="dt">sd =</span> sd) <span class="op">-</span>
<span class="st">     </span><span class="kw">pnorm</span>(mu <span class="op">-</span><span class="st"> </span>sd <span class="op">*</span><span class="st"> </span>x, <span class="dt">mean =</span> mu, <span class="dt">sd =</span> sd))
}
<span class="kw">normal_pm_sigma</span>(<span class="dv">1</span>)
<span class="co">#&gt; [1] 0.683</span>
<span class="kw">normal_pm_sigma</span>(<span class="dv">2</span>)
<span class="co">#&gt; [1] 0.954</span>
<span class="kw">normal_pm_sigma</span>(<span class="dv">1</span>, <span class="dt">mu =</span> <span class="dv">5</span>, <span class="dt">sd =</span> <span class="dv">2</span>)
<span class="co">#&gt; [1] 0.683</span>
<span class="kw">normal_pm_sigma</span>(<span class="dv">2</span>, <span class="dt">mu =</span> <span class="dv">5</span>, <span class="dt">sd =</span> <span class="dv">2</span>)
<span class="co">#&gt; [1] 0.954</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;pres08&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;qss&quot;</span>)
<span class="kw">data</span>(<span class="st">&quot;pres12&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;qss&quot;</span>)</code></pre></div>
<p>To join both data frames</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pres &lt;-
<span class="st">  </span><span class="kw">full_join</span>(<span class="kw">select</span>(pres08, state, <span class="dt">Obama_2008 =</span> Obama, <span class="dt">McCain_2008 =</span> McCain,
                 <span class="dt">EV_2008 =</span> EV),
          <span class="kw">select</span>(pres12, state, <span class="dt">Obama_2012 =</span> Obama, <span class="dt">Romney_2012 =</span> Romney,
                 <span class="dt">EV_2012 =</span> EV),
          <span class="dt">by =</span> <span class="st">&quot;state&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Obama_2008_z =</span> <span class="kw">as.numeric</span>(<span class="kw">scale</span>(Obama_<span class="dv">2008</span>)),
         <span class="dt">Obama_2012_z =</span> <span class="kw">as.numeric</span>(<span class="kw">scale</span>(Obama_<span class="dv">2012</span>)))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit1 &lt;-<span class="st"> </span><span class="kw">lm</span>(Obama_2012_z <span class="op">~</span><span class="st"> </span><span class="op">-</span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span>Obama_2008_z, <span class="dt">data =</span> pres)</code></pre></div>
<p>Plot the residuals and compare them to a normal distribution:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">err &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">err =</span> <span class="kw">resid</span>(fit1)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># z-score of residuals</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">err_std =</span> err <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(err))

<span class="kw">ggplot</span>(err, <span class="kw">aes</span>(<span class="dt">x =</span> err_std)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">y =</span> ..density..),
                 <span class="dt">binwidth =</span> <span class="dv">1</span>, <span class="dt">boundary =</span> <span class="dv">0</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">geom =</span> <span class="st">&quot;line&quot;</span>, <span class="dt">fun =</span> dnorm) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Standardized residuals&quot;</span>,
                     <span class="dt">breaks =</span> <span class="op">-</span><span class="dv">3</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>))</code></pre></div>
<p><img src="probability_files/figure-html/unnamed-chunk-55-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(err, <span class="kw">aes</span>(<span class="dt">sample =</span> err_std)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">slope =</span> <span class="dv">1</span>, <span class="dt">color =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_qq</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_fixed</span>(<span class="dt">ratio =</span> <span class="dv">1</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;Sample quantiles&quot;</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Theoretical quantiles&quot;</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>))</code></pre></div>
<p><img src="probability_files/figure-html/unnamed-chunk-56-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Alternatively, you can use the <code>augment</code> function from <strong>broom</strong> which returns the residuals for each observation in the <code>.resid</code> column.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">augment</span>(fit1) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">.resid_z =</span> .resid <span class="op">/</span><span class="st"> </span><span class="kw">sd</span>(.resid)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> .resid_z)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">y =</span> ..density..),
                 <span class="dt">binwidth =</span> <span class="dv">1</span>, <span class="dt">boundary =</span> <span class="dv">0</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_function</span>(<span class="dt">geom =</span> <span class="st">&quot;line&quot;</span>, <span class="dt">fun =</span> dnorm) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Standardized residuals&quot;</span>,
                     <span class="dt">breaks =</span> <span class="op">-</span><span class="dv">3</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="op">-</span><span class="dv">3</span>, <span class="dv">3</span>))</code></pre></div>
<p><img src="probability_files/figure-html/unnamed-chunk-57-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Obama’s vote shares in 2008 and 2012.</p>
<p>Standard deviation of errors:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">err_sd &lt;-<span class="st"> </span><span class="kw">sd</span>(<span class="kw">resid</span>(fit1))</code></pre></div>
<p>Probability of having a larger vote in California in 2012 than in 2008?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">CA_<span class="dv">2008</span> &lt;-<span class="st"> </span><span class="kw">filter</span>(pres, state <span class="op">==</span><span class="st"> &quot;CA&quot;</span>)<span class="op">$</span>Obama_2008_z</code></pre></div>
<p>The predicted value of 2012 vote share can be calculated manually with <span class="math inline">\(\hat{beta} \times x\)</span>,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">CA_mean_<span class="dv">2012</span> &lt;-<span class="st"> </span>CA_<span class="dv">2008</span> <span class="op">*</span><span class="st"> </span><span class="kw">coef</span>(fit1)[<span class="st">&quot;Obama_2008_z&quot;</span>]
CA_mean_<span class="dv">2012</span>
<span class="co">#&gt; Obama_2008_z </span>
<span class="co">#&gt;        0.858</span></code></pre></div>
<p>or calculated using the predict function with the <code>newdata</code> argument providing any specific values to calculate?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">predict</span>(fit1, <span class="dt">newdata =</span> <span class="kw">tibble</span>(<span class="dt">Obama_2008_z =</span> CA_<span class="dv">2008</span>))
<span class="co">#&gt;     1 </span>
<span class="co">#&gt; 0.858</span></code></pre></div>
<p>Now calculate</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">pnorm</span>(CA_<span class="dv">2008</span>, <span class="dt">mean =</span> CA_mean_<span class="dv">2012</span>, <span class="dt">sd =</span> err_sd,
      <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)
<span class="co">#&gt; [1] 0.468</span></code></pre></div>
<p>We can generalize the previous code to calculate the probability that Obama would exceed his 2008 vote to all states:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">pres_gt_<span class="dv">2008</span> &lt;-<span class="st"> </span><span class="kw">augment</span>(fit1) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">p_greater =</span> <span class="kw">pnorm</span>(Obama_2008_z, <span class="dt">mean =</span> .fitted, <span class="dt">sd =</span> err_sd,
                           <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>))</code></pre></div>
<p>Plotting these results, we can observe regression to the mean. States with larger (smaller) 2008 vote shares had a lower (higher) probability that the 2012 vote share will exceed them.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(pres_gt_<span class="dv">2008</span>, <span class="kw">aes</span>(<span class="dt">x =</span> Obama_2008_z, <span class="dt">y =</span> p_greater)) <span class="op">+</span>
<span class="st">  </span>modelr<span class="op">::</span><span class="kw">geom_ref_line</span>(<span class="dt">h =</span> <span class="fl">0.5</span>) <span class="op">+</span>
<span class="st">  </span>modelr<span class="op">::</span><span class="kw">geom_ref_line</span>(<span class="dt">v =</span> <span class="dv">0</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Standardized vote share of Obama (2008)&quot;</span>,
       <span class="dt">y =</span> <span class="st">&quot;Pr. 2012 vote share greater than 2008&quot;</span>)</code></pre></div>
<p><img src="probability_files/figure-html/unnamed-chunk-64-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="expectation-and-variance" class="section level3">
<h3><span class="header-section-number">6.3.4</span> Expectation and Variance</h3>
<p>Theoretical and actual sample variable of a set of Bernoulli draws:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">p &lt;-<span class="st"> </span><span class="fl">0.5</span>
<span class="co"># theretical variance</span>
p <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p)
<span class="co">#&gt; [1] 0.25</span>
<span class="co"># a sample</span>
y &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">size =</span> <span class="dv">1000</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>, <span class="dt">prob =</span> <span class="kw">c</span>(p, <span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p))
<span class="co"># the sample variance of that sample</span>
<span class="kw">var</span>(y)
<span class="co">#&gt; [1] 0.25</span></code></pre></div>
</div>
<div id="predicting-election-outcomes-with-uncertainty-1" class="section level3">
<h3><span class="header-section-number">6.3.5</span> Predicting Election Outcomes with Uncertainty</h3>
<p>Load 2008 Presidential Election data:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(<span class="st">&quot;pres08&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;qss&quot;</span>)
pres08 &lt;-<span class="st"> </span><span class="kw">mutate</span>(pres08, <span class="dt">p =</span> Obama <span class="op">/</span><span class="st"> </span>(Obama <span class="op">+</span><span class="st"> </span>McCain))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_election &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">n =</span> <span class="dv">1000</span>) {
  n_states &lt;-<span class="st"> </span><span class="kw">nrow</span>(x)
  <span class="co"># samples the number of votes for Obama</span>
  <span class="kw">mutate</span>(x,
         <span class="dt">draws =</span> <span class="kw">rbinom</span>(n_states, <span class="dt">size =</span> <span class="op">!!</span>n, <span class="dt">prob =</span> p),
         <span class="dt">obama_EV =</span> EV <span class="op">*</span><span class="st"> </span>(draws <span class="op">&gt;</span><span class="st"> </span>(<span class="op">!!</span>n <span class="op">/</span><span class="st"> </span><span class="dv">2</span>))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">pluck</span>(<span class="st">&quot;obama_EV&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">sum</span>()
}</code></pre></div>
<p>This function returns the electoral votes for Obama for a single simulation:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sim_election</span>(pres08)
<span class="co">#&gt; [1] 353</span></code></pre></div>
<p>Run this simulation <code>sims</code> times, saving the electoral votes of Obama in each simulation:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sims &lt;-<span class="st"> </span><span class="dv">10000</span>
Obama_EV_sims &lt;-<span class="st"> </span><span class="kw">map_dbl</span>(<span class="kw">seq_len</span>(sims), <span class="op">~</span><span class="st"> </span><span class="kw">sim_election</span>(pres08))</code></pre></div>
<p>Obama’s actual electoral value</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">OBAMA_EV &lt;-<span class="st"> </span><span class="dv">364</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;glue&quot;</span>)
<span class="kw">ggplot</span>(<span class="kw">tibble</span>(<span class="dt">Obama_EV =</span> Obama_EV_sims),
       <span class="kw">aes</span>(<span class="dt">x =</span> Obama_EV, <span class="dt">y =</span> ..density..)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">10</span>, <span class="dt">boundary =</span> <span class="dv">0</span>, <span class="dt">fill =</span> <span class="st">&quot;gray60&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> OBAMA_EV, <span class="dt">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dt">x =</span> OBAMA_EV <span class="op">+</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">y =</span> <span class="fl">0.02</span>,
           <span class="dt">label =</span> <span class="kw">glue</span>(<span class="st">&quot;Obama&#39;s 2008 EV = {OBAMA_EV}&quot;</span>), <span class="dt">hjust =</span> <span class="dv">0</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Obama&#39;s Electoral College Votes&quot;</span>,
                     <span class="dt">breaks =</span> <span class="kw">seq</span>(<span class="dv">300</span>, <span class="dv">400</span>, <span class="dt">by =</span> <span class="dv">20</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;Density&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Prediction of election outcomes&quot;</span>)</code></pre></div>
<p><img src="probability_files/figure-html/unnamed-chunk-70-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Summarize the simulations:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(Obama_EV_sims)
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;     289     340     353     352     364     398</span></code></pre></div>
<p>Compare theoretical and simulation means:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># simulation EV</span>
<span class="kw">mean</span>(Obama_EV_sims)
<span class="co">#&gt; [1] 352</span>
<span class="co"># theoretical</span>
n &lt;-<span class="st"> </span><span class="dv">1000</span>
pres08 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Obama_EV =</span> EV <span class="op">*</span><span class="st"> </span><span class="kw">pbinom</span>(n <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">size =</span> n, <span class="dt">prob =</span> p,
                                <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Obama_EV =</span> <span class="kw">sum</span>(Obama_EV))
<span class="co">#&gt;   Obama_EV</span>
<span class="co">#&gt; 1      352</span></code></pre></div>
<p>Compare theoretical and simulation variances:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># simulation variance</span>
<span class="kw">var</span>(Obama_EV_sims)
<span class="co">#&gt; [1] 269</span>
<span class="co"># theoretical variance</span>
Obama_EV_var &lt;-<span class="st"> </span>pres08 <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">pb =</span> <span class="kw">pbinom</span>(n <span class="op">/</span><span class="st"> </span><span class="dv">2</span>, <span class="dt">size =</span> n, <span class="dt">prob =</span> p, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>),
         <span class="dt">EV_var =</span> pb <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>pb) <span class="op">*</span><span class="st"> </span>EV <span class="op">^</span><span class="st"> </span><span class="dv">2</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">EV_var =</span> <span class="kw">sum</span>(EV_var)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">pluck</span>(<span class="st">&quot;EV_var&quot;</span>)
Obama_EV_var
<span class="co">#&gt; [1] 269</span></code></pre></div>
<p>and standard deviations</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># sim</span>
<span class="kw">sd</span>(Obama_EV_sims)
<span class="co">#&gt; [1] 16.4</span>
<span class="co"># theoretical</span>
<span class="kw">sqrt</span>(Obama_EV_var)
<span class="co">#&gt; [1] 16.4</span></code></pre></div>
</div>
</div>
<div id="large-sample-theorems" class="section level2">
<h2><span class="header-section-number">6.4</span> Large Sample Theorems</h2>
<div id="law-of-large-numbers" class="section level3">
<h3><span class="header-section-number">6.4.1</span> Law of Large Numbers</h3>
<p>Put the simulation number, <code>x</code> and <code>mean</code> in a tibble:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sims &lt;-<span class="st"> </span><span class="dv">1000</span>
p &lt;-<span class="st"> </span><span class="fl">0.2</span>
size &lt;-<span class="st"> </span><span class="dv">10</span>
lln_binom &lt;-<span class="st"> </span><span class="kw">tibble</span>(
  <span class="dt">n =</span> <span class="kw">seq_len</span>(sims),
  <span class="dt">x =</span> <span class="kw">rbinom</span>(sims, <span class="dt">prob =</span> p, <span class="dt">size =</span> size),
  <span class="dt">mean =</span> <span class="kw">cumsum</span>(x) <span class="op">/</span><span class="st"> </span>n,
  <span class="dt">distrib =</span> <span class="kw">str_c</span>(<span class="st">&quot;Binomial(&quot;</span>, size, <span class="st">&quot;, &quot;</span>, p, <span class="st">&quot;)&quot;</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lln_unif &lt;-
<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">n =</span> <span class="kw">seq_len</span>(sims),
        <span class="dt">x =</span> <span class="kw">runif</span>(sims),
        <span class="dt">mean =</span> <span class="kw">cumsum</span>(x) <span class="op">/</span><span class="st"> </span>n,
        <span class="dt">distrib =</span> <span class="kw">str_c</span>(<span class="st">&quot;Uniform(0, 1)&quot;</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">true_means &lt;-
<span class="st">  </span><span class="kw">tribble</span>(<span class="op">~</span>distrib, <span class="op">~</span>mean,
          <span class="st">&quot;Uniform(0, 1)&quot;</span>, <span class="fl">0.5</span>,
          <span class="kw">str_c</span>(<span class="st">&quot;Binomial(&quot;</span>, size, <span class="st">&quot;, &quot;</span>, p, <span class="st">&quot;)&quot;</span>), size <span class="op">*</span><span class="st"> </span>p)

<span class="kw">ggplot</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_hline</span>(<span class="kw">aes</span>(<span class="dt">yintercept =</span> mean), <span class="dt">data =</span> true_means,
             <span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> n, <span class="dt">y =</span> mean),
            <span class="dt">data =</span> <span class="kw">bind_rows</span>(lln_binom, lln_unif)) <span class="op">+</span>
<span class="st">  </span><span class="kw">facet_grid</span>(distrib <span class="op">~</span><span class="st"> </span>., <span class="dt">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Sample Size&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Sample Mean&quot;</span>)</code></pre></div>
<p><img src="probability_files/figure-html/plot_lln_sim_unif-1.png" width="70%" style="display: block; margin: auto;" /></p>
</div>
<div id="central-limit-theorem" class="section level3">
<h3><span class="header-section-number">6.4.2</span> Central Limit Theorem</h3>
<p>The population mean of the binomial distribution is <span class="math inline">\(\mu = p n\)</span> and the variance is <span class="math inline">\(\sigma^2 = p (1 - p) n\)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sims &lt;-<span class="st"> </span><span class="dv">1000</span>
n_samp &lt;-<span class="st"> </span><span class="dv">1000</span></code></pre></div>
<p>Write functions to calculate the mean of a binomial distribution with size, <code>size</code>, and probability, <code>p</code>,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">binom_mean &lt;-<span class="st"> </span><span class="cf">function</span>(size, p) {
  size <span class="op">*</span><span class="st"> </span>p
}</code></pre></div>
<p>variance of a binomial distribution,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">binom_var &lt;-<span class="st"> </span><span class="cf">function</span>(size, p) {
  size <span class="op">*</span><span class="st"> </span>p <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p)
}</code></pre></div>
<p>Write a function that takes <code>n_samp</code> samples from a binomial distribution with size, <code>size</code>, and probability of success, <code>p</code>, and returns a data frame with the z-score of the sample distribution:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_binom_clt &lt;-<span class="st"> </span><span class="cf">function</span>(n_samp, size, p) {
  x &lt;-<span class="st"> </span><span class="kw">rbinom</span>(n_samp, <span class="dt">prob =</span> p, <span class="dt">size =</span> size)
  z &lt;-<span class="st"> </span>(<span class="kw">mean</span>(x) <span class="op">-</span><span class="st"> </span><span class="kw">binom_mean</span>(size, p)) <span class="op">/</span>
<span class="st">    </span><span class="kw">sqrt</span>(<span class="kw">binom_var</span>(size, p) <span class="op">/</span><span class="st"> </span>n_samp)
  <span class="kw">tibble</span>(<span class="dt">distrib =</span> <span class="kw">str_c</span>(<span class="st">&quot;Binomial(&quot;</span>, p, <span class="st">&quot;, &quot;</span>, size, <span class="st">&quot;)&quot;</span>),
         <span class="dt">z =</span> z)
}</code></pre></div>
<p>For the uniform distribution, we need a function to calculate the mean of a uniform distribution,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">unif_mean &lt;-<span class="st"> </span><span class="cf">function</span>(min, max) {
  <span class="fl">0.5</span> <span class="op">*</span><span class="st"> </span>(min <span class="op">+</span><span class="st"> </span>max)
}</code></pre></div>
<p>variance of a uniform distribution,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">unif_var &lt;-<span class="st"> </span><span class="cf">function</span>(min, max) {
  (<span class="dv">1</span> <span class="op">/</span><span class="st"> </span><span class="dv">12</span>) <span class="op">*</span><span class="st"> </span>(max <span class="op">-</span><span class="st"> </span>min) <span class="op">^</span><span class="st"> </span><span class="dv">2</span>
}</code></pre></div>
<p>and a function to perform the CLT simulation,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sim_unif_clt &lt;-<span class="st"> </span><span class="cf">function</span>(n_samp, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="dv">1</span>) {
  x &lt;-<span class="st"> </span><span class="kw">runif</span>(n_samp, <span class="dt">min =</span> min, <span class="dt">max =</span> max)
  z &lt;-<span class="st"> </span>(<span class="kw">mean</span>(x) <span class="op">-</span><span class="st"> </span><span class="kw">unif_mean</span>(min, max)) <span class="op">/</span>
<span class="st">    </span><span class="kw">sqrt</span>(<span class="kw">unif_var</span>(min, max) <span class="op">/</span><span class="st"> </span>n_samp)
  <span class="kw">tibble</span>(<span class="dt">distrib =</span> <span class="kw">str_c</span>(<span class="st">&quot;Uniform(&quot;</span>, min, <span class="st">&quot;, &quot;</span>, max, <span class="st">&quot;)&quot;</span>),
         <span class="dt">z =</span> z)
}</code></pre></div>
<p>Since we will calculate this for <code>n_samp = 1000</code> and <code>n_samp</code>, we might as well write a function for it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">clt_plot &lt;-<span class="st"> </span><span class="cf">function</span>(n_samp) {
  <span class="kw">bind_rows</span>(<span class="kw">map_df</span>(<span class="kw">seq_len</span>(sims), <span class="op">~</span><span class="st"> </span><span class="kw">sim_binom_clt</span>(n_samp, size, p)),
            <span class="kw">map_df</span>(<span class="kw">seq_len</span>(sims), <span class="op">~</span><span class="st"> </span><span class="kw">sim_unif_clt</span>(n_samp))) <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> z)) <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_density</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">geom_rug</span>() <span class="op">+</span>
<span class="st">    </span><span class="kw">stat_function</span>(<span class="dt">fun =</span> dnorm, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="op">+</span>
<span class="st">    </span><span class="kw">facet_grid</span>(distrib <span class="op">~</span><span class="st"> </span>.) <span class="op">+</span>
<span class="st">    </span><span class="kw">ggtitle</span>(<span class="kw">str_c</span>(<span class="st">&quot;Sample size = &quot;</span>, n_samp))
}
<span class="kw">clt_plot</span>(<span class="dv">1000</span>)
<span class="kw">clt_plot</span>(<span class="dv">100</span>)</code></pre></div>
<p><img src="probability_files/figure-html/clt_plot-1.png" width="70%" style="display: block; margin: auto;" /><img src="probability_files/figure-html/clt_plot-2.png" width="70%" style="display: block; margin: auto;" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="discovery.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="uncertainty.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jrnold/qss-tidy/edit/master/probability.Rmd",
"text": "Edit"
},
"download": ["qss-tidy.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
