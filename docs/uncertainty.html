<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Quantitive Social Science: The R Tidyverse Code</title>
  <meta name="description" content="This supplement for Kosuke Imai’s “Quantitative Social Science: An Introduction” contains Tidyverse R code versions of the code in the original text.">
  <meta name="generator" content="bookdown 0.7.1 and GitBook 2.6.7">

  <meta property="og:title" content="Quantitive Social Science: The R Tidyverse Code" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://jrnold.github.io/qss-tidy" />
  
  <meta property="og:description" content="This supplement for Kosuke Imai’s “Quantitative Social Science: An Introduction” contains Tidyverse R code versions of the code in the original text." />
  <meta name="github-repo" content="jrnold/qss-tidy" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Quantitive Social Science: The R Tidyverse Code" />
  
  <meta name="twitter:description" content="This supplement for Kosuke Imai’s “Quantitative Social Science: An Introduction” contains Tidyverse R code versions of the code in the original text." />
  

<meta name="author" content="Jeffrey B. Arnold">


<meta name="date" content="2018-02-26">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="probability.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">QSS Tidyverse Code</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#colophon"><i class="fa fa-check"></i>Colophon</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="" data-path="introduction.html"><a href="introduction.html#prerequisites"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#overview-of-the-book"><i class="fa fa-check"></i><b>1.1</b> Overview of the Book</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#how-to-use-the-book"><i class="fa fa-check"></i><b>1.2</b> How to use the Book</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#introduction-to-r"><i class="fa fa-check"></i><b>1.3</b> Introduction to R</a><ul>
<li class="chapter" data-level="1.3.1" data-path="introduction.html"><a href="introduction.html#arithmetic-operations"><i class="fa fa-check"></i><b>1.3.1</b> Arithmetic Operations</a></li>
<li class="chapter" data-level="1.3.2" data-path="introduction.html"><a href="introduction.html#objects"><i class="fa fa-check"></i><b>1.3.2</b> Objects</a></li>
<li class="chapter" data-level="1.3.3" data-path="introduction.html"><a href="introduction.html#vectors"><i class="fa fa-check"></i><b>1.3.3</b> Vectors</a></li>
<li class="chapter" data-level="1.3.4" data-path="introduction.html"><a href="introduction.html#functions"><i class="fa fa-check"></i><b>1.3.4</b> Functions</a></li>
<li class="chapter" data-level="1.3.5" data-path="introduction.html"><a href="introduction.html#data-files"><i class="fa fa-check"></i><b>1.3.5</b> Data Files</a></li>
<li class="chapter" data-level="1.3.6" data-path="introduction.html"><a href="introduction.html#saving-objects"><i class="fa fa-check"></i><b>1.3.6</b> Saving Objects</a></li>
<li class="chapter" data-level="1.3.7" data-path="introduction.html"><a href="introduction.html#programming-and-learning-tips"><i class="fa fa-check"></i><b>1.3.7</b> Programming and Learning Tips</a></li>
<li class="chapter" data-level="1.3.8" data-path="introduction.html"><a href="introduction.html#style-guide"><i class="fa fa-check"></i><b>1.3.8</b> Style Guide</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="causality.html"><a href="causality.html"><i class="fa fa-check"></i><b>2</b> Causality</a><ul>
<li class="chapter" data-level="" data-path="causality.html"><a href="causality.html#prerequisites-1"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="2.1" data-path="causality.html"><a href="causality.html#racial-discrimination-in-the-labor-market"><i class="fa fa-check"></i><b>2.1</b> Racial Discrimination in the Labor Market</a></li>
<li class="chapter" data-level="2.2" data-path="causality.html"><a href="causality.html#subsetting-data-in-r"><i class="fa fa-check"></i><b>2.2</b> Subsetting Data in R</a><ul>
<li class="chapter" data-level="2.2.1" data-path="causality.html"><a href="causality.html#subsetting"><i class="fa fa-check"></i><b>2.2.1</b> Subsetting</a></li>
<li class="chapter" data-level="2.2.2" data-path="causality.html"><a href="causality.html#simple-conditional-statements"><i class="fa fa-check"></i><b>2.2.2</b> Simple conditional statements</a></li>
<li class="chapter" data-level="2.2.3" data-path="causality.html"><a href="causality.html#factor-variables"><i class="fa fa-check"></i><b>2.2.3</b> Factor Variables</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="causality.html"><a href="causality.html#causal-affects-and-the-counterfactual"><i class="fa fa-check"></i><b>2.3</b> Causal Affects and the Counterfactual</a></li>
<li class="chapter" data-level="2.4" data-path="causality.html"><a href="causality.html#observational-studies"><i class="fa fa-check"></i><b>2.4</b> Observational Studies</a><ul>
<li class="chapter" data-level="2.4.1" data-path="causality.html"><a href="causality.html#confounding-bias"><i class="fa fa-check"></i><b>2.4.1</b> Confounding Bias</a></li>
<li class="chapter" data-level="2.4.2" data-path="causality.html"><a href="causality.html#before-and-after-and-difference-in-difference-designs"><i class="fa fa-check"></i><b>2.4.2</b> Before and After and Difference-in-Difference Designs</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="causality.html"><a href="causality.html#descriptive-statistics-for-a-single-variable"><i class="fa fa-check"></i><b>2.5</b> Descriptive Statistics for a Single Variable</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="measurement.html"><a href="measurement.html"><i class="fa fa-check"></i><b>3</b> Measurement</a><ul>
<li class="chapter" data-level="" data-path="measurement.html"><a href="measurement.html#prerequisites-2"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="3.1" data-path="measurement.html"><a href="measurement.html#measuring-civilian-victimization-during-wartime"><i class="fa fa-check"></i><b>3.1</b> Measuring Civilian Victimization during Wartime</a></li>
<li class="chapter" data-level="3.2" data-path="measurement.html"><a href="measurement.html#handling-missing-data-in-r"><i class="fa fa-check"></i><b>3.2</b> Handling Missing Data in R</a></li>
<li class="chapter" data-level="3.3" data-path="measurement.html"><a href="measurement.html#visualizing-the-univariate-distribution"><i class="fa fa-check"></i><b>3.3</b> Visualizing the Univariate Distribution</a><ul>
<li class="chapter" data-level="3.3.1" data-path="measurement.html"><a href="measurement.html#barplot"><i class="fa fa-check"></i><b>3.3.1</b> Barplot</a></li>
<li class="chapter" data-level="3.3.2" data-path="measurement.html"><a href="measurement.html#histogram"><i class="fa fa-check"></i><b>3.3.2</b> Histogram</a></li>
<li class="chapter" data-level="3.3.3" data-path="measurement.html"><a href="measurement.html#boxplot"><i class="fa fa-check"></i><b>3.3.3</b> Boxplot</a></li>
<li class="chapter" data-level="3.3.4" data-path="measurement.html"><a href="measurement.html#printing-and-saving-graphics"><i class="fa fa-check"></i><b>3.3.4</b> Printing and saving graphics</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="measurement.html"><a href="measurement.html#survey-sampling"><i class="fa fa-check"></i><b>3.4</b> Survey Sampling</a><ul>
<li class="chapter" data-level="3.4.1" data-path="measurement.html"><a href="measurement.html#the-role-of-randomization"><i class="fa fa-check"></i><b>3.4.1</b> The Role of Randomization</a></li>
<li class="chapter" data-level="3.4.2" data-path="measurement.html"><a href="measurement.html#non-response-and-other-sources-of-bias"><i class="fa fa-check"></i><b>3.4.2</b> Non-response and other sources of bias</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="measurement.html"><a href="measurement.html#measuring-political-polarization"><i class="fa fa-check"></i><b>3.5</b> Measuring Political Polarization</a><ul>
<li class="chapter" data-level="3.5.1" data-path="measurement.html"><a href="measurement.html#correlation"><i class="fa fa-check"></i><b>3.5.1</b> Correlation</a></li>
<li class="chapter" data-level="3.5.2" data-path="measurement.html"><a href="measurement.html#quantile-quantile-plot"><i class="fa fa-check"></i><b>3.5.2</b> Quantile-Quantile Plot</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="measurement.html"><a href="measurement.html#clustering"><i class="fa fa-check"></i><b>3.6</b> Clustering</a><ul>
<li class="chapter" data-level="3.6.1" data-path="measurement.html"><a href="measurement.html#matrices"><i class="fa fa-check"></i><b>3.6.1</b> Matrices</a></li>
<li class="chapter" data-level="3.6.2" data-path="measurement.html"><a href="measurement.html#lists"><i class="fa fa-check"></i><b>3.6.2</b> Lists</a></li>
<li class="chapter" data-level="3.6.3" data-path="measurement.html"><a href="measurement.html#k-means-algorithms"><i class="fa fa-check"></i><b>3.6.3</b> k-means algorithms</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="prediction.html"><a href="prediction.html"><i class="fa fa-check"></i><b>4</b> Prediction</a><ul>
<li class="chapter" data-level="" data-path="prediction.html"><a href="prediction.html#prerequisites-3"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="4.1" data-path="prediction.html"><a href="prediction.html#predicting-election-outcomes"><i class="fa fa-check"></i><b>4.1</b> Predicting Election Outcomes</a><ul>
<li class="chapter" data-level="4.1.1" data-path="prediction.html"><a href="prediction.html#loops-in-r"><i class="fa fa-check"></i><b>4.1.1</b> Loops in R</a></li>
<li class="chapter" data-level="4.1.2" data-path="prediction.html"><a href="prediction.html#general-conditional-statements-in-r"><i class="fa fa-check"></i><b>4.1.2</b> General Conditional Statements in R</a></li>
<li class="chapter" data-level="4.1.3" data-path="prediction.html"><a href="prediction.html#poll-predictions"><i class="fa fa-check"></i><b>4.1.3</b> Poll Predictions</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="prediction.html"><a href="prediction.html#linear-regression"><i class="fa fa-check"></i><b>4.2</b> Linear Regression</a><ul>
<li class="chapter" data-level="4.2.1" data-path="prediction.html"><a href="prediction.html#facial-appearance-and-election-outcomes"><i class="fa fa-check"></i><b>4.2.1</b> Facial Appearance and Election Outcomes</a></li>
<li class="chapter" data-level="4.2.2" data-path="prediction.html"><a href="prediction.html#correlation-and-scatter-plots"><i class="fa fa-check"></i><b>4.2.2</b> Correlation and Scatter Plots</a></li>
<li class="chapter" data-level="4.2.3" data-path="prediction.html"><a href="prediction.html#least-squares"><i class="fa fa-check"></i><b>4.2.3</b> Least Squares</a></li>
<li class="chapter" data-level="4.2.4" data-path="prediction.html"><a href="prediction.html#regression-towards-the-mean"><i class="fa fa-check"></i><b>4.2.4</b> Regression towards the mean</a></li>
<li class="chapter" data-level="4.2.5" data-path="prediction.html"><a href="prediction.html#merging-data-sets-in-r"><i class="fa fa-check"></i><b>4.2.5</b> Merging Data Sets in R</a></li>
<li class="chapter" data-level="4.2.6" data-path="prediction.html"><a href="prediction.html#model-fit"><i class="fa fa-check"></i><b>4.2.6</b> Model Fit</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="prediction.html"><a href="prediction.html#regression-and-causation"><i class="fa fa-check"></i><b>4.3</b> Regression and Causation</a><ul>
<li class="chapter" data-level="4.3.1" data-path="prediction.html"><a href="prediction.html#randomized-experiments"><i class="fa fa-check"></i><b>4.3.1</b> Randomized Experiments</a></li>
<li class="chapter" data-level="4.3.2" data-path="prediction.html"><a href="prediction.html#regression-with-multiple-predictors"><i class="fa fa-check"></i><b>4.3.2</b> Regression with multiple predictors</a></li>
<li class="chapter" data-level="4.3.3" data-path="prediction.html"><a href="prediction.html#heterogeneous-treatment-effects"><i class="fa fa-check"></i><b>4.3.3</b> Heterogeneous Treatment Effects</a></li>
<li class="chapter" data-level="4.3.4" data-path="prediction.html"><a href="prediction.html#regression-discontinuity-design"><i class="fa fa-check"></i><b>4.3.4</b> Regression Discontinuity Design</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="discovery.html"><a href="discovery.html"><i class="fa fa-check"></i><b>5</b> Discovery</a><ul>
<li class="chapter" data-level="5.1" data-path="discovery.html"><a href="discovery.html#textual-data"><i class="fa fa-check"></i><b>5.1</b> Textual data</a><ul>
<li class="chapter" data-level="" data-path="discovery.html"><a href="discovery.html#prerequisites-4"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="5.1.1" data-path="discovery.html"><a href="discovery.html#document-term-matrix"><i class="fa fa-check"></i><b>5.1.1</b> Document-Term Matrix</a></li>
<li class="chapter" data-level="5.1.2" data-path="discovery.html"><a href="discovery.html#topic-discovery"><i class="fa fa-check"></i><b>5.1.2</b> Topic Discovery</a></li>
<li class="chapter" data-level="5.1.3" data-path="discovery.html"><a href="discovery.html#authorship-prediction"><i class="fa fa-check"></i><b>5.1.3</b> Authorship Prediction</a></li>
<li class="chapter" data-level="5.1.4" data-path="discovery.html"><a href="discovery.html#cross-validation"><i class="fa fa-check"></i><b>5.1.4</b> Cross-Validation</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="discovery.html"><a href="discovery.html#network-data"><i class="fa fa-check"></i><b>5.2</b> Network data</a><ul>
<li class="chapter" data-level="" data-path="discovery.html"><a href="discovery.html#prerequisites-5"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="5.2.1" data-path="discovery.html"><a href="discovery.html#twitter-following-network"><i class="fa fa-check"></i><b>5.2.1</b> Twitter Following Network</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="discovery.html"><a href="discovery.html#spatial-data"><i class="fa fa-check"></i><b>5.3</b> Spatial Data</a><ul>
<li class="chapter" data-level="" data-path="discovery.html"><a href="discovery.html#prerequisites-6"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="5.3.1" data-path="discovery.html"><a href="discovery.html#spatial-data-in-r"><i class="fa fa-check"></i><b>5.3.1</b> Spatial Data in R</a></li>
<li class="chapter" data-level="5.3.2" data-path="discovery.html"><a href="discovery.html#colors-in-r"><i class="fa fa-check"></i><b>5.3.2</b> Colors in R</a></li>
<li class="chapter" data-level="5.3.3" data-path="discovery.html"><a href="discovery.html#united-states-presidential-elections"><i class="fa fa-check"></i><b>5.3.3</b> United States Presidential Elections</a></li>
<li class="chapter" data-level="5.3.4" data-path="discovery.html"><a href="discovery.html#expansion-of-walmart"><i class="fa fa-check"></i><b>5.3.4</b> Expansion of Walmart</a></li>
<li class="chapter" data-level="5.3.5" data-path="discovery.html"><a href="discovery.html#animation-in-r"><i class="fa fa-check"></i><b>5.3.5</b> Animation in R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="probability.html"><a href="probability.html"><i class="fa fa-check"></i><b>6</b> Probability</a><ul>
<li class="chapter" data-level="" data-path="probability.html"><a href="probability.html#prerequisites-7"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="6.1" data-path="probability.html"><a href="probability.html#probability-1"><i class="fa fa-check"></i><b>6.1</b> Probability</a><ul>
<li class="chapter" data-level="6.1.1" data-path="probability.html"><a href="probability.html#frequentist-vs.bayesian"><i class="fa fa-check"></i><b>6.1.1</b> Frequentist vs. Bayesian</a></li>
<li class="chapter" data-level="6.1.2" data-path="probability.html"><a href="probability.html#definition-and-axioms"><i class="fa fa-check"></i><b>6.1.2</b> Definition and Axioms</a></li>
<li class="chapter" data-level="6.1.3" data-path="probability.html"><a href="probability.html#permutations"><i class="fa fa-check"></i><b>6.1.3</b> Permutations</a></li>
<li class="chapter" data-level="6.1.4" data-path="probability.html"><a href="probability.html#sampling-without-replacement"><i class="fa fa-check"></i><b>6.1.4</b> Sampling without replacement</a></li>
<li class="chapter" data-level="6.1.5" data-path="probability.html"><a href="probability.html#combinations"><i class="fa fa-check"></i><b>6.1.5</b> Combinations</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="probability.html"><a href="probability.html#conditional-probability"><i class="fa fa-check"></i><b>6.2</b> Conditional Probability</a><ul>
<li class="chapter" data-level="6.2.1" data-path="probability.html"><a href="probability.html#conditional-marginal-and-joint-probabilities"><i class="fa fa-check"></i><b>6.2.1</b> Conditional, Marginal, and Joint Probabilities</a></li>
<li class="chapter" data-level="6.2.2" data-path="probability.html"><a href="probability.html#independence"><i class="fa fa-check"></i><b>6.2.2</b> Independence</a></li>
<li class="chapter" data-level="6.2.3" data-path="probability.html"><a href="probability.html#bayes-rule"><i class="fa fa-check"></i><b>6.2.3</b> Bayes’ Rule</a></li>
<li class="chapter" data-level="6.2.4" data-path="probability.html"><a href="probability.html#predicting-race-using-surname-and-residence-location"><i class="fa fa-check"></i><b>6.2.4</b> Predicting Race Using Surname and Residence Location</a></li>
<li class="chapter" data-level="6.2.5" data-path="probability.html"><a href="probability.html#predicting-election-outcomes-with-uncertainty"><i class="fa fa-check"></i><b>6.2.5</b> Predicting Election Outcomes with Uncertainty</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="probability.html"><a href="probability.html#random-variables-and-probability-distributions"><i class="fa fa-check"></i><b>6.3</b> Random Variables and Probability Distributions</a><ul>
<li class="chapter" data-level="6.3.1" data-path="probability.html"><a href="probability.html#bernoulli-and-uniform-distributions"><i class="fa fa-check"></i><b>6.3.1</b> Bernoulli and Uniform Distributions</a></li>
<li class="chapter" data-level="6.3.2" data-path="probability.html"><a href="probability.html#binomial-distribution"><i class="fa fa-check"></i><b>6.3.2</b> Binomial distribution</a></li>
<li class="chapter" data-level="6.3.3" data-path="probability.html"><a href="probability.html#normal-distribution"><i class="fa fa-check"></i><b>6.3.3</b> Normal distribution</a></li>
<li class="chapter" data-level="6.3.4" data-path="probability.html"><a href="probability.html#expectation-and-variance"><i class="fa fa-check"></i><b>6.3.4</b> Expectation and Variance</a></li>
<li class="chapter" data-level="6.3.5" data-path="probability.html"><a href="probability.html#predicting-election-outcomes-with-uncertainty-1"><i class="fa fa-check"></i><b>6.3.5</b> Predicting Election Outcomes with Uncertainty</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="probability.html"><a href="probability.html#large-sample-theorems"><i class="fa fa-check"></i><b>6.4</b> Large Sample Theorems</a><ul>
<li class="chapter" data-level="6.4.1" data-path="probability.html"><a href="probability.html#law-of-large-numbers"><i class="fa fa-check"></i><b>6.4.1</b> Law of Large Numbers</a></li>
<li class="chapter" data-level="6.4.2" data-path="probability.html"><a href="probability.html#central-limit-theorem"><i class="fa fa-check"></i><b>6.4.2</b> Central Limit Theorem</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="uncertainty.html"><a href="uncertainty.html"><i class="fa fa-check"></i><b>7</b> Uncertainty</a><ul>
<li class="chapter" data-level="" data-path="uncertainty.html"><a href="uncertainty.html#prerequisites-8"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="7.1" data-path="uncertainty.html"><a href="uncertainty.html#estimation"><i class="fa fa-check"></i><b>7.1</b> Estimation</a><ul>
<li class="chapter" data-level="7.1.1" data-path="uncertainty.html"><a href="uncertainty.html#unbiasedness-and-consistency"><i class="fa fa-check"></i><b>7.1.1</b> Unbiasedness and Consistency</a></li>
<li class="chapter" data-level="7.1.2" data-path="uncertainty.html"><a href="uncertainty.html#standard-error"><i class="fa fa-check"></i><b>7.1.2</b> Standard Error</a></li>
<li class="chapter" data-level="7.1.3" data-path="uncertainty.html"><a href="uncertainty.html#confidence-intervals"><i class="fa fa-check"></i><b>7.1.3</b> Confidence Intervals</a></li>
<li class="chapter" data-level="7.1.4" data-path="uncertainty.html"><a href="uncertainty.html#margin-of-error-and-sample-size-calculation-in-polls"><i class="fa fa-check"></i><b>7.1.4</b> Margin of Error and Sample Size Calculation in Polls</a></li>
<li class="chapter" data-level="7.1.5" data-path="uncertainty.html"><a href="uncertainty.html#analysis-of-randomized-controlled-trials"><i class="fa fa-check"></i><b>7.1.5</b> Analysis of Randomized Controlled Trials</a></li>
<li class="chapter" data-level="7.1.6" data-path="uncertainty.html"><a href="uncertainty.html#analysis-based-on-students-t-distribution"><i class="fa fa-check"></i><b>7.1.6</b> Analysis Based on Student’s t-Distribution</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="uncertainty.html"><a href="uncertainty.html#hypothesis-testing"><i class="fa fa-check"></i><b>7.2</b> Hypothesis Testing</a><ul>
<li class="chapter" data-level="7.2.1" data-path="uncertainty.html"><a href="uncertainty.html#tea-testing-experiment"><i class="fa fa-check"></i><b>7.2.1</b> Tea-Testing Experiment</a></li>
<li class="chapter" data-level="7.2.2" data-path="uncertainty.html"><a href="uncertainty.html#the-general-framework"><i class="fa fa-check"></i><b>7.2.2</b> The General Framework</a></li>
<li class="chapter" data-level="7.2.3" data-path="uncertainty.html"><a href="uncertainty.html#one-sample-tests"><i class="fa fa-check"></i><b>7.2.3</b> One-Sample Tests</a></li>
<li class="chapter" data-level="7.2.4" data-path="uncertainty.html"><a href="uncertainty.html#two-sample-tests"><i class="fa fa-check"></i><b>7.2.4</b> Two-sample tests</a></li>
<li class="chapter" data-level="7.2.5" data-path="uncertainty.html"><a href="uncertainty.html#power-analysis"><i class="fa fa-check"></i><b>7.2.5</b> Power Analysis</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="uncertainty.html"><a href="uncertainty.html#linear-regression-model-with-uncertainty"><i class="fa fa-check"></i><b>7.3</b> Linear Regression Model with Uncertainty</a><ul>
<li class="chapter" data-level="7.3.1" data-path="uncertainty.html"><a href="uncertainty.html#linear-regression-as-a-generative-model"><i class="fa fa-check"></i><b>7.3.1</b> Linear Regression as a Generative Model</a></li>
<li class="chapter" data-level="7.3.2" data-path="uncertainty.html"><a href="uncertainty.html#inference-about-coefficients"><i class="fa fa-check"></i><b>7.3.2</b> Inference about coefficients</a></li>
<li class="chapter" data-level="7.3.3" data-path="uncertainty.html"><a href="uncertainty.html#inference-about-predictions"><i class="fa fa-check"></i><b>7.3.3</b> Inference about predictions</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Quantitive Social Science: The R Tidyverse Code</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="uncertainty" class="section level1">
<h1><span class="header-section-number">7</span> Uncertainty</h1>
<div id="prerequisites-8" class="section level2 unnumbered">
<h2>Prerequisites</h2>
<p>We will use these package in this chapter:</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb417-1" data-line-number="1"><span class="kw">library</span>(<span class="st">&quot;tidyverse&quot;</span>)</a>
<a class="sourceLine" id="cb417-2" data-line-number="2"><span class="kw">library</span>(<span class="st">&quot;forcats&quot;</span>)</a>
<a class="sourceLine" id="cb417-3" data-line-number="3"><span class="kw">library</span>(<span class="st">&quot;lubridate&quot;</span>)</a>
<a class="sourceLine" id="cb417-4" data-line-number="4"><span class="kw">library</span>(<span class="st">&quot;stringr&quot;</span>)</a>
<a class="sourceLine" id="cb417-5" data-line-number="5"><span class="kw">library</span>(<span class="st">&quot;modelr&quot;</span>)</a>
<a class="sourceLine" id="cb417-6" data-line-number="6"><span class="kw">library</span>(<span class="st">&quot;broom&quot;</span>)</a>
<a class="sourceLine" id="cb417-7" data-line-number="7"><span class="kw">library</span>(<span class="st">&quot;purrr&quot;</span>)</a></code></pre></div>
</div>
<div id="estimation" class="section level2">
<h2><span class="header-section-number">7.1</span> Estimation</h2>
<div id="unbiasedness-and-consistency" class="section level3">
<h3><span class="header-section-number">7.1.1</span> Unbiasedness and Consistency</h3>
<p>In these simulations, we draw a sample of size <code>n</code> from normal distributions with means <code>mu0</code> and <code>mu1</code> and standard deviations <code>sd0</code> and <code>sd1</code> respectively,</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb418-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb418-2" data-line-number="2">mu0 &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb418-3" data-line-number="3">sd0 &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb418-4" data-line-number="4">mu1 &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb418-5" data-line-number="5">sd1 &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb418-6" data-line-number="6">smpl &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">id =</span> <span class="kw">seq_len</span>(n),</a>
<a class="sourceLine" id="cb418-7" data-line-number="7">               <span class="co"># Y if not treated</span></a>
<a class="sourceLine" id="cb418-8" data-line-number="8">               <span class="dt">Y0 =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> mu0, <span class="dt">sd =</span> sd0),</a>
<a class="sourceLine" id="cb418-9" data-line-number="9">               <span class="co"># Y if treated</span></a>
<a class="sourceLine" id="cb418-10" data-line-number="10">               <span class="dt">Y1 =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> mu1, <span class="dt">sd =</span> sd1),</a>
<a class="sourceLine" id="cb418-11" data-line-number="11">               <span class="co"># individual treatment effects</span></a>
<a class="sourceLine" id="cb418-12" data-line-number="12">               <span class="dt">tau =</span> Y1 <span class="op">-</span><span class="st"> </span>Y0)</a></code></pre></div>
<p>The SATE is:</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb419-1" data-line-number="1">SATE &lt;-<span class="st"> </span><span class="kw">mean</span>(smpl[[<span class="st">&quot;tau&quot;</span>]])</a>
<a class="sourceLine" id="cb419-2" data-line-number="2">SATE</a>
<a class="sourceLine" id="cb419-3" data-line-number="3"><span class="co">#&gt; [1] 0.952</span></a></code></pre></div>
<p>Simulations of RCTs. Write a function that takes the sample as an input <code>smpl</code>, then randomly assigns the treatment to each individual:</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb420-1" data-line-number="1">sim_treat &lt;-<span class="st"> </span><span class="cf">function</span>(smpl) {</a>
<a class="sourceLine" id="cb420-2" data-line-number="2">  n &lt;-<span class="st"> </span><span class="kw">nrow</span>(smpl)</a>
<a class="sourceLine" id="cb420-3" data-line-number="3">  SATE &lt;-<span class="st"> </span><span class="kw">mean</span>(smpl[[<span class="st">&quot;tau&quot;</span>]])</a>
<a class="sourceLine" id="cb420-4" data-line-number="4">  <span class="co"># indexes of obs receiving treatment</span></a>
<a class="sourceLine" id="cb420-5" data-line-number="5">  idx &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">seq_len</span>(n), <span class="kw">floor</span>(<span class="kw">nrow</span>(smpl) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>), <span class="dt">replace =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb420-6" data-line-number="6">  <span class="co"># treat variable are those receiving treatment, else 0</span></a>
<a class="sourceLine" id="cb420-7" data-line-number="7">  smpl[[<span class="st">&quot;treat&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">seq_len</span>(<span class="kw">nrow</span>(smpl)) <span class="op">%in%</span><span class="st"> </span>idx)</a>
<a class="sourceLine" id="cb420-8" data-line-number="8">  smpl <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb420-9" data-line-number="9"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Y_obs =</span> <span class="kw">if_else</span>(treat <span class="op">==</span><span class="st"> </span>1L, Y1, Y0)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb420-10" data-line-number="10"><span class="st">    </span><span class="kw">group_by</span>(treat) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb420-11" data-line-number="11"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">Y_obs =</span> <span class="kw">mean</span>(Y_obs)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb420-12" data-line-number="12"><span class="st">    </span><span class="kw">spread</span>(treat, Y_obs) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb420-13" data-line-number="13"><span class="st">    </span><span class="kw">rename</span>(<span class="dt">Y1_mean =</span> <span class="st">`</span><span class="dt">1</span><span class="st">`</span>, <span class="dt">Y0_mean =</span> <span class="st">`</span><span class="dt">0</span><span class="st">`</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb420-14" data-line-number="14"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">diff_mean =</span> Y1_mean <span class="op">-</span><span class="st"> </span>Y0_mean,</a>
<a class="sourceLine" id="cb420-15" data-line-number="15">           <span class="dt">est_error =</span> diff_mean <span class="op">-</span><span class="st"> </span>SATE)</a>
<a class="sourceLine" id="cb420-16" data-line-number="16">}</a></code></pre></div>
<p>This returns a data frame with columns: <code>Y0_mean</code> (mean <span class="math inline">\(Y\)</span> for observations not receiving the treatment), <code>Y1_mean</code> (mean <span class="math inline">\(Y\)</span> for observations receiving the treatment), <code>diff</code> (difference in mean values between the two groups), and <code>est_error</code> (difference between the estimated difference and the known SATE):</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb421-1" data-line-number="1"><span class="kw">sim_treat</span>(smpl)</a>
<a class="sourceLine" id="cb421-2" data-line-number="2"><span class="co">#&gt; # A tibble: 1 x 4</span></a>
<a class="sourceLine" id="cb421-3" data-line-number="3"><span class="co">#&gt;   Y0_mean Y1_mean diff_mean est_error</span></a>
<a class="sourceLine" id="cb421-4" data-line-number="4"><span class="co">#&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb421-5" data-line-number="5"><span class="co">#&gt; 1 -0.0570   0.875     0.932   -0.0207</span></a></code></pre></div>
<p>Rerun this function <code>sims</code> times:</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb422-1" data-line-number="1">sims &lt;-<span class="st"> </span><span class="dv">5000</span></a>
<a class="sourceLine" id="cb422-2" data-line-number="2">sate_sims &lt;-<span class="st"> </span><span class="kw">map_df</span>(<span class="kw">seq_len</span>(sims), <span class="op">~</span><span class="st"> </span><span class="kw">sim_treat</span>(smpl))</a>
<a class="sourceLine" id="cb422-3" data-line-number="3"><span class="kw">summary</span>(sate_sims[[<span class="st">&quot;est_error&quot;</span>]])</a>
<a class="sourceLine" id="cb422-4" data-line-number="4"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></a>
<a class="sourceLine" id="cb422-5" data-line-number="5"><span class="co">#&gt;  -0.484  -0.087  -0.002  -0.001   0.085   0.414</span></a></code></pre></div>
<p>Simulate the PATE:</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb423-1" data-line-number="1">PATE &lt;-<span class="st"> </span>mu1 <span class="op">-</span><span class="st"> </span>mu0</a></code></pre></div>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb424-1" data-line-number="1">sim_pate &lt;-<span class="st"> </span><span class="cf">function</span>(n, mu0, mu1, sd0, sd1) {</a>
<a class="sourceLine" id="cb424-2" data-line-number="2">  smpl &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">Y0 =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> mu0, <span class="dt">sd =</span> sd0),</a>
<a class="sourceLine" id="cb424-3" data-line-number="3">                 <span class="dt">Y1 =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> mu1, <span class="dt">sd =</span> sd1),</a>
<a class="sourceLine" id="cb424-4" data-line-number="4">                 <span class="dt">tau =</span> Y1 <span class="op">-</span><span class="st"> </span>Y0)</a>
<a class="sourceLine" id="cb424-5" data-line-number="5">  <span class="co"># indexes of obs receiving treatment</span></a>
<a class="sourceLine" id="cb424-6" data-line-number="6">  idx &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">seq_len</span>(n), <span class="kw">floor</span>(<span class="kw">nrow</span>(smpl) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>), <span class="dt">replace =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb424-7" data-line-number="7">  <span class="co"># treat variable are those receiving treatment, else 0</span></a>
<a class="sourceLine" id="cb424-8" data-line-number="8">  smpl[[<span class="st">&quot;treat&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">seq_len</span>(<span class="kw">nrow</span>(smpl)) <span class="op">%in%</span><span class="st"> </span>idx)</a>
<a class="sourceLine" id="cb424-9" data-line-number="9">  smpl <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb424-10" data-line-number="10"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Y_obs =</span> <span class="kw">if_else</span>(treat <span class="op">==</span><span class="st"> </span>1L, Y1, Y0)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb424-11" data-line-number="11"><span class="st">    </span><span class="kw">group_by</span>(treat) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb424-12" data-line-number="12"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">Y_obs =</span> <span class="kw">mean</span>(Y_obs)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb424-13" data-line-number="13"><span class="st">    </span><span class="kw">spread</span>(treat, Y_obs) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb424-14" data-line-number="14"><span class="st">    </span><span class="kw">rename</span>(<span class="dt">Y1_mean =</span> <span class="st">`</span><span class="dt">1</span><span class="st">`</span>, <span class="dt">Y0_mean =</span> <span class="st">`</span><span class="dt">0</span><span class="st">`</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb424-15" data-line-number="15"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">diff_mean =</span> Y1_mean <span class="op">-</span><span class="st"> </span>Y0_mean,</a>
<a class="sourceLine" id="cb424-16" data-line-number="16">           <span class="dt">est_error =</span> diff_mean <span class="op">-</span><span class="st"> </span>PATE)</a>
<a class="sourceLine" id="cb424-17" data-line-number="17">}</a></code></pre></div>
<p>Example of one simulation</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb425-1" data-line-number="1"><span class="kw">sim_pate</span>(n, mu0, mu1, sd0, sd1)</a>
<a class="sourceLine" id="cb425-2" data-line-number="2"><span class="co">#&gt; # A tibble: 1 x 4</span></a>
<a class="sourceLine" id="cb425-3" data-line-number="3"><span class="co">#&gt;   Y0_mean Y1_mean diff_mean est_error</span></a>
<a class="sourceLine" id="cb425-4" data-line-number="4"><span class="co">#&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb425-5" data-line-number="5"><span class="co">#&gt; 1  -0.109   0.925      1.03    0.0338</span></a></code></pre></div>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb426-1" data-line-number="1">pate_sims &lt;-</a>
<a class="sourceLine" id="cb426-2" data-line-number="2"><span class="st">  </span><span class="kw">map_df</span>(<span class="kw">seq_len</span>(sims), <span class="op">~</span><span class="st"> </span><span class="kw">sim_pate</span>(n, mu0, mu1, sd0, sd1))</a>
<a class="sourceLine" id="cb426-3" data-line-number="3"><span class="kw">summary</span>(pate_sims[[<span class="st">&quot;est_error&quot;</span>]])</a>
<a class="sourceLine" id="cb426-4" data-line-number="4"><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></a>
<a class="sourceLine" id="cb426-5" data-line-number="5"><span class="co">#&gt;  -0.677  -0.135  -0.004  -0.003   0.129   0.853</span></a></code></pre></div>
</div>
<div id="standard-error" class="section level3">
<h3><span class="header-section-number">7.1.2</span> Standard Error</h3>
<p>Plot of the sampling distribution of the difference-in-means estimator:</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb427-1" data-line-number="1"><span class="kw">ggplot</span>(pate_sims, <span class="kw">aes</span>(<span class="dt">x =</span> diff_mean, <span class="dt">y =</span> ..density..)) <span class="op">+</span></a>
<a class="sourceLine" id="cb427-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="fl">0.01</span>, <span class="dt">boundary =</span> <span class="dv">1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb427-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">xintercept =</span> PATE, <span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb427-4" data-line-number="4"><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Sampling distribution&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb427-5" data-line-number="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Difference-in-means estimator&quot;</span>)</a></code></pre></div>
<p><img src="uncertainty_files/figure-html/unnamed-chunk-12-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb428-1" data-line-number="1"><span class="kw">sd</span>(pate_sims[[<span class="st">&quot;diff_mean&quot;</span>]])</a>
<a class="sourceLine" id="cb428-2" data-line-number="2"><span class="co">#&gt; [1] 0.196</span></a></code></pre></div>
<p>Simulate PATE with a standard error:</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb429-1" data-line-number="1">sim_pate_se &lt;-<span class="st"> </span><span class="cf">function</span>(n, mu0, mu1, sd0, sd1) {</a>
<a class="sourceLine" id="cb429-2" data-line-number="2">  <span class="co"># PATE - difference in means</span></a>
<a class="sourceLine" id="cb429-3" data-line-number="3">  PATE &lt;-<span class="st"> </span>mu1 <span class="op">-</span><span class="st"> </span>mu0</a>
<a class="sourceLine" id="cb429-4" data-line-number="4">  <span class="co"># sample</span></a>
<a class="sourceLine" id="cb429-5" data-line-number="5">  smpl &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">Y0 =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> mu0, <span class="dt">sd =</span> sd0),</a>
<a class="sourceLine" id="cb429-6" data-line-number="6">                 <span class="dt">Y1 =</span> <span class="kw">rnorm</span>(n, <span class="dt">mean =</span> mu1, <span class="dt">sd =</span> sd1),</a>
<a class="sourceLine" id="cb429-7" data-line-number="7">                 <span class="dt">tau =</span> Y1 <span class="op">-</span><span class="st"> </span>Y0)</a>
<a class="sourceLine" id="cb429-8" data-line-number="8">  <span class="co"># indexes of obs receiving treatment</span></a>
<a class="sourceLine" id="cb429-9" data-line-number="9">  idx &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">seq_len</span>(n), <span class="kw">floor</span>(<span class="kw">nrow</span>(smpl) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>), <span class="dt">replace =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb429-10" data-line-number="10">  <span class="co"># treat variable are those receiving treatment, else 0</span></a>
<a class="sourceLine" id="cb429-11" data-line-number="11">  smpl[[<span class="st">&quot;treat&quot;</span>]] &lt;-<span class="st"> </span><span class="kw">as.integer</span>(<span class="kw">seq_len</span>(<span class="kw">nrow</span>(smpl)) <span class="op">%in%</span><span class="st"> </span>idx)</a>
<a class="sourceLine" id="cb429-12" data-line-number="12">  <span class="co"># sample</span></a>
<a class="sourceLine" id="cb429-13" data-line-number="13">  smpl <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb429-14" data-line-number="14"><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Y_obs =</span> <span class="kw">if_else</span>(treat <span class="op">==</span><span class="st"> </span>1L, Y1, Y0)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb429-15" data-line-number="15"><span class="st">    </span><span class="kw">group_by</span>(treat) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb429-16" data-line-number="16"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(Y_obs),</a>
<a class="sourceLine" id="cb429-17" data-line-number="17">              <span class="dt">var =</span> <span class="kw">var</span>(Y_obs),</a>
<a class="sourceLine" id="cb429-18" data-line-number="18">              <span class="dt">nobs =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb429-19" data-line-number="19"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">diff_mean =</span> <span class="kw">diff</span>(mean),</a>
<a class="sourceLine" id="cb429-20" data-line-number="20">              <span class="dt">se =</span> <span class="kw">sqrt</span>(<span class="kw">sum</span>(var <span class="op">/</span><span class="st"> </span>nobs)),</a>
<a class="sourceLine" id="cb429-21" data-line-number="21">              <span class="dt">est_error =</span> diff_mean <span class="op">-</span><span class="st"> </span>PATE)</a>
<a class="sourceLine" id="cb429-22" data-line-number="22">}</a></code></pre></div>
<p>Run a single simulation:</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb430-1" data-line-number="1"><span class="kw">sim_pate_se</span>(n, mu0, mu1, sd0, sd1)</a>
<a class="sourceLine" id="cb430-2" data-line-number="2"><span class="co">#&gt; # A tibble: 1 x 3</span></a>
<a class="sourceLine" id="cb430-3" data-line-number="3"><span class="co">#&gt;   diff_mean    se est_error</span></a>
<a class="sourceLine" id="cb430-4" data-line-number="4"><span class="co">#&gt;       &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb430-5" data-line-number="5"><span class="co">#&gt; 1      1.05 0.190    0.0539</span></a></code></pre></div>
<p>Run <code>sims</code> simulations:</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb431-1" data-line-number="1">sims &lt;-<span class="st"> </span><span class="dv">5000</span></a>
<a class="sourceLine" id="cb431-2" data-line-number="2">pate_sims_se &lt;-</a>
<a class="sourceLine" id="cb431-3" data-line-number="3"><span class="st">  </span><span class="kw">map_df</span>(<span class="kw">seq_len</span>(sims), <span class="op">~</span><span class="st"> </span><span class="kw">sim_pate_se</span>(n, mu0, mu1, sd0, sd1))</a></code></pre></div>
<p>Standard deviation of difference-in-means</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb432-1" data-line-number="1"><span class="kw">sd</span>(pate_sims_se[[<span class="st">&quot;diff_mean&quot;</span>]])</a>
<a class="sourceLine" id="cb432-2" data-line-number="2"><span class="co">#&gt; [1] 0.199</span></a></code></pre></div>
<p>Mean of standard errors,</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb433-1" data-line-number="1"><span class="kw">mean</span>(pate_sims_se[[<span class="st">&quot;se&quot;</span>]])</a>
<a class="sourceLine" id="cb433-2" data-line-number="2"><span class="co">#&gt; [1] 0.2</span></a></code></pre></div>
</div>
<div id="confidence-intervals" class="section level3">
<h3><span class="header-section-number">7.1.3</span> Confidence Intervals</h3>
<p>Calculate a <span class="math inline">\(p\%\)</span> confidence interval for the binomial distribution:</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb434-1" data-line-number="1"><span class="co"># Sample size</span></a>
<a class="sourceLine" id="cb434-2" data-line-number="2">n &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb434-3" data-line-number="3"><span class="co"># point estimate</span></a>
<a class="sourceLine" id="cb434-4" data-line-number="4">x_bar &lt;-<span class="st"> </span><span class="fl">0.6</span></a>
<a class="sourceLine" id="cb434-5" data-line-number="5"><span class="co"># standard error</span></a>
<a class="sourceLine" id="cb434-6" data-line-number="6">se &lt;-<span class="st"> </span><span class="kw">sqrt</span>(x_bar <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x_bar) <span class="op">/</span><span class="st"> </span>n)</a>
<a class="sourceLine" id="cb434-7" data-line-number="7"><span class="co"># Desired Confidence levels</span></a>
<a class="sourceLine" id="cb434-8" data-line-number="8">levels &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.99</span>, <span class="fl">0.95</span>, <span class="fl">0.90</span>)</a></code></pre></div>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb435-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">level =</span> levels) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb435-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(</a>
<a class="sourceLine" id="cb435-3" data-line-number="3">    <span class="dt">ci_lower =</span> x_bar <span class="op">-</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>level) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>se,</a>
<a class="sourceLine" id="cb435-4" data-line-number="4">    <span class="dt">ci_upper =</span> x_bar <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>level) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>se</a>
<a class="sourceLine" id="cb435-5" data-line-number="5">  )</a>
<a class="sourceLine" id="cb435-6" data-line-number="6"><span class="co">#&gt; # A tibble: 3 x 3</span></a>
<a class="sourceLine" id="cb435-7" data-line-number="7"><span class="co">#&gt;   level ci_lower ci_upper</span></a>
<a class="sourceLine" id="cb435-8" data-line-number="8"><span class="co">#&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb435-9" data-line-number="9"><span class="co">#&gt; 1 0.990    0.560    0.640</span></a>
<a class="sourceLine" id="cb435-10" data-line-number="10"><span class="co">#&gt; 2 0.950    0.570    0.630</span></a>
<a class="sourceLine" id="cb435-11" data-line-number="11"><span class="co">#&gt; 3 0.900    0.575    0.625</span></a></code></pre></div>
<p>Calculate the coverage ratio of the 95% confidence interval in the PATE simulations.</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb436-1" data-line-number="1">level &lt;-<span class="st"> </span><span class="fl">0.95</span></a>
<a class="sourceLine" id="cb436-2" data-line-number="2">pate_sims_se <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb436-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ci_lower =</span> diff_mean <span class="op">-</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>level) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>se,</a>
<a class="sourceLine" id="cb436-4" data-line-number="4">         <span class="dt">ci_upper =</span> diff_mean <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>level) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>se,</a>
<a class="sourceLine" id="cb436-5" data-line-number="5">         <span class="dt">includes_pate =</span> PATE <span class="op">&gt;</span><span class="st"> </span>ci_lower <span class="op">&amp;</span><span class="st"> </span>PATE <span class="op">&lt;</span><span class="st"> </span>ci_upper) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb436-6" data-line-number="6"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">coverage =</span> <span class="kw">mean</span>(includes_pate))</a>
<a class="sourceLine" id="cb436-7" data-line-number="7"><span class="co">#&gt; # A tibble: 1 x 1</span></a>
<a class="sourceLine" id="cb436-8" data-line-number="8"><span class="co">#&gt;   coverage</span></a>
<a class="sourceLine" id="cb436-9" data-line-number="9"><span class="co">#&gt;      &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb436-10" data-line-number="10"><span class="co">#&gt; 1    0.948</span></a></code></pre></div>
<p>To do this for multiple levels encapsulate the above code in a function with arguments <code>.data</code> (the data frame) and the confidence level, <code>level</code>:</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb437-1" data-line-number="1">pate_sims_coverage &lt;-<span class="st"> </span><span class="cf">function</span>(.data, <span class="dt">level =</span> <span class="fl">0.95</span>) {</a>
<a class="sourceLine" id="cb437-2" data-line-number="2">  <span class="kw">mutate</span>(.data,</a>
<a class="sourceLine" id="cb437-3" data-line-number="3">         <span class="dt">ci_lower =</span> diff_mean <span class="op">-</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>level) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>se,</a>
<a class="sourceLine" id="cb437-4" data-line-number="4">         <span class="dt">ci_upper =</span> diff_mean <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>level) <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>se,</a>
<a class="sourceLine" id="cb437-5" data-line-number="5">         <span class="dt">includes_pate =</span> PATE <span class="op">&gt;</span><span class="st"> </span>ci_lower <span class="op">&amp;</span><span class="st"> </span>PATE <span class="op">&lt;</span><span class="st"> </span>ci_upper) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb437-6" data-line-number="6"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">coverage =</span> <span class="kw">mean</span>(includes_pate))</a>
<a class="sourceLine" id="cb437-7" data-line-number="7">}</a>
<a class="sourceLine" id="cb437-8" data-line-number="8"></a>
<a class="sourceLine" id="cb437-9" data-line-number="9"><span class="kw">pate_sims_coverage</span>(pate_sims_se, <span class="fl">0.95</span>)</a>
<a class="sourceLine" id="cb437-10" data-line-number="10"><span class="co">#&gt; # A tibble: 1 x 1</span></a>
<a class="sourceLine" id="cb437-11" data-line-number="11"><span class="co">#&gt;   coverage</span></a>
<a class="sourceLine" id="cb437-12" data-line-number="12"><span class="co">#&gt;      &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb437-13" data-line-number="13"><span class="co">#&gt; 1    0.948</span></a>
<a class="sourceLine" id="cb437-14" data-line-number="14"><span class="kw">pate_sims_coverage</span>(pate_sims_se, <span class="fl">0.99</span>)</a>
<a class="sourceLine" id="cb437-15" data-line-number="15"><span class="co">#&gt; # A tibble: 1 x 1</span></a>
<a class="sourceLine" id="cb437-16" data-line-number="16"><span class="co">#&gt;   coverage</span></a>
<a class="sourceLine" id="cb437-17" data-line-number="17"><span class="co">#&gt;      &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb437-18" data-line-number="18"><span class="co">#&gt; 1    0.989</span></a>
<a class="sourceLine" id="cb437-19" data-line-number="19"><span class="kw">pate_sims_coverage</span>(pate_sims_se, <span class="fl">0.90</span>)</a>
<a class="sourceLine" id="cb437-20" data-line-number="20"><span class="co">#&gt; # A tibble: 1 x 1</span></a>
<a class="sourceLine" id="cb437-21" data-line-number="21"><span class="co">#&gt;   coverage</span></a>
<a class="sourceLine" id="cb437-22" data-line-number="22"><span class="co">#&gt;      &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb437-23" data-line-number="23"><span class="co">#&gt; 1    0.898</span></a></code></pre></div>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb438-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="fl">0.6</span></a>
<a class="sourceLine" id="cb438-2" data-line-number="2">n &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb438-3" data-line-number="3">alpha &lt;-<span class="st"> </span><span class="fl">0.05</span></a>
<a class="sourceLine" id="cb438-4" data-line-number="4">sims &lt;-<span class="st"> </span><span class="dv">5000</span></a></code></pre></div>
<p>Define a function that samples from a Bernoulli distribution, calculates its standard error, and returns a logical value as to whether it contains the true value:</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb439-1" data-line-number="1">binom_ci_contains &lt;-<span class="st"> </span><span class="cf">function</span>(n, p, <span class="dt">alpha =</span> <span class="fl">0.05</span>) {</a>
<a class="sourceLine" id="cb439-2" data-line-number="2">  x &lt;-<span class="st"> </span><span class="kw">rbinom</span>(n, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">prob =</span> p)</a>
<a class="sourceLine" id="cb439-3" data-line-number="3">  x_bar &lt;-<span class="st"> </span><span class="kw">mean</span>(x)</a>
<a class="sourceLine" id="cb439-4" data-line-number="4">  se &lt;-<span class="st"> </span><span class="kw">sqrt</span>(x_bar <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>x_bar) <span class="op">/</span><span class="st"> </span>n)</a>
<a class="sourceLine" id="cb439-5" data-line-number="5">  ci_lower &lt;-<span class="st"> </span>x_bar <span class="op">-</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>alpha <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>se</a>
<a class="sourceLine" id="cb439-6" data-line-number="6">  ci_upper &lt;-<span class="st"> </span>x_bar <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>alpha <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>se</a>
<a class="sourceLine" id="cb439-7" data-line-number="7">  (ci_lower <span class="op">&lt;=</span><span class="st"> </span>p) <span class="op">&amp;</span><span class="st"> </span>(p <span class="op">&lt;=</span><span class="st"> </span>ci_upper)</a>
<a class="sourceLine" id="cb439-8" data-line-number="8">}</a></code></pre></div>
<p>We can run this once for given sample size:</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb440-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb440-2" data-line-number="2"><span class="kw">binom_ci_contains</span>(n, p)</a>
<a class="sourceLine" id="cb440-3" data-line-number="3"><span class="co">#&gt; [1] FALSE</span></a></code></pre></div>
<p>Using <code>map_df</code> we can rerun it <code>sims</code> times and calculate the coverage proportion:</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb441-1" data-line-number="1"><span class="kw">mean</span>(<span class="kw">map_lgl</span>(<span class="kw">seq_len</span>(sims), <span class="op">~</span><span class="st"> </span><span class="kw">binom_ci_contains</span>(n, p)))</a>
<a class="sourceLine" id="cb441-2" data-line-number="2"><span class="co">#&gt; [1] 0.905</span></a></code></pre></div>
<p>Encapsulate the above code in a function that calculates the coverage of a confidence interval with size, <code>n</code>, and success probability, <code>p</code>:</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb442-1" data-line-number="1">binom_ci_coverage &lt;-<span class="st"> </span><span class="cf">function</span>(n, p, sims) {</a>
<a class="sourceLine" id="cb442-2" data-line-number="2">  <span class="kw">mean</span>(<span class="kw">map_lgl</span>(<span class="kw">seq_len</span>(sims), <span class="op">~</span><span class="st"> </span><span class="kw">binom_ci_contains</span>(n, p)))</a>
<a class="sourceLine" id="cb442-3" data-line-number="3">}</a></code></pre></div>
<p>Use <code>binom_ci_coverage</code> to calculate CI coverage for multiple values of the sample size:</p>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb443-1" data-line-number="1"><span class="kw">tibble</span>(<span class="dt">n =</span> <span class="kw">c</span>(10L, 100L, 1000L)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb443-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">coverage =</span> <span class="kw">map_dbl</span>(n, binom_ci_coverage, <span class="dt">p =</span> <span class="op">!!</span>p, <span class="dt">sims =</span> <span class="op">!!</span>sims))</a>
<a class="sourceLine" id="cb443-3" data-line-number="3"><span class="co">#&gt; # A tibble: 3 x 2</span></a>
<a class="sourceLine" id="cb443-4" data-line-number="4"><span class="co">#&gt;       n coverage</span></a>
<a class="sourceLine" id="cb443-5" data-line-number="5"><span class="co">#&gt;   &lt;int&gt;    &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb443-6" data-line-number="6"><span class="co">#&gt; 1    10    0.900</span></a>
<a class="sourceLine" id="cb443-7" data-line-number="7"><span class="co">#&gt; 2   100    0.943</span></a>
<a class="sourceLine" id="cb443-8" data-line-number="8"><span class="co">#&gt; 3  1000    0.948</span></a></code></pre></div>
</div>
<div id="margin-of-error-and-sample-size-calculation-in-polls" class="section level3">
<h3><span class="header-section-number">7.1.4</span> Margin of Error and Sample Size Calculation in Polls</h3>
<p>Write a function to calculate the sample size needed for a given proportion.</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb444-1" data-line-number="1">moe_pop_prop &lt;-<span class="st"> </span><span class="cf">function</span>(MoE) {</a>
<a class="sourceLine" id="cb444-2" data-line-number="2">  <span class="kw">tibble</span>(<span class="dt">p =</span> <span class="kw">seq</span>(<span class="dt">from =</span> <span class="fl">0.01</span>, <span class="dt">to =</span> <span class="fl">0.99</span>, <span class="dt">by =</span> <span class="fl">0.01</span>),</a>
<a class="sourceLine" id="cb444-3" data-line-number="3">         <span class="dt">n =</span> <span class="fl">1.96</span> <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>p <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p) <span class="op">/</span><span class="st"> </span>MoE <span class="op">^</span><span class="st"> </span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb444-4" data-line-number="4">         <span class="dt">MoE =</span> MoE)</a>
<a class="sourceLine" id="cb444-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb444-6" data-line-number="6"><span class="kw">moe_pop_prop</span>(<span class="fl">0.01</span>)</a>
<a class="sourceLine" id="cb444-7" data-line-number="7"><span class="co">#&gt; # A tibble: 99 x 3</span></a>
<a class="sourceLine" id="cb444-8" data-line-number="8"><span class="co">#&gt;        p     n    MoE</span></a>
<a class="sourceLine" id="cb444-9" data-line-number="9"><span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb444-10" data-line-number="10"><span class="co">#&gt; 1 0.0100  380. 0.0100</span></a>
<a class="sourceLine" id="cb444-11" data-line-number="11"><span class="co">#&gt; 2 0.0200  753. 0.0100</span></a>
<a class="sourceLine" id="cb444-12" data-line-number="12"><span class="co">#&gt; 3 0.0300 1118. 0.0100</span></a>
<a class="sourceLine" id="cb444-13" data-line-number="13"><span class="co">#&gt; 4 0.0400 1475. 0.0100</span></a>
<a class="sourceLine" id="cb444-14" data-line-number="14"><span class="co">#&gt; 5 0.0500 1825. 0.0100</span></a>
<a class="sourceLine" id="cb444-15" data-line-number="15"><span class="co">#&gt; 6 0.0600 2167. 0.0100</span></a>
<a class="sourceLine" id="cb444-16" data-line-number="16"><span class="co">#&gt; # ... with 93 more rows</span></a></code></pre></div>
<p>Then use <a href="https://www.rdocumentation.org/packages/purrr/topics/map_df">map_df</a> to call this function for different margins of error, and return the entire thing as a data frame with columns: <code>n</code>, <code>p</code>, and <code>MoE</code>.</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb445-1" data-line-number="1">MoE &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.01</span>, <span class="fl">0.03</span>, <span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb445-2" data-line-number="2">props &lt;-<span class="st"> </span><span class="kw">map_df</span>(MoE, moe_pop_prop)</a></code></pre></div>
<p>Since its a data frame, its easy to plot with <a href="https://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a>:</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb446-1" data-line-number="1"><span class="kw">ggplot</span>(props, <span class="kw">aes</span>(<span class="dt">x =</span> p, <span class="dt">y =</span> n, <span class="dt">colour =</span> <span class="kw">factor</span>(MoE))) <span class="op">+</span></a>
<a class="sourceLine" id="cb446-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb446-3" data-line-number="3"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">colour =</span> <span class="st">&quot;margin of error&quot;</span>,</a>
<a class="sourceLine" id="cb446-4" data-line-number="4">       <span class="dt">x =</span> <span class="st">&quot;population proportion&quot;</span>,</a>
<a class="sourceLine" id="cb446-5" data-line-number="5">       <span class="dt">y =</span> <span class="st">&quot;sample size&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb446-6" data-line-number="6"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</a></code></pre></div>
<p><img src="uncertainty_files/figure-html/unnamed-chunk-31-1.png" width="70%" style="display: block; margin: auto;" />
<a href="https://www.rdocumentation.org/packages/readr/topics/read_csv">read_csv</a> already recognizes the date columns, so we don’t need to convert them.
The 2008 election was on Nov 11, 2008, so we’ll store that in a variable.</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb447-1" data-line-number="1">ELECTION_DATE &lt;-<span class="st"> </span><span class="kw">ymd</span>(<span class="dv">20081104</span>)</a></code></pre></div>
<p>Load the final vote shares,</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb448-1" data-line-number="1"><span class="kw">data</span>(<span class="st">&quot;pres08&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;qss&quot;</span>)</a></code></pre></div>
<p>and polling data</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb449-1" data-line-number="1"><span class="kw">data</span>(<span class="st">&quot;polls08&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;qss&quot;</span>)</a></code></pre></div>
<p>We need to add an additional column to the <code>polls08</code> data frame which contains
the number of days until the election:</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb450-1" data-line-number="1">polls08 &lt;-<span class="st"> </span>polls08 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb450-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DaysToElection =</span> <span class="kw">as.integer</span>(ELECTION_DATE <span class="op">-</span><span class="st"> </span>middate))</a></code></pre></div>
<p>For each state calculate the mean of the latest polls,</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb451-1" data-line-number="1">poll_pred &lt;-</a>
<a class="sourceLine" id="cb451-2" data-line-number="2"><span class="st">  </span>polls08 <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb451-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(state) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb451-4" data-line-number="4"><span class="st">  </span><span class="co"># latest polls in the state</span></a>
<a class="sourceLine" id="cb451-5" data-line-number="5"><span class="st">  </span><span class="kw">filter</span>(DaysToElection <span class="op">==</span><span class="st"> </span><span class="kw">min</span>(DaysToElection)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb451-6" data-line-number="6"><span class="st">  </span><span class="co"># take mean of latest polls and convert from 0-100 to 0-1</span></a>
<a class="sourceLine" id="cb451-7" data-line-number="7"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Obama =</span> <span class="kw">mean</span>(Obama) <span class="op">/</span><span class="st"> </span><span class="dv">100</span>)</a>
<a class="sourceLine" id="cb451-8" data-line-number="8"><span class="co"># Add confidence itervals</span></a>
<a class="sourceLine" id="cb451-9" data-line-number="9"><span class="co"># sample size</span></a>
<a class="sourceLine" id="cb451-10" data-line-number="10">sample_size &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb451-11" data-line-number="11"><span class="co"># confidence level</span></a>
<a class="sourceLine" id="cb451-12" data-line-number="12">alpha &lt;-<span class="st"> </span><span class="fl">0.05</span></a>
<a class="sourceLine" id="cb451-13" data-line-number="13">poll_pred &lt;-</a>
<a class="sourceLine" id="cb451-14" data-line-number="14"><span class="st">  </span>poll_pred <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb451-15" data-line-number="15"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">se =</span> <span class="kw">sqrt</span>(Obama <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>Obama) <span class="op">/</span><span class="st"> </span>sample_size),</a>
<a class="sourceLine" id="cb451-16" data-line-number="16">         <span class="dt">ci_lwr =</span> Obama <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(alpha <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>se,</a>
<a class="sourceLine" id="cb451-17" data-line-number="17">         <span class="dt">ci_upr =</span> Obama <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>alpha <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>se)</a>
<a class="sourceLine" id="cb451-18" data-line-number="18"><span class="co"># Add actual outcome</span></a>
<a class="sourceLine" id="cb451-19" data-line-number="19">poll_pred &lt;-</a>
<a class="sourceLine" id="cb451-20" data-line-number="20"><span class="st">  </span><span class="kw">left_join</span>(poll_pred,</a>
<a class="sourceLine" id="cb451-21" data-line-number="21">            <span class="kw">select</span>(pres08, state, <span class="dt">actual =</span> Obama),</a>
<a class="sourceLine" id="cb451-22" data-line-number="22">            <span class="dt">by =</span> <span class="st">&quot;state&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb451-23" data-line-number="23"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">actual =</span> actual <span class="op">/</span><span class="st"> </span><span class="dv">100</span>,</a>
<a class="sourceLine" id="cb451-24" data-line-number="24">         <span class="dt">covers =</span> (ci_lwr <span class="op">&lt;=</span><span class="st"> </span>actual) <span class="op">&amp;</span><span class="st"> </span>(actual <span class="op">&lt;=</span><span class="st"> </span>ci_upr))</a>
<a class="sourceLine" id="cb451-25" data-line-number="25">poll_pred</a>
<a class="sourceLine" id="cb451-26" data-line-number="26"><span class="co">#&gt; # A tibble: 51 x 7</span></a>
<a class="sourceLine" id="cb451-27" data-line-number="27"><span class="co">#&gt;   state Obama     se ci_lwr ci_upr actual covers</span></a>
<a class="sourceLine" id="cb451-28" data-line-number="28"><span class="co">#&gt;   &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;lgl&gt; </span></a>
<a class="sourceLine" id="cb451-29" data-line-number="29"><span class="co">#&gt; 1 AK    0.390 0.0154  0.360  0.420  0.380 TRUE  </span></a>
<a class="sourceLine" id="cb451-30" data-line-number="30"><span class="co">#&gt; 2 AL    0.360 0.0152  0.330  0.390  0.390 FALSE </span></a>
<a class="sourceLine" id="cb451-31" data-line-number="31"><span class="co">#&gt; 3 AR    0.440 0.0157  0.409  0.471  0.390 FALSE </span></a>
<a class="sourceLine" id="cb451-32" data-line-number="32"><span class="co">#&gt; 4 AZ    0.465 0.0158  0.434  0.496  0.450 TRUE  </span></a>
<a class="sourceLine" id="cb451-33" data-line-number="33"><span class="co">#&gt; 5 CA    0.600 0.0155  0.570  0.630  0.610 TRUE  </span></a>
<a class="sourceLine" id="cb451-34" data-line-number="34"><span class="co">#&gt; 6 CO    0.520 0.0158  0.489  0.551  0.540 TRUE  </span></a>
<a class="sourceLine" id="cb451-35" data-line-number="35"><span class="co">#&gt; # ... with 45 more rows</span></a></code></pre></div>
<p>In the plot, color the point ranges by whether they include the election day outcome.</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb452-1" data-line-number="1"><span class="kw">ggplot</span>(poll_pred, <span class="kw">aes</span>(<span class="dt">x =</span> actual, <span class="dt">y =</span> Obama,</a>
<a class="sourceLine" id="cb452-2" data-line-number="2">                      <span class="dt">ymin =</span> ci_lwr, <span class="dt">ymax =</span> ci_upr,</a>
<a class="sourceLine" id="cb452-3" data-line-number="3">                      <span class="dt">colour =</span> covers)) <span class="op">+</span></a>
<a class="sourceLine" id="cb452-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">slope =</span> <span class="dv">1</span>, <span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb452-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_pointrange</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb452-6" data-line-number="6"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="st">&quot;Poll prediction&quot;</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb452-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_x_continuous</span>(<span class="st">&quot;Obama&#39;s vote share&quot;</span>, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb452-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_colour_discrete</span>(<span class="st">&quot;CI includes result?&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb452-9" data-line-number="9"><span class="st">  </span><span class="kw">coord_fixed</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb452-10" data-line-number="10"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</a></code></pre></div>
<p><img src="uncertainty_files/figure-html/unnamed-chunk-36-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Proportion of polls with confidence intervals that include the election outcome?</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb453-1" data-line-number="1">poll_pred <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb453-2" data-line-number="2"><span class="st">  </span><span class="kw">summarise</span>(<span class="kw">mean</span>(covers))</a>
<a class="sourceLine" id="cb453-3" data-line-number="3"><span class="co">#&gt; # A tibble: 1 x 1</span></a>
<a class="sourceLine" id="cb453-4" data-line-number="4"><span class="co">#&gt;   `mean(covers)`</span></a>
<a class="sourceLine" id="cb453-5" data-line-number="5"><span class="co">#&gt;            &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb453-6" data-line-number="6"><span class="co">#&gt; 1          0.588</span></a></code></pre></div>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb454-1" data-line-number="1">poll_pred &lt;-</a>
<a class="sourceLine" id="cb454-2" data-line-number="2"><span class="st">  </span>poll_pred <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb454-3" data-line-number="3"><span class="st">  </span><span class="co"># calc bias</span></a>
<a class="sourceLine" id="cb454-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">bias =</span> Obama <span class="op">-</span><span class="st"> </span>actual) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb454-5" data-line-number="5"><span class="st">  </span><span class="co"># bias corrected prediction, se, and CI</span></a>
<a class="sourceLine" id="cb454-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Obama_bc =</span> Obama <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(bias),</a>
<a class="sourceLine" id="cb454-7" data-line-number="7">         <span class="dt">se_bc =</span> <span class="kw">sqrt</span>(Obama_bc <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>Obama_bc) <span class="op">/</span><span class="st"> </span>sample_size),</a>
<a class="sourceLine" id="cb454-8" data-line-number="8">         <span class="dt">ci_lwr_bc =</span> Obama_bc <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(alpha <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>se_bc,</a>
<a class="sourceLine" id="cb454-9" data-line-number="9">         <span class="dt">ci_upr_bc =</span> Obama_bc <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>alpha <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>se_bc,</a>
<a class="sourceLine" id="cb454-10" data-line-number="10">         <span class="dt">covers_bc =</span> (ci_lwr_bc <span class="op">&lt;=</span><span class="st"> </span>actual) <span class="op">&amp;</span><span class="st"> </span>(actual <span class="op">&lt;=</span><span class="st"> </span>ci_upr_bc))</a>
<a class="sourceLine" id="cb454-11" data-line-number="11">poll_pred <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb454-12" data-line-number="12"><span class="st">  </span><span class="kw">summarise</span>(<span class="kw">mean</span>(covers_bc))</a>
<a class="sourceLine" id="cb454-13" data-line-number="13"><span class="co">#&gt; # A tibble: 1 x 1</span></a>
<a class="sourceLine" id="cb454-14" data-line-number="14"><span class="co">#&gt;   `mean(covers_bc)`</span></a>
<a class="sourceLine" id="cb454-15" data-line-number="15"><span class="co">#&gt;               &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb454-16" data-line-number="16"><span class="co">#&gt; 1             0.765</span></a></code></pre></div>
</div>
<div id="analysis-of-randomized-controlled-trials" class="section level3">
<h3><span class="header-section-number">7.1.5</span> Analysis of Randomized Controlled Trials</h3>
<p>Load the <code>STAR</code> data from the <strong>qss</strong> package,</p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb455-1" data-line-number="1"><span class="kw">data</span>(<span class="st">&quot;STAR&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;qss&quot;</span>)</a></code></pre></div>
<p>Add meaningful labels to the <code>classtype</code> variable:</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb456-1" data-line-number="1">STAR &lt;-<span class="st"> </span>STAR <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb456-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">classtype =</span> <span class="kw">factor</span>(classtype,</a>
<a class="sourceLine" id="cb456-3" data-line-number="3">                            <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;small class&quot;</span>, <span class="st">&quot;regular class&quot;</span>,</a>
<a class="sourceLine" id="cb456-4" data-line-number="4">                                       <span class="st">&quot;regular class with aid&quot;</span>)))</a></code></pre></div>
<p>Summarize scores by classroom type:</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb457-1" data-line-number="1">classtype_means &lt;-</a>
<a class="sourceLine" id="cb457-2" data-line-number="2"><span class="st">  </span>STAR <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb457-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(classtype) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb457-4" data-line-number="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">g4reading =</span> <span class="kw">mean</span>(g4reading, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>))</a></code></pre></div>
<p>Plot the distribution of scores by classroom type:</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb458-1" data-line-number="1">classtypes_used &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;small class&quot;</span>, <span class="st">&quot;regular class&quot;</span>)</a>
<a class="sourceLine" id="cb458-2" data-line-number="2"><span class="kw">ggplot</span>(<span class="kw">filter</span>(STAR,</a>
<a class="sourceLine" id="cb458-3" data-line-number="3">              classtype <span class="op">%in%</span><span class="st"> </span>classtypes_used,</a>
<a class="sourceLine" id="cb458-4" data-line-number="4">              <span class="op">!</span><span class="kw">is.na</span>(g4reading)),</a>
<a class="sourceLine" id="cb458-5" data-line-number="5">       <span class="kw">aes</span>(<span class="dt">x =</span> g4reading, <span class="dt">y =</span> ..density..)) <span class="op">+</span></a>
<a class="sourceLine" id="cb458-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_histogram</span>(<span class="dt">binwidth =</span> <span class="dv">20</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb458-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="dt">data =</span> <span class="kw">filter</span>(classtype_means, classtype <span class="op">%in%</span><span class="st"> </span>classtypes_used),</a>
<a class="sourceLine" id="cb458-8" data-line-number="8">             <span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="dt">xintercept =</span> g4reading),</a>
<a class="sourceLine" id="cb458-9" data-line-number="9">             <span class="dt">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="dt">size =</span> <span class="dv">2</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb458-10" data-line-number="10"><span class="st">  </span><span class="kw">facet_grid</span>(classtype <span class="op">~</span><span class="st"> </span>.) <span class="op">+</span></a>
<a class="sourceLine" id="cb458-11" data-line-number="11"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Fourth grade reading score&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Density&quot;</span>)</a>
<a class="sourceLine" id="cb458-12" data-line-number="12"></a>
<a class="sourceLine" id="cb458-13" data-line-number="13">alpha &lt;-<span class="st"> </span><span class="fl">0.05</span></a>
<a class="sourceLine" id="cb458-14" data-line-number="14">star_estimates &lt;-</a>
<a class="sourceLine" id="cb458-15" data-line-number="15"><span class="st">  </span>STAR <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb458-16" data-line-number="16"><span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(g4reading)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb458-17" data-line-number="17"><span class="st">  </span><span class="kw">group_by</span>(classtype) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb458-18" data-line-number="18"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>(),</a>
<a class="sourceLine" id="cb458-19" data-line-number="19">            <span class="dt">est =</span> <span class="kw">mean</span>(g4reading),</a>
<a class="sourceLine" id="cb458-20" data-line-number="20">            <span class="dt">se =</span> <span class="kw">sd</span>(g4reading) <span class="op">/</span><span class="st"> </span><span class="kw">sqrt</span>(n)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb458-21" data-line-number="21"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lwr =</span> est <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(alpha <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>se,</a>
<a class="sourceLine" id="cb458-22" data-line-number="22">         <span class="dt">upr =</span> est <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>alpha <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>se)</a>
<a class="sourceLine" id="cb458-23" data-line-number="23">star_estimates</a>
<a class="sourceLine" id="cb458-24" data-line-number="24"><span class="co">#&gt; # A tibble: 3 x 6</span></a>
<a class="sourceLine" id="cb458-25" data-line-number="25"><span class="co">#&gt;   classtype                  n   est    se   lwr   upr</span></a>
<a class="sourceLine" id="cb458-26" data-line-number="26"><span class="co">#&gt;   &lt;fct&gt;                  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb458-27" data-line-number="27"><span class="co">#&gt; 1 small class              726  723.  1.91  720.  727.</span></a>
<a class="sourceLine" id="cb458-28" data-line-number="28"><span class="co">#&gt; 2 regular class            836  720.  1.84  716.  723.</span></a>
<a class="sourceLine" id="cb458-29" data-line-number="29"><span class="co">#&gt; 3 regular class with aid   791  721.  1.86  717.  724.</span></a>
<a class="sourceLine" id="cb458-30" data-line-number="30"></a>
<a class="sourceLine" id="cb458-31" data-line-number="31">star_estimates <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb458-32" data-line-number="32"><span class="st">  </span><span class="kw">filter</span>(classtype <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;small class&quot;</span>, <span class="st">&quot;regular class&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb458-33" data-line-number="33"><span class="st">  </span><span class="co"># ensure that it is ordered small then regular</span></a>
<a class="sourceLine" id="cb458-34" data-line-number="34"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(classtype)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb458-35" data-line-number="35"><span class="st">  </span><span class="kw">summarise</span>(</a>
<a class="sourceLine" id="cb458-36" data-line-number="36">    <span class="dt">se =</span> <span class="kw">sqrt</span>(<span class="kw">sum</span>(se <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)),</a>
<a class="sourceLine" id="cb458-37" data-line-number="37">    <span class="dt">est =</span> <span class="kw">diff</span>(est)</a>
<a class="sourceLine" id="cb458-38" data-line-number="38">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb458-39" data-line-number="39"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ci_lwr =</span> est <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(alpha <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>se,</a>
<a class="sourceLine" id="cb458-40" data-line-number="40">         <span class="dt">ci_up =</span> est <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>alpha <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>se)</a>
<a class="sourceLine" id="cb458-41" data-line-number="41"><span class="co">#&gt; # A tibble: 1 x 4</span></a>
<a class="sourceLine" id="cb458-42" data-line-number="42"><span class="co">#&gt;      se   est ci_lwr ci_up</span></a>
<a class="sourceLine" id="cb458-43" data-line-number="43"><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb458-44" data-line-number="44"><span class="co">#&gt; 1  2.65  3.50  -1.70  8.70</span></a></code></pre></div>
<p><img src="uncertainty_files/figure-html/unnamed-chunk-42-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Use we could use <a href="https://www.rdocumentation.org/packages/tidyr/topics/spread">spread</a> and <a href="https://www.rdocumentation.org/packages/tidyr/topics/gather">gather</a>:</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb459-1" data-line-number="1">star_ate &lt;-</a>
<a class="sourceLine" id="cb459-2" data-line-number="2"><span class="st">  </span>star_estimates <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb459-3" data-line-number="3"><span class="st">  </span><span class="kw">filter</span>(classtype <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;small class&quot;</span>, <span class="st">&quot;regular class&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb459-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">classtype =</span> <span class="kw">fct_recode</span>(<span class="kw">factor</span>(classtype),</a>
<a class="sourceLine" id="cb459-5" data-line-number="5">                                <span class="st">&quot;small&quot;</span> =<span class="st"> &quot;small class&quot;</span>,</a>
<a class="sourceLine" id="cb459-6" data-line-number="6">                                <span class="st">&quot;regular&quot;</span> =<span class="st"> &quot;regular class&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb459-7" data-line-number="7"><span class="st">  </span><span class="kw">select</span>(classtype, est, se) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb459-8" data-line-number="8"><span class="st">  </span><span class="kw">gather</span>(stat, value, <span class="op">-</span>classtype) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb459-9" data-line-number="9"><span class="st">  </span><span class="kw">unite</span>(variable, stat, classtype)  <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb459-10" data-line-number="10"><span class="st">  </span><span class="kw">spread</span>(variable, value) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb459-11" data-line-number="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ate_est =</span> est_small <span class="op">-</span><span class="st"> </span>est_regular,</a>
<a class="sourceLine" id="cb459-12" data-line-number="12">         <span class="dt">ate_se =</span> <span class="kw">sqrt</span>(se_small <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>se_regular <span class="op">^</span><span class="st"> </span><span class="dv">2</span>),</a>
<a class="sourceLine" id="cb459-13" data-line-number="13">         <span class="dt">ci_lwr =</span> ate_est <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(alpha <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>ate_se,</a>
<a class="sourceLine" id="cb459-14" data-line-number="14">         <span class="dt">ci_upr =</span> ate_est <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>alpha <span class="op">/</span><span class="st"> </span><span class="dv">2</span>) <span class="op">*</span><span class="st"> </span>ate_se)</a>
<a class="sourceLine" id="cb459-15" data-line-number="15">star_ate</a>
<a class="sourceLine" id="cb459-16" data-line-number="16"><span class="co">#&gt; # A tibble: 1 x 8</span></a>
<a class="sourceLine" id="cb459-17" data-line-number="17"><span class="co">#&gt;   est_regular est_small se_regular se_small ate_est ate_se ci_lwr ci_upr</span></a>
<a class="sourceLine" id="cb459-18" data-line-number="18"><span class="co">#&gt;         &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb459-19" data-line-number="19"><span class="co">#&gt; 1        720.      723.       1.84     1.91    3.50   2.65  -1.70   8.70</span></a></code></pre></div>
</div>
<div id="analysis-based-on-students-t-distribution" class="section level3">
<h3><span class="header-section-number">7.1.6</span> Analysis Based on Student’s t-Distribution</h3>
<p>Use <a href="https://www.rdocumentation.org/packages/dplyr/topics/filter">filter</a> to subset.</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb460-1" data-line-number="1"><span class="kw">t.test</span>(<span class="kw">filter</span>(STAR, classtype <span class="op">==</span><span class="st"> &quot;small class&quot;</span>)<span class="op">$</span>g4reading,</a>
<a class="sourceLine" id="cb460-2" data-line-number="2">       <span class="kw">filter</span>(STAR, classtype <span class="op">==</span><span class="st"> &quot;regular class&quot;</span>)<span class="op">$</span>g4reading)</a>
<a class="sourceLine" id="cb460-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb460-4" data-line-number="4"><span class="co">#&gt;  Welch Two Sample t-test</span></a>
<a class="sourceLine" id="cb460-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb460-6" data-line-number="6"><span class="co">#&gt; data:  filter(STAR, classtype == &quot;small class&quot;)$g4reading and filter(STAR, classtype == &quot;regular class&quot;)$g4reading</span></a>
<a class="sourceLine" id="cb460-7" data-line-number="7"><span class="co">#&gt; t = 1, df = 2000, p-value = 0.2</span></a>
<a class="sourceLine" id="cb460-8" data-line-number="8"><span class="co">#&gt; alternative hypothesis: true difference in means is not equal to 0</span></a>
<a class="sourceLine" id="cb460-9" data-line-number="9"><span class="co">#&gt; 95 percent confidence interval:</span></a>
<a class="sourceLine" id="cb460-10" data-line-number="10"><span class="co">#&gt;  -1.70  8.71</span></a>
<a class="sourceLine" id="cb460-11" data-line-number="11"><span class="co">#&gt; sample estimates:</span></a>
<a class="sourceLine" id="cb460-12" data-line-number="12"><span class="co">#&gt; mean of x mean of y </span></a>
<a class="sourceLine" id="cb460-13" data-line-number="13"><span class="co">#&gt;       723       720</span></a></code></pre></div>
<p>The function <a href="https://www.rdocumentation.org/packages/stat/topics/t.test">t.test</a> can also take a formula as its first parameter.</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb461-1" data-line-number="1"><span class="kw">t.test</span>(g4reading <span class="op">~</span><span class="st"> </span>classtype,</a>
<a class="sourceLine" id="cb461-2" data-line-number="2">       <span class="dt">data =</span> <span class="kw">filter</span>(STAR, classtype <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;small class&quot;</span>, <span class="st">&quot;regular class&quot;</span>)))</a>
<a class="sourceLine" id="cb461-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb461-4" data-line-number="4"><span class="co">#&gt;  Welch Two Sample t-test</span></a>
<a class="sourceLine" id="cb461-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb461-6" data-line-number="6"><span class="co">#&gt; data:  g4reading by classtype</span></a>
<a class="sourceLine" id="cb461-7" data-line-number="7"><span class="co">#&gt; t = 1, df = 2000, p-value = 0.2</span></a>
<a class="sourceLine" id="cb461-8" data-line-number="8"><span class="co">#&gt; alternative hypothesis: true difference in means is not equal to 0</span></a>
<a class="sourceLine" id="cb461-9" data-line-number="9"><span class="co">#&gt; 95 percent confidence interval:</span></a>
<a class="sourceLine" id="cb461-10" data-line-number="10"><span class="co">#&gt;  -1.70  8.71</span></a>
<a class="sourceLine" id="cb461-11" data-line-number="11"><span class="co">#&gt; sample estimates:</span></a>
<a class="sourceLine" id="cb461-12" data-line-number="12"><span class="co">#&gt;   mean in group small class mean in group regular class </span></a>
<a class="sourceLine" id="cb461-13" data-line-number="13"><span class="co">#&gt;                         723                         720</span></a></code></pre></div>
</div>
</div>
<div id="hypothesis-testing" class="section level2">
<h2><span class="header-section-number">7.2</span> Hypothesis Testing</h2>
<div id="tea-testing-experiment" class="section level3">
<h3><span class="header-section-number">7.2.1</span> Tea-Testing Experiment</h3>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb462-1" data-line-number="1"><span class="co"># Number of cups of tea</span></a>
<a class="sourceLine" id="cb462-2" data-line-number="2">cups &lt;-<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb462-3" data-line-number="3"><span class="co"># Number guessed correctly</span></a>
<a class="sourceLine" id="cb462-4" data-line-number="4">k &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">0</span>, <span class="kw">seq_len</span>(cups))</a>
<a class="sourceLine" id="cb462-5" data-line-number="5">true &lt;-<span class="st">  </span><span class="kw">tibble</span>(<span class="dt">correct =</span> k <span class="op">*</span><span class="st"> </span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb462-6" data-line-number="6">                <span class="dt">n =</span> <span class="kw">choose</span>(cups, k) <span class="op">*</span><span class="st"> </span><span class="kw">choose</span>(cups, cups <span class="op">-</span><span class="st"> </span>k)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb462-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prob =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n))</a>
<a class="sourceLine" id="cb462-8" data-line-number="8">true</a>
<a class="sourceLine" id="cb462-9" data-line-number="9"><span class="co">#&gt; # A tibble: 5 x 3</span></a>
<a class="sourceLine" id="cb462-10" data-line-number="10"><span class="co">#&gt;   correct     n   prob</span></a>
<a class="sourceLine" id="cb462-11" data-line-number="11"><span class="co">#&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb462-12" data-line-number="12"><span class="co">#&gt; 1      0.    1. 0.0143</span></a>
<a class="sourceLine" id="cb462-13" data-line-number="13"><span class="co">#&gt; 2      2.   16. 0.229 </span></a>
<a class="sourceLine" id="cb462-14" data-line-number="14"><span class="co">#&gt; 3      4.   36. 0.514 </span></a>
<a class="sourceLine" id="cb462-15" data-line-number="15"><span class="co">#&gt; 4      6.   16. 0.229 </span></a>
<a class="sourceLine" id="cb462-16" data-line-number="16"><span class="co">#&gt; 5      8.    1. 0.0143</span></a>
<a class="sourceLine" id="cb462-17" data-line-number="17"></a>
<a class="sourceLine" id="cb462-18" data-line-number="18">sims &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb462-19" data-line-number="19">guess &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">guess =</span> <span class="kw">c</span>(<span class="st">&quot;M&quot;</span>, <span class="st">&quot;T&quot;</span>, <span class="st">&quot;T&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;M&quot;</span>, <span class="st">&quot;T&quot;</span>, <span class="st">&quot;T&quot;</span>, <span class="st">&quot;M&quot;</span>))</a>
<a class="sourceLine" id="cb462-20" data-line-number="20">randomize_tea &lt;-<span class="st"> </span><span class="cf">function</span>(df) {</a>
<a class="sourceLine" id="cb462-21" data-line-number="21">  <span class="co"># randomize the order of teas</span></a>
<a class="sourceLine" id="cb462-22" data-line-number="22">  assignment &lt;-<span class="st"> </span><span class="kw">sample_frac</span>(df, <span class="dv">1</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb462-23" data-line-number="23"><span class="st">    </span><span class="kw">rename</span>(<span class="dt">actual =</span> guess)</a>
<a class="sourceLine" id="cb462-24" data-line-number="24">  <span class="kw">bind_cols</span>(df, assignment) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb462-25" data-line-number="25"><span class="st">    </span><span class="kw">summarise</span>(<span class="dt">correct =</span> <span class="kw">sum</span>(guess <span class="op">==</span><span class="st"> </span>actual))</a>
<a class="sourceLine" id="cb462-26" data-line-number="26">}</a>
<a class="sourceLine" id="cb462-27" data-line-number="27">approx &lt;-</a>
<a class="sourceLine" id="cb462-28" data-line-number="28"><span class="st">  </span><span class="kw">map_df</span>(<span class="kw">seq_len</span>(sims), <span class="op">~</span><span class="st"> </span><span class="kw">randomize_tea</span>(guess)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb462-29" data-line-number="29"><span class="st">  </span><span class="kw">count</span>(correct) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb462-30" data-line-number="30"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">prob =</span> n <span class="op">/</span><span class="st"> </span><span class="kw">sum</span>(n))</a>
<a class="sourceLine" id="cb462-31" data-line-number="31"><span class="kw">left_join</span>(<span class="kw">select</span>(approx, correct, <span class="dt">prob_sim =</span> prob),</a>
<a class="sourceLine" id="cb462-32" data-line-number="32">          <span class="kw">select</span>(true, correct, <span class="dt">prob_exact =</span> prob),</a>
<a class="sourceLine" id="cb462-33" data-line-number="33">          <span class="dt">by =</span> <span class="st">&quot;correct&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb462-34" data-line-number="34"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">diff =</span> prob_sim <span class="op">-</span><span class="st"> </span>prob_exact)</a>
<a class="sourceLine" id="cb462-35" data-line-number="35"><span class="co">#&gt; # A tibble: 5 x 4</span></a>
<a class="sourceLine" id="cb462-36" data-line-number="36"><span class="co">#&gt;   correct prob_sim prob_exact      diff</span></a>
<a class="sourceLine" id="cb462-37" data-line-number="37"><span class="co">#&gt;     &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb462-38" data-line-number="38"><span class="co">#&gt; 1      0.   0.0200     0.0143  0.00571 </span></a>
<a class="sourceLine" id="cb462-39" data-line-number="39"><span class="co">#&gt; 2      2.   0.229      0.229   0.000429</span></a>
<a class="sourceLine" id="cb462-40" data-line-number="40"><span class="co">#&gt; 3      4.   0.492      0.514  -0.0223  </span></a>
<a class="sourceLine" id="cb462-41" data-line-number="41"><span class="co">#&gt; 4      6.   0.246      0.229   0.0174  </span></a>
<a class="sourceLine" id="cb462-42" data-line-number="42"><span class="co">#&gt; 5      8.   0.0130     0.0143 -0.00129</span></a></code></pre></div>
</div>
<div id="the-general-framework" class="section level3">
<h3><span class="header-section-number">7.2.2</span> The General Framework</h3>
<p>The test functions like <a href="https://www.rdocumentation.org/packages/stat/topics/fisher.test">fisher.test</a> do not work particularly well with data frames, and expect vectors or matrices as input, so tidyverse functions are less directly applicable</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb463-1" data-line-number="1"><span class="co"># all guesses correct</span></a>
<a class="sourceLine" id="cb463-2" data-line-number="2">x &lt;-<span class="st"> </span><span class="kw">tribble</span>(<span class="op">~</span>Guess, <span class="op">~</span>Truth, <span class="op">~</span>Number,</a>
<a class="sourceLine" id="cb463-3" data-line-number="3">             <span class="st">&quot;Milk&quot;</span>, <span class="st">&quot;Milk&quot;</span>, 4L,</a>
<a class="sourceLine" id="cb463-4" data-line-number="4">             <span class="st">&quot;Milk&quot;</span>, <span class="st">&quot;Tea&quot;</span>, 0L,</a>
<a class="sourceLine" id="cb463-5" data-line-number="5">             <span class="st">&quot;Tea&quot;</span>, <span class="st">&quot;Milk&quot;</span>, 0L,</a>
<a class="sourceLine" id="cb463-6" data-line-number="6">             <span class="st">&quot;Tea&quot;</span>, <span class="st">&quot;Tea&quot;</span>, 4L)</a>
<a class="sourceLine" id="cb463-7" data-line-number="7">x</a>
<a class="sourceLine" id="cb463-8" data-line-number="8"><span class="co">#&gt; # A tibble: 4 x 3</span></a>
<a class="sourceLine" id="cb463-9" data-line-number="9"><span class="co">#&gt;   Guess Truth Number</span></a>
<a class="sourceLine" id="cb463-10" data-line-number="10"><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;int&gt;</span></a>
<a class="sourceLine" id="cb463-11" data-line-number="11"><span class="co">#&gt; 1 Milk  Milk       4</span></a>
<a class="sourceLine" id="cb463-12" data-line-number="12"><span class="co">#&gt; 2 Milk  Tea        0</span></a>
<a class="sourceLine" id="cb463-13" data-line-number="13"><span class="co">#&gt; 3 Tea   Milk       0</span></a>
<a class="sourceLine" id="cb463-14" data-line-number="14"><span class="co">#&gt; 4 Tea   Tea        4</span></a>
<a class="sourceLine" id="cb463-15" data-line-number="15"><span class="co"># 6 correct guesses</span></a>
<a class="sourceLine" id="cb463-16" data-line-number="16">y &lt;-<span class="st"> </span>x <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb463-17" data-line-number="17"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Number =</span> <span class="kw">c</span>(3L, 1L, 1L, 3L))</a>
<a class="sourceLine" id="cb463-18" data-line-number="18">y</a>
<a class="sourceLine" id="cb463-19" data-line-number="19"><span class="co">#&gt; # A tibble: 4 x 3</span></a>
<a class="sourceLine" id="cb463-20" data-line-number="20"><span class="co">#&gt;   Guess Truth Number</span></a>
<a class="sourceLine" id="cb463-21" data-line-number="21"><span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt;  &lt;int&gt;</span></a>
<a class="sourceLine" id="cb463-22" data-line-number="22"><span class="co">#&gt; 1 Milk  Milk       3</span></a>
<a class="sourceLine" id="cb463-23" data-line-number="23"><span class="co">#&gt; 2 Milk  Tea        1</span></a>
<a class="sourceLine" id="cb463-24" data-line-number="24"><span class="co">#&gt; 3 Tea   Milk       1</span></a>
<a class="sourceLine" id="cb463-25" data-line-number="25"><span class="co">#&gt; 4 Tea   Tea        3</span></a>
<a class="sourceLine" id="cb463-26" data-line-number="26"><span class="co"># Turn into a 2x2 table for fisher.test</span></a>
<a class="sourceLine" id="cb463-27" data-line-number="27"><span class="kw">select</span>(<span class="kw">spread</span>(x, Truth, Number), <span class="op">-</span>Guess)</a>
<a class="sourceLine" id="cb463-28" data-line-number="28"><span class="co">#&gt; # A tibble: 2 x 2</span></a>
<a class="sourceLine" id="cb463-29" data-line-number="29"><span class="co">#&gt;    Milk   Tea</span></a>
<a class="sourceLine" id="cb463-30" data-line-number="30"><span class="co">#&gt;   &lt;int&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb463-31" data-line-number="31"><span class="co">#&gt; 1     4     0</span></a>
<a class="sourceLine" id="cb463-32" data-line-number="32"><span class="co">#&gt; 2     0     4</span></a>
<a class="sourceLine" id="cb463-33" data-line-number="33"><span class="co"># Use spread to make it a 2 x 2 table</span></a>
<a class="sourceLine" id="cb463-34" data-line-number="34"><span class="kw">fisher.test</span>(<span class="kw">select</span>(<span class="kw">spread</span>(x, Truth, Number), <span class="op">-</span>Guess),</a>
<a class="sourceLine" id="cb463-35" data-line-number="35">            <span class="dt">alternative =</span> <span class="st">&quot;greater&quot;</span>)</a>
<a class="sourceLine" id="cb463-36" data-line-number="36"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb463-37" data-line-number="37"><span class="co">#&gt;  Fisher&#39;s Exact Test for Count Data</span></a>
<a class="sourceLine" id="cb463-38" data-line-number="38"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb463-39" data-line-number="39"><span class="co">#&gt; data:  select(spread(x, Truth, Number), -Guess)</span></a>
<a class="sourceLine" id="cb463-40" data-line-number="40"><span class="co">#&gt; p-value = 0.01</span></a>
<a class="sourceLine" id="cb463-41" data-line-number="41"><span class="co">#&gt; alternative hypothesis: true odds ratio is greater than 1</span></a>
<a class="sourceLine" id="cb463-42" data-line-number="42"><span class="co">#&gt; 95 percent confidence interval:</span></a>
<a class="sourceLine" id="cb463-43" data-line-number="43"><span class="co">#&gt;    2 Inf</span></a>
<a class="sourceLine" id="cb463-44" data-line-number="44"><span class="co">#&gt; sample estimates:</span></a>
<a class="sourceLine" id="cb463-45" data-line-number="45"><span class="co">#&gt; odds ratio </span></a>
<a class="sourceLine" id="cb463-46" data-line-number="46"><span class="co">#&gt;        Inf</span></a>
<a class="sourceLine" id="cb463-47" data-line-number="47"><span class="kw">fisher.test</span>(<span class="kw">select</span>(<span class="kw">spread</span>(y, Truth, Number), <span class="op">-</span>Guess))</a>
<a class="sourceLine" id="cb463-48" data-line-number="48"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb463-49" data-line-number="49"><span class="co">#&gt;  Fisher&#39;s Exact Test for Count Data</span></a>
<a class="sourceLine" id="cb463-50" data-line-number="50"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb463-51" data-line-number="51"><span class="co">#&gt; data:  select(spread(y, Truth, Number), -Guess)</span></a>
<a class="sourceLine" id="cb463-52" data-line-number="52"><span class="co">#&gt; p-value = 0.5</span></a>
<a class="sourceLine" id="cb463-53" data-line-number="53"><span class="co">#&gt; alternative hypothesis: true odds ratio is not equal to 1</span></a>
<a class="sourceLine" id="cb463-54" data-line-number="54"><span class="co">#&gt; 95 percent confidence interval:</span></a>
<a class="sourceLine" id="cb463-55" data-line-number="55"><span class="co">#&gt;    0.212 621.934</span></a>
<a class="sourceLine" id="cb463-56" data-line-number="56"><span class="co">#&gt; sample estimates:</span></a>
<a class="sourceLine" id="cb463-57" data-line-number="57"><span class="co">#&gt; odds ratio </span></a>
<a class="sourceLine" id="cb463-58" data-line-number="58"><span class="co">#&gt;       6.41</span></a></code></pre></div>
</div>
<div id="one-sample-tests" class="section level3">
<h3><span class="header-section-number">7.2.3</span> One-Sample Tests</h3>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb464-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">1018</span></a>
<a class="sourceLine" id="cb464-2" data-line-number="2">x_bar &lt;-<span class="st"> </span><span class="dv">550</span> <span class="op">/</span><span class="st"> </span>n</a>
<a class="sourceLine" id="cb464-3" data-line-number="3">se &lt;-<span class="st"> </span><span class="kw">sqrt</span>(<span class="fl">0.5</span> <span class="op">*</span><span class="st"> </span><span class="fl">0.5</span> <span class="op">/</span><span class="st"> </span>n) <span class="co"># standard deviation of sampling distribution</span></a>
<a class="sourceLine" id="cb464-4" data-line-number="4"><span class="co"># upper red area in the figure</span></a>
<a class="sourceLine" id="cb464-5" data-line-number="5">upper &lt;-<span class="st"> </span><span class="kw">pnorm</span>(x_bar, <span class="dt">mean =</span> <span class="fl">0.5</span>, <span class="dt">sd =</span> se, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb464-6" data-line-number="6"><span class="co"># lower red area in the figure; identical to the upper area</span></a>
<a class="sourceLine" id="cb464-7" data-line-number="7">lower &lt;-<span class="st"> </span><span class="kw">pnorm</span>(<span class="fl">0.5</span> <span class="op">-</span><span class="st"> </span>(x_bar <span class="op">-</span><span class="st"> </span><span class="fl">0.5</span>), <span class="dt">mean =</span> <span class="fl">0.5</span>, <span class="dt">sd =</span> se)</a>
<a class="sourceLine" id="cb464-8" data-line-number="8"><span class="co"># two side p value</span></a>
<a class="sourceLine" id="cb464-9" data-line-number="9">upper <span class="op">+</span><span class="st"> </span>lower</a>
<a class="sourceLine" id="cb464-10" data-line-number="10"><span class="co">#&gt; [1] 0.0102</span></a>
<a class="sourceLine" id="cb464-11" data-line-number="11"><span class="dv">2</span> <span class="op">*</span><span class="st"> </span>upper</a>
<a class="sourceLine" id="cb464-12" data-line-number="12"><span class="co">#&gt; [1] 0.0102</span></a>
<a class="sourceLine" id="cb464-13" data-line-number="13"><span class="co"># one sided p value</span></a>
<a class="sourceLine" id="cb464-14" data-line-number="14">upper</a>
<a class="sourceLine" id="cb464-15" data-line-number="15"><span class="co">#&gt; [1] 0.00508</span></a>
<a class="sourceLine" id="cb464-16" data-line-number="16">z_score &lt;-<span class="st"> </span>(x_bar <span class="op">-</span><span class="st"> </span><span class="fl">0.5</span>) <span class="op">/</span><span class="st"> </span>se</a>
<a class="sourceLine" id="cb464-17" data-line-number="17">z_score</a>
<a class="sourceLine" id="cb464-18" data-line-number="18"><span class="co">#&gt; [1] 2.57</span></a>
<a class="sourceLine" id="cb464-19" data-line-number="19"><span class="kw">pnorm</span>(z_score, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>) <span class="co"># one-sided p-value</span></a>
<a class="sourceLine" id="cb464-20" data-line-number="20"><span class="co">#&gt; [1] 0.00508</span></a>
<a class="sourceLine" id="cb464-21" data-line-number="21"><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">pnorm</span>(z_score, <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>) <span class="co"># two-sided p-value</span></a>
<a class="sourceLine" id="cb464-22" data-line-number="22"><span class="co">#&gt; [1] 0.0102</span></a>
<a class="sourceLine" id="cb464-23" data-line-number="23"><span class="co"># 99% confidence interval contains 0.5</span></a>
<a class="sourceLine" id="cb464-24" data-line-number="24"><span class="kw">c</span>(x_bar <span class="op">-</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.995</span>) <span class="op">*</span><span class="st"> </span>se, x_bar <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.995</span>) <span class="op">*</span><span class="st"> </span>se)</a>
<a class="sourceLine" id="cb464-25" data-line-number="25"><span class="co">#&gt; [1] 0.500 0.581</span></a>
<a class="sourceLine" id="cb464-26" data-line-number="26"><span class="co"># 95% confidence interval does not contain 0.5</span></a>
<a class="sourceLine" id="cb464-27" data-line-number="27"><span class="kw">c</span>(x_bar <span class="op">-</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.975</span>) <span class="op">*</span><span class="st"> </span>se, x_bar <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.975</span>) <span class="op">*</span><span class="st"> </span>se)</a>
<a class="sourceLine" id="cb464-28" data-line-number="28"><span class="co">#&gt; [1] 0.510 0.571</span></a>
<a class="sourceLine" id="cb464-29" data-line-number="29"><span class="co"># no continuity correction to get the same p-value as above</span></a>
<a class="sourceLine" id="cb464-30" data-line-number="30"><span class="kw">prop.test</span>(<span class="dv">550</span>, <span class="dt">n =</span> n, <span class="dt">p =</span> <span class="fl">0.5</span>, <span class="dt">correct =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb464-31" data-line-number="31"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb464-32" data-line-number="32"><span class="co">#&gt;  1-sample proportions test without continuity correction</span></a>
<a class="sourceLine" id="cb464-33" data-line-number="33"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb464-34" data-line-number="34"><span class="co">#&gt; data:  550 out of n, null probability 0.5</span></a>
<a class="sourceLine" id="cb464-35" data-line-number="35"><span class="co">#&gt; X-squared = 7, df = 1, p-value = 0.01</span></a>
<a class="sourceLine" id="cb464-36" data-line-number="36"><span class="co">#&gt; alternative hypothesis: true p is not equal to 0.5</span></a>
<a class="sourceLine" id="cb464-37" data-line-number="37"><span class="co">#&gt; 95 percent confidence interval:</span></a>
<a class="sourceLine" id="cb464-38" data-line-number="38"><span class="co">#&gt;  0.510 0.571</span></a>
<a class="sourceLine" id="cb464-39" data-line-number="39"><span class="co">#&gt; sample estimates:</span></a>
<a class="sourceLine" id="cb464-40" data-line-number="40"><span class="co">#&gt;    p </span></a>
<a class="sourceLine" id="cb464-41" data-line-number="41"><span class="co">#&gt; 0.54</span></a>
<a class="sourceLine" id="cb464-42" data-line-number="42"><span class="co"># with continuity correction</span></a>
<a class="sourceLine" id="cb464-43" data-line-number="43"><span class="kw">prop.test</span>(<span class="dv">550</span>, <span class="dt">n =</span> n, <span class="dt">p =</span> <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb464-44" data-line-number="44"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb464-45" data-line-number="45"><span class="co">#&gt;  1-sample proportions test with continuity correction</span></a>
<a class="sourceLine" id="cb464-46" data-line-number="46"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb464-47" data-line-number="47"><span class="co">#&gt; data:  550 out of n, null probability 0.5</span></a>
<a class="sourceLine" id="cb464-48" data-line-number="48"><span class="co">#&gt; X-squared = 6, df = 1, p-value = 0.01</span></a>
<a class="sourceLine" id="cb464-49" data-line-number="49"><span class="co">#&gt; alternative hypothesis: true p is not equal to 0.5</span></a>
<a class="sourceLine" id="cb464-50" data-line-number="50"><span class="co">#&gt; 95 percent confidence interval:</span></a>
<a class="sourceLine" id="cb464-51" data-line-number="51"><span class="co">#&gt;  0.509 0.571</span></a>
<a class="sourceLine" id="cb464-52" data-line-number="52"><span class="co">#&gt; sample estimates:</span></a>
<a class="sourceLine" id="cb464-53" data-line-number="53"><span class="co">#&gt;    p </span></a>
<a class="sourceLine" id="cb464-54" data-line-number="54"><span class="co">#&gt; 0.54</span></a>
<a class="sourceLine" id="cb464-55" data-line-number="55"><span class="kw">prop.test</span>(<span class="dv">550</span>, <span class="dt">n =</span> n, <span class="dt">p =</span> <span class="fl">0.5</span>, <span class="dt">conf.level =</span> <span class="fl">0.99</span>)</a>
<a class="sourceLine" id="cb464-56" data-line-number="56"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb464-57" data-line-number="57"><span class="co">#&gt;  1-sample proportions test with continuity correction</span></a>
<a class="sourceLine" id="cb464-58" data-line-number="58"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb464-59" data-line-number="59"><span class="co">#&gt; data:  550 out of n, null probability 0.5</span></a>
<a class="sourceLine" id="cb464-60" data-line-number="60"><span class="co">#&gt; X-squared = 6, df = 1, p-value = 0.01</span></a>
<a class="sourceLine" id="cb464-61" data-line-number="61"><span class="co">#&gt; alternative hypothesis: true p is not equal to 0.5</span></a>
<a class="sourceLine" id="cb464-62" data-line-number="62"><span class="co">#&gt; 99 percent confidence interval:</span></a>
<a class="sourceLine" id="cb464-63" data-line-number="63"><span class="co">#&gt;  0.499 0.581</span></a>
<a class="sourceLine" id="cb464-64" data-line-number="64"><span class="co">#&gt; sample estimates:</span></a>
<a class="sourceLine" id="cb464-65" data-line-number="65"><span class="co">#&gt;    p </span></a>
<a class="sourceLine" id="cb464-66" data-line-number="66"><span class="co">#&gt; 0.54</span></a></code></pre></div>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb465-1" data-line-number="1"><span class="co"># two-sided one-sample t-test</span></a>
<a class="sourceLine" id="cb465-2" data-line-number="2"><span class="kw">t.test</span>(STAR<span class="op">$</span>g4reading, <span class="dt">mu =</span> <span class="dv">710</span>)</a>
<a class="sourceLine" id="cb465-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb465-4" data-line-number="4"><span class="co">#&gt;  One Sample t-test</span></a>
<a class="sourceLine" id="cb465-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb465-6" data-line-number="6"><span class="co">#&gt; data:  STAR$g4reading</span></a>
<a class="sourceLine" id="cb465-7" data-line-number="7"><span class="co">#&gt; t = 10, df = 2000, p-value &lt;2e-16</span></a>
<a class="sourceLine" id="cb465-8" data-line-number="8"><span class="co">#&gt; alternative hypothesis: true mean is not equal to 710</span></a>
<a class="sourceLine" id="cb465-9" data-line-number="9"><span class="co">#&gt; 95 percent confidence interval:</span></a>
<a class="sourceLine" id="cb465-10" data-line-number="10"><span class="co">#&gt;  719 723</span></a>
<a class="sourceLine" id="cb465-11" data-line-number="11"><span class="co">#&gt; sample estimates:</span></a>
<a class="sourceLine" id="cb465-12" data-line-number="12"><span class="co">#&gt; mean of x </span></a>
<a class="sourceLine" id="cb465-13" data-line-number="13"><span class="co">#&gt;       721</span></a></code></pre></div>
</div>
<div id="two-sample-tests" class="section level3">
<h3><span class="header-section-number">7.2.4</span> Two-sample tests</h3>
<p>The ATE estimates are stored in a data frame, <code>star_ate</code>. Note that the <a href="https://cran.r-project.org/package=dplyr">dplyr</a> function <a href="https://www.rdocumentation.org/packages/dplyr/topics/transmute">transmute</a> is like <code>mutate</code>, but only returns the variables specified in the function.</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb466-1" data-line-number="1">star_ate <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb466-2" data-line-number="2"><span class="st">  </span><span class="kw">transmute</span>(<span class="dt">p_value_1sided =</span> <span class="kw">pnorm</span>(<span class="op">-</span><span class="kw">abs</span>(ate_est),</a>
<a class="sourceLine" id="cb466-3" data-line-number="3">                                   <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> ate_se),</a>
<a class="sourceLine" id="cb466-4" data-line-number="4">            <span class="dt">p_value_2sided =</span> <span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">pnorm</span>(<span class="op">-</span><span class="kw">abs</span>(ate_est), <span class="dt">mean =</span> <span class="dv">0</span>,</a>
<a class="sourceLine" id="cb466-5" data-line-number="5">                                   <span class="dt">sd =</span> ate_se))</a>
<a class="sourceLine" id="cb466-6" data-line-number="6"><span class="co">#&gt; # A tibble: 1 x 2</span></a>
<a class="sourceLine" id="cb466-7" data-line-number="7"><span class="co">#&gt;   p_value_1sided p_value_2sided</span></a>
<a class="sourceLine" id="cb466-8" data-line-number="8"><span class="co">#&gt;            &lt;dbl&gt;          &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb466-9" data-line-number="9"><span class="co">#&gt; 1         0.0935          0.187</span></a>
<a class="sourceLine" id="cb466-10" data-line-number="10"></a>
<a class="sourceLine" id="cb466-11" data-line-number="11"><span class="kw">t.test</span>(g4reading <span class="op">~</span><span class="st"> </span>classtype,</a>
<a class="sourceLine" id="cb466-12" data-line-number="12">  <span class="dt">data =</span> <span class="kw">filter</span>(STAR, classtype <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;small class&quot;</span>, <span class="st">&quot;regular class&quot;</span>)))</a>
<a class="sourceLine" id="cb466-13" data-line-number="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb466-14" data-line-number="14"><span class="co">#&gt;  Welch Two Sample t-test</span></a>
<a class="sourceLine" id="cb466-15" data-line-number="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb466-16" data-line-number="16"><span class="co">#&gt; data:  g4reading by classtype</span></a>
<a class="sourceLine" id="cb466-17" data-line-number="17"><span class="co">#&gt; t = 1, df = 2000, p-value = 0.2</span></a>
<a class="sourceLine" id="cb466-18" data-line-number="18"><span class="co">#&gt; alternative hypothesis: true difference in means is not equal to 0</span></a>
<a class="sourceLine" id="cb466-19" data-line-number="19"><span class="co">#&gt; 95 percent confidence interval:</span></a>
<a class="sourceLine" id="cb466-20" data-line-number="20"><span class="co">#&gt;  -1.70  8.71</span></a>
<a class="sourceLine" id="cb466-21" data-line-number="21"><span class="co">#&gt; sample estimates:</span></a>
<a class="sourceLine" id="cb466-22" data-line-number="22"><span class="co">#&gt;   mean in group small class mean in group regular class </span></a>
<a class="sourceLine" id="cb466-23" data-line-number="23"><span class="co">#&gt;                         723                         720</span></a></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb467-1" data-line-number="1"><span class="kw">t.test</span>(<span class="kw">filter</span>(STAR, classtype <span class="op">==</span><span class="st"> &quot;small class&quot;</span>)<span class="op">$</span>g4reading,</a>
<a class="sourceLine" id="cb467-2" data-line-number="2">       <span class="kw">filter</span>(STAR, classtype <span class="op">==</span><span class="st"> &quot;regular class&quot;</span>)<span class="op">$</span>g4reading)</a>
<a class="sourceLine" id="cb467-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb467-4" data-line-number="4"><span class="co">#&gt;  Welch Two Sample t-test</span></a>
<a class="sourceLine" id="cb467-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb467-6" data-line-number="6"><span class="co">#&gt; data:  filter(STAR, classtype == &quot;small class&quot;)$g4reading and filter(STAR, classtype == &quot;regular class&quot;)$g4reading</span></a>
<a class="sourceLine" id="cb467-7" data-line-number="7"><span class="co">#&gt; t = 1, df = 2000, p-value = 0.2</span></a>
<a class="sourceLine" id="cb467-8" data-line-number="8"><span class="co">#&gt; alternative hypothesis: true difference in means is not equal to 0</span></a>
<a class="sourceLine" id="cb467-9" data-line-number="9"><span class="co">#&gt; 95 percent confidence interval:</span></a>
<a class="sourceLine" id="cb467-10" data-line-number="10"><span class="co">#&gt;  -1.70  8.71</span></a>
<a class="sourceLine" id="cb467-11" data-line-number="11"><span class="co">#&gt; sample estimates:</span></a>
<a class="sourceLine" id="cb467-12" data-line-number="12"><span class="co">#&gt; mean of x mean of y </span></a>
<a class="sourceLine" id="cb467-13" data-line-number="13"><span class="co">#&gt;       723       720</span></a></code></pre></div>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb468-1" data-line-number="1"><span class="kw">data</span>(<span class="st">&quot;resume&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;qss&quot;</span>)</a>
<a class="sourceLine" id="cb468-2" data-line-number="2">x &lt;-<span class="st"> </span>resume <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb468-3" data-line-number="3"><span class="st">  </span><span class="kw">count</span>(race, call) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb468-4" data-line-number="4"><span class="st">  </span><span class="kw">spread</span>(call, n) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb468-5" data-line-number="5"><span class="st">  </span><span class="kw">ungroup</span>()</a>
<a class="sourceLine" id="cb468-6" data-line-number="6">x</a>
<a class="sourceLine" id="cb468-7" data-line-number="7"><span class="co">#&gt; # A tibble: 2 x 3</span></a>
<a class="sourceLine" id="cb468-8" data-line-number="8"><span class="co">#&gt;   race    `0`   `1`</span></a>
<a class="sourceLine" id="cb468-9" data-line-number="9"><span class="co">#&gt;   &lt;chr&gt; &lt;int&gt; &lt;int&gt;</span></a>
<a class="sourceLine" id="cb468-10" data-line-number="10"><span class="co">#&gt; 1 black  2278   157</span></a>
<a class="sourceLine" id="cb468-11" data-line-number="11"><span class="co">#&gt; 2 white  2200   235</span></a>
<a class="sourceLine" id="cb468-12" data-line-number="12"><span class="kw">prop.test</span>(<span class="kw">as.matrix</span>(<span class="kw">select</span>(x, <span class="op">-</span>race)), <span class="dt">alternative =</span> <span class="st">&quot;greater&quot;</span>)</a>
<a class="sourceLine" id="cb468-13" data-line-number="13"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb468-14" data-line-number="14"><span class="co">#&gt;  2-sample test for equality of proportions with continuity</span></a>
<a class="sourceLine" id="cb468-15" data-line-number="15"><span class="co">#&gt;  correction</span></a>
<a class="sourceLine" id="cb468-16" data-line-number="16"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb468-17" data-line-number="17"><span class="co">#&gt; data:  as.matrix(select(x, -race))</span></a>
<a class="sourceLine" id="cb468-18" data-line-number="18"><span class="co">#&gt; X-squared = 20, df = 1, p-value = 2e-05</span></a>
<a class="sourceLine" id="cb468-19" data-line-number="19"><span class="co">#&gt; alternative hypothesis: greater</span></a>
<a class="sourceLine" id="cb468-20" data-line-number="20"><span class="co">#&gt; 95 percent confidence interval:</span></a>
<a class="sourceLine" id="cb468-21" data-line-number="21"><span class="co">#&gt;  0.0188 1.0000</span></a>
<a class="sourceLine" id="cb468-22" data-line-number="22"><span class="co">#&gt; sample estimates:</span></a>
<a class="sourceLine" id="cb468-23" data-line-number="23"><span class="co">#&gt; prop 1 prop 2 </span></a>
<a class="sourceLine" id="cb468-24" data-line-number="24"><span class="co">#&gt;  0.936  0.903</span></a></code></pre></div>
<p>Assign sample sizes and proportions, then calculate point estimates, standard error, z-statistic and one-sided p-value.</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb469-1" data-line-number="1">n0 &lt;-<span class="st"> </span><span class="kw">sum</span>(resume<span class="op">$</span>race <span class="op">==</span><span class="st"> &quot;black&quot;</span>)</a>
<a class="sourceLine" id="cb469-2" data-line-number="2">n1 &lt;-<span class="st"> </span><span class="kw">sum</span>(resume<span class="op">$</span>race <span class="op">==</span><span class="st"> &quot;white&quot;</span>)</a>
<a class="sourceLine" id="cb469-3" data-line-number="3"></a>
<a class="sourceLine" id="cb469-4" data-line-number="4">p &lt;-<span class="st"> </span><span class="kw">mean</span>(resume<span class="op">$</span>call) </a>
<a class="sourceLine" id="cb469-5" data-line-number="5">p0 &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">filter</span>(resume, race <span class="op">==</span><span class="st"> &quot;black&quot;</span>)<span class="op">$</span>call)</a>
<a class="sourceLine" id="cb469-6" data-line-number="6">p1 &lt;-<span class="st"> </span><span class="kw">mean</span>(<span class="kw">filter</span>(resume, race <span class="op">==</span><span class="st"> &quot;white&quot;</span>)<span class="op">$</span>call)</a>
<a class="sourceLine" id="cb469-7" data-line-number="7"></a>
<a class="sourceLine" id="cb469-8" data-line-number="8">est &lt;-<span class="st"> </span>p1 <span class="op">-</span><span class="st"> </span>p0</a>
<a class="sourceLine" id="cb469-9" data-line-number="9">est</a>
<a class="sourceLine" id="cb469-10" data-line-number="10"><span class="co">#&gt; [1] 0.032</span></a>
<a class="sourceLine" id="cb469-11" data-line-number="11"></a>
<a class="sourceLine" id="cb469-12" data-line-number="12">se &lt;-<span class="st"> </span><span class="kw">sqrt</span>(p <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p) <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>n0 <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>n1))</a>
<a class="sourceLine" id="cb469-13" data-line-number="13">se</a>
<a class="sourceLine" id="cb469-14" data-line-number="14"><span class="co">#&gt; [1] 0.0078</span></a>
<a class="sourceLine" id="cb469-15" data-line-number="15"></a>
<a class="sourceLine" id="cb469-16" data-line-number="16">zstat &lt;-<span class="st"> </span>est <span class="op">/</span><span class="st"> </span>se</a>
<a class="sourceLine" id="cb469-17" data-line-number="17">zstat</a>
<a class="sourceLine" id="cb469-18" data-line-number="18"><span class="co">#&gt; [1] 4.11</span></a>
<a class="sourceLine" id="cb469-19" data-line-number="19"></a>
<a class="sourceLine" id="cb469-20" data-line-number="20"><span class="kw">pnorm</span>(<span class="op">-</span><span class="kw">abs</span>(zstat))</a>
<a class="sourceLine" id="cb469-21" data-line-number="21"><span class="co">#&gt; [1] 1.99e-05</span></a></code></pre></div>
<p>The only thing that changed is using <a href="https://www.rdocumentation.org/packages/dplyr/topics/filter">filter</a> for selecting the groups.</p>
</div>
<div id="power-analysis" class="section level3">
<h3><span class="header-section-number">7.2.5</span> Power Analysis</h3>
<p>Set the parameters: the sample size,</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb470-1" data-line-number="1">n &lt;-<span class="st"> </span><span class="dv">250</span></a></code></pre></div>
<p>the population proportional under the alternative data generating process,</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb471-1" data-line-number="1">p_star &lt;-<span class="st"> </span><span class="fl">0.48</span></a></code></pre></div>
<p>the null hypothesis,</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb472-1" data-line-number="1">p &lt;-<span class="st"> </span><span class="fl">0.5</span> </a></code></pre></div>
<p>the p-value,</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb473-1" data-line-number="1">alpha &lt;-<span class="st"> </span><span class="fl">0.05</span></a></code></pre></div>
<p>and</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb474-1" data-line-number="1">cr_value &lt;-<span class="st"> </span><span class="kw">qnorm</span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>alpha <span class="op">/</span><span class="st"> </span><span class="dv">2</span>)</a></code></pre></div>
<p>The standard errors under the hypothetical data generating process is</p>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb475-1" data-line-number="1">se_star &lt;-<span class="st"> </span><span class="kw">sqrt</span>(p_star <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p_star) <span class="op">/</span><span class="st"> </span>n)</a></code></pre></div>
<p>and the standard error under the null is</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb476-1" data-line-number="1">se &lt;-<span class="st"> </span><span class="kw">sqrt</span>(p <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p) <span class="op">/</span><span class="st"> </span>n)</a></code></pre></div>
<p>The power for this test is</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb477-1" data-line-number="1"><span class="kw">pnorm</span>(p <span class="op">-</span><span class="st"> </span>cr_value <span class="op">*</span><span class="st"> </span>se, <span class="dt">mean =</span> p_star, <span class="dt">sd =</span> se_star) <span class="op">+</span></a>
<a class="sourceLine" id="cb477-2" data-line-number="2"><span class="st">    </span><span class="kw">pnorm</span>(p <span class="op">+</span><span class="st"> </span>cr_value <span class="op">*</span><span class="st"> </span>se, <span class="dt">mean =</span> p_star, <span class="dt">sd =</span> se_star,</a>
<a class="sourceLine" id="cb477-3" data-line-number="3">          <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb477-4" data-line-number="4"><span class="co">#&gt; [1] 0.0967</span></a></code></pre></div>
<p>The parameters (sample sizes and proportions) are</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb478-1" data-line-number="1">n1 &lt;-<span class="st"> </span><span class="dv">500</span></a>
<a class="sourceLine" id="cb478-2" data-line-number="2">n0 &lt;-<span class="st"> </span><span class="dv">500</span></a>
<a class="sourceLine" id="cb478-3" data-line-number="3">p1_star &lt;-<span class="st"> </span><span class="fl">0.05</span></a>
<a class="sourceLine" id="cb478-4" data-line-number="4">p0_star &lt;-<span class="st"> </span><span class="fl">0.1</span></a></code></pre></div>
<p>Calculate the overall call back rate as a weighted average,</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb479-1" data-line-number="1">p &lt;-<span class="st"> </span>(n1 <span class="op">*</span><span class="st"> </span>p1_star <span class="op">+</span><span class="st"> </span>n0 <span class="op">*</span><span class="st"> </span>p0_star) <span class="op">/</span><span class="st"> </span>(n1 <span class="op">+</span><span class="st"> </span>n0)</a></code></pre></div>
<p>the standard error under the null,</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb480-1" data-line-number="1">se &lt;-<span class="st"> </span><span class="kw">sqrt</span>(p <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p) <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">/</span><span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="op">/</span><span class="st"> </span>n0))</a></code></pre></div>
<p>the standard error under the hypothetical data generating process,</p>
<div class="sourceCode" id="cb481"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb481-1" data-line-number="1">se.star &lt;-<span class="st"> </span><span class="kw">sqrt</span>(p1_star <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p1_star) <span class="op">/</span><span class="st"> </span>n1 <span class="op">+</span><span class="st"> </span>p0_star <span class="op">*</span><span class="st"> </span>(<span class="dv">1</span> <span class="op">-</span><span class="st"> </span>p0_star) <span class="op">/</span><span class="st"> </span>n0)</a></code></pre></div>
<div class="sourceCode" id="cb482"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb482-1" data-line-number="1"><span class="kw">pnorm</span>(<span class="op">-</span>cr_value <span class="op">*</span><span class="st"> </span>se, <span class="dt">mean =</span> p1_star <span class="op">-</span><span class="st"> </span>p0_star, <span class="dt">sd =</span> se.star) <span class="op">+</span></a>
<a class="sourceLine" id="cb482-2" data-line-number="2"><span class="st">    </span><span class="kw">pnorm</span>(cr_value <span class="op">*</span><span class="st"> </span>se, <span class="dt">mean =</span> p1_star <span class="op">-</span><span class="st"> </span>p0_star, <span class="dt">sd =</span> se.star,</a>
<a class="sourceLine" id="cb482-3" data-line-number="3">          <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb482-4" data-line-number="4"><span class="co">#&gt; [1] 0.852</span></a></code></pre></div>
<div class="sourceCode" id="cb483"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb483-1" data-line-number="1"><span class="kw">power.prop.test</span>(<span class="dt">n =</span> <span class="dv">500</span>, <span class="dt">p1 =</span> <span class="fl">0.05</span>, <span class="dt">p2 =</span> <span class="fl">0.1</span>, <span class="dt">sig.level =</span> <span class="fl">0.05</span>)</a>
<a class="sourceLine" id="cb483-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb483-3" data-line-number="3"><span class="co">#&gt;      Two-sample comparison of proportions power calculation </span></a>
<a class="sourceLine" id="cb483-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb483-5" data-line-number="5"><span class="co">#&gt;               n = 500</span></a>
<a class="sourceLine" id="cb483-6" data-line-number="6"><span class="co">#&gt;              p1 = 0.05</span></a>
<a class="sourceLine" id="cb483-7" data-line-number="7"><span class="co">#&gt;              p2 = 0.1</span></a>
<a class="sourceLine" id="cb483-8" data-line-number="8"><span class="co">#&gt;       sig.level = 0.05</span></a>
<a class="sourceLine" id="cb483-9" data-line-number="9"><span class="co">#&gt;           power = 0.852</span></a>
<a class="sourceLine" id="cb483-10" data-line-number="10"><span class="co">#&gt;     alternative = two.sided</span></a>
<a class="sourceLine" id="cb483-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb483-12" data-line-number="12"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: n is number in *each* group</span></a></code></pre></div>
<div class="sourceCode" id="cb484"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb484-1" data-line-number="1"><span class="kw">power.prop.test</span>(<span class="dt">p1 =</span> <span class="fl">0.05</span>, <span class="dt">p2 =</span> <span class="fl">0.1</span>, <span class="dt">sig.level =</span> <span class="fl">0.05</span>, <span class="dt">power =</span> <span class="fl">0.9</span>)</a>
<a class="sourceLine" id="cb484-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb484-3" data-line-number="3"><span class="co">#&gt;      Two-sample comparison of proportions power calculation </span></a>
<a class="sourceLine" id="cb484-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb484-5" data-line-number="5"><span class="co">#&gt;               n = 581</span></a>
<a class="sourceLine" id="cb484-6" data-line-number="6"><span class="co">#&gt;              p1 = 0.05</span></a>
<a class="sourceLine" id="cb484-7" data-line-number="7"><span class="co">#&gt;              p2 = 0.1</span></a>
<a class="sourceLine" id="cb484-8" data-line-number="8"><span class="co">#&gt;       sig.level = 0.05</span></a>
<a class="sourceLine" id="cb484-9" data-line-number="9"><span class="co">#&gt;           power = 0.9</span></a>
<a class="sourceLine" id="cb484-10" data-line-number="10"><span class="co">#&gt;     alternative = two.sided</span></a>
<a class="sourceLine" id="cb484-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb484-12" data-line-number="12"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: n is number in *each* group</span></a></code></pre></div>
<div class="sourceCode" id="cb485"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb485-1" data-line-number="1"><span class="kw">power.t.test</span>(<span class="dt">n =</span> <span class="dv">100</span>, <span class="dt">delta =</span> <span class="fl">0.25</span>, <span class="dt">sd =</span> <span class="dv">1</span>, <span class="dt">type =</span> <span class="st">&quot;one.sample&quot;</span>)</a>
<a class="sourceLine" id="cb485-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb485-3" data-line-number="3"><span class="co">#&gt;      One-sample t test power calculation </span></a>
<a class="sourceLine" id="cb485-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb485-5" data-line-number="5"><span class="co">#&gt;               n = 100</span></a>
<a class="sourceLine" id="cb485-6" data-line-number="6"><span class="co">#&gt;           delta = 0.25</span></a>
<a class="sourceLine" id="cb485-7" data-line-number="7"><span class="co">#&gt;              sd = 1</span></a>
<a class="sourceLine" id="cb485-8" data-line-number="8"><span class="co">#&gt;       sig.level = 0.05</span></a>
<a class="sourceLine" id="cb485-9" data-line-number="9"><span class="co">#&gt;           power = 0.697</span></a>
<a class="sourceLine" id="cb485-10" data-line-number="10"><span class="co">#&gt;     alternative = two.sided</span></a></code></pre></div>
<div class="sourceCode" id="cb486"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb486-1" data-line-number="1"><span class="kw">power.t.test</span>(<span class="dt">power =</span> <span class="fl">0.9</span>, <span class="dt">delta =</span> <span class="fl">0.25</span>, <span class="dt">sd =</span> <span class="dv">1</span>, <span class="dt">type =</span> <span class="st">&quot;one.sample&quot;</span>)</a>
<a class="sourceLine" id="cb486-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb486-3" data-line-number="3"><span class="co">#&gt;      One-sample t test power calculation </span></a>
<a class="sourceLine" id="cb486-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb486-5" data-line-number="5"><span class="co">#&gt;               n = 170</span></a>
<a class="sourceLine" id="cb486-6" data-line-number="6"><span class="co">#&gt;           delta = 0.25</span></a>
<a class="sourceLine" id="cb486-7" data-line-number="7"><span class="co">#&gt;              sd = 1</span></a>
<a class="sourceLine" id="cb486-8" data-line-number="8"><span class="co">#&gt;       sig.level = 0.05</span></a>
<a class="sourceLine" id="cb486-9" data-line-number="9"><span class="co">#&gt;           power = 0.9</span></a>
<a class="sourceLine" id="cb486-10" data-line-number="10"><span class="co">#&gt;     alternative = two.sided</span></a></code></pre></div>
<div class="sourceCode" id="cb487"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb487-1" data-line-number="1"><span class="kw">power.t.test</span>(<span class="dt">delta =</span> <span class="fl">0.25</span>, <span class="dt">sd =</span> <span class="dv">1</span>, <span class="dt">type =</span> <span class="st">&quot;two.sample&quot;</span>,</a>
<a class="sourceLine" id="cb487-2" data-line-number="2">             <span class="dt">alternative =</span> <span class="st">&quot;one.sided&quot;</span>, <span class="dt">power =</span> <span class="fl">0.9</span>)</a>
<a class="sourceLine" id="cb487-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb487-4" data-line-number="4"><span class="co">#&gt;      Two-sample t test power calculation </span></a>
<a class="sourceLine" id="cb487-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb487-6" data-line-number="6"><span class="co">#&gt;               n = 275</span></a>
<a class="sourceLine" id="cb487-7" data-line-number="7"><span class="co">#&gt;           delta = 0.25</span></a>
<a class="sourceLine" id="cb487-8" data-line-number="8"><span class="co">#&gt;              sd = 1</span></a>
<a class="sourceLine" id="cb487-9" data-line-number="9"><span class="co">#&gt;       sig.level = 0.05</span></a>
<a class="sourceLine" id="cb487-10" data-line-number="10"><span class="co">#&gt;           power = 0.9</span></a>
<a class="sourceLine" id="cb487-11" data-line-number="11"><span class="co">#&gt;     alternative = one.sided</span></a>
<a class="sourceLine" id="cb487-12" data-line-number="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb487-13" data-line-number="13"><span class="co">#&gt; </span><span class="al">NOTE</span><span class="co">: n is number in *each* group</span></a></code></pre></div>
</div>
</div>
<div id="linear-regression-model-with-uncertainty" class="section level2">
<h2><span class="header-section-number">7.3</span> Linear Regression Model with Uncertainty</h2>
<div id="linear-regression-as-a-generative-model" class="section level3">
<h3><span class="header-section-number">7.3.1</span> Linear Regression as a Generative Model</h3>
<p>Load the minimum wage date included with the <strong>qss</strong> package:</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb488-1" data-line-number="1"><span class="kw">data</span>(<span class="st">&quot;minwage&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;qss&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb489"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb489-1" data-line-number="1">minwage &lt;-<span class="st"> </span><span class="kw">mutate</span>(minwage,</a>
<a class="sourceLine" id="cb489-2" data-line-number="2">                  <span class="dt">fullPropBefore =</span> fullBefore <span class="op">/</span><span class="st"> </span>(fullBefore <span class="op">+</span><span class="st"> </span>partBefore),</a>
<a class="sourceLine" id="cb489-3" data-line-number="3">                  <span class="dt">fullPropAfter =</span> fullAfter <span class="op">/</span><span class="st"> </span>(fullAfter <span class="op">+</span><span class="st"> </span>partAfter),</a>
<a class="sourceLine" id="cb489-4" data-line-number="4">                  <span class="dt">NJ =</span> <span class="kw">as.integer</span>(location <span class="op">==</span><span class="st"> &quot;PA&quot;</span>))</a></code></pre></div>
<div class="sourceCode" id="cb490"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb490-1" data-line-number="1">fit_minwage &lt;-<span class="st"> </span><span class="kw">lm</span>(fullPropAfter <span class="op">~</span><span class="st"> </span><span class="dv">-1</span> <span class="op">+</span><span class="st"> </span>NJ <span class="op">+</span><span class="st"> </span>fullPropBefore <span class="op">+</span></a>
<a class="sourceLine" id="cb490-2" data-line-number="2"><span class="st">                    </span>wageBefore <span class="op">+</span><span class="st"> </span>chain, <span class="dt">data =</span> minwage)</a>
<a class="sourceLine" id="cb490-3" data-line-number="3">fit_minwage</a>
<a class="sourceLine" id="cb490-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb490-5" data-line-number="5"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb490-6" data-line-number="6"><span class="co">#&gt; lm(formula = fullPropAfter ~ -1 + NJ + fullPropBefore + wageBefore + </span></a>
<a class="sourceLine" id="cb490-7" data-line-number="7"><span class="co">#&gt;     chain, data = minwage)</span></a>
<a class="sourceLine" id="cb490-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb490-9" data-line-number="9"><span class="co">#&gt; Coefficients:</span></a>
<a class="sourceLine" id="cb490-10" data-line-number="10"><span class="co">#&gt;              NJ   fullPropBefore       wageBefore  chainburgerking  </span></a>
<a class="sourceLine" id="cb490-11" data-line-number="11"><span class="co">#&gt;         -0.0542           0.1688           0.0813          -0.0614  </span></a>
<a class="sourceLine" id="cb490-12" data-line-number="12"><span class="co">#&gt;        chainkfc        chainroys      chainwendys  </span></a>
<a class="sourceLine" id="cb490-13" data-line-number="13"><span class="co">#&gt;         -0.0966          -0.1522          -0.1659</span></a>
<a class="sourceLine" id="cb490-14" data-line-number="14">fit_minwage1 &lt;-<span class="st"> </span><span class="kw">lm</span>(fullPropAfter <span class="op">~</span><span class="st"> </span>NJ <span class="op">+</span><span class="st"> </span>fullPropBefore <span class="op">+</span></a>
<a class="sourceLine" id="cb490-15" data-line-number="15"><span class="st">                     </span>wageBefore <span class="op">+</span><span class="st"> </span>chain, <span class="dt">data =</span> minwage)</a>
<a class="sourceLine" id="cb490-16" data-line-number="16">fit_minwage1</a>
<a class="sourceLine" id="cb490-17" data-line-number="17"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb490-18" data-line-number="18"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb490-19" data-line-number="19"><span class="co">#&gt; lm(formula = fullPropAfter ~ NJ + fullPropBefore + wageBefore + </span></a>
<a class="sourceLine" id="cb490-20" data-line-number="20"><span class="co">#&gt;     chain, data = minwage)</span></a>
<a class="sourceLine" id="cb490-21" data-line-number="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb490-22" data-line-number="22"><span class="co">#&gt; Coefficients:</span></a>
<a class="sourceLine" id="cb490-23" data-line-number="23"><span class="co">#&gt;    (Intercept)              NJ  fullPropBefore      wageBefore  </span></a>
<a class="sourceLine" id="cb490-24" data-line-number="24"><span class="co">#&gt;        -0.0614         -0.0542          0.1688          0.0813  </span></a>
<a class="sourceLine" id="cb490-25" data-line-number="25"><span class="co">#&gt;       chainkfc       chainroys     chainwendys  </span></a>
<a class="sourceLine" id="cb490-26" data-line-number="26"><span class="co">#&gt;        -0.0352         -0.0908         -0.1045</span></a>
<a class="sourceLine" id="cb490-27" data-line-number="27"><span class="kw">gather_predictions</span>(<span class="kw">slice</span>(minwage, <span class="dv">1</span>), fit_minwage, fit_minwage1) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb490-28" data-line-number="28"><span class="st">  </span><span class="kw">select</span>(model, pred)</a>
<a class="sourceLine" id="cb490-29" data-line-number="29"><span class="co">#&gt; # A tibble: 2 x 2</span></a>
<a class="sourceLine" id="cb490-30" data-line-number="30"><span class="co">#&gt;   model         pred</span></a>
<a class="sourceLine" id="cb490-31" data-line-number="31"><span class="co">#&gt;   &lt;chr&gt;        &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb490-32" data-line-number="32"><span class="co">#&gt; 1 fit_minwage  0.271</span></a>
<a class="sourceLine" id="cb490-33" data-line-number="33"><span class="co">#&gt; 2 fit_minwage1 0.271</span></a></code></pre></div>
</div>
<div id="inference-about-coefficients" class="section level3">
<h3><span class="header-section-number">7.3.2</span> Inference about coefficients</h3>
<p>Use the <a href="https://www.rdocumentation.org/packages/broom/topics/tidy">tidy</a> function to return the coefficients, including confidence intervals, as a data frame:</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb491-1" data-line-number="1"><span class="kw">data</span>(<span class="st">&quot;women&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;qss&quot;</span>)</a>
<a class="sourceLine" id="cb491-2" data-line-number="2">fit_women &lt;-<span class="st"> </span><span class="kw">lm</span>(water <span class="op">~</span><span class="st"> </span>reserved, <span class="dt">data =</span> women)</a>
<a class="sourceLine" id="cb491-3" data-line-number="3"><span class="kw">summary</span>(fit_women)</a>
<a class="sourceLine" id="cb491-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb491-5" data-line-number="5"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb491-6" data-line-number="6"><span class="co">#&gt; lm(formula = water ~ reserved, data = women)</span></a>
<a class="sourceLine" id="cb491-7" data-line-number="7"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb491-8" data-line-number="8"><span class="co">#&gt; Residuals:</span></a>
<a class="sourceLine" id="cb491-9" data-line-number="9"><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></a>
<a class="sourceLine" id="cb491-10" data-line-number="10"><span class="co">#&gt; -23.99 -14.74  -7.86   2.26 316.01 </span></a>
<a class="sourceLine" id="cb491-11" data-line-number="11"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb491-12" data-line-number="12"><span class="co">#&gt; Coefficients:</span></a>
<a class="sourceLine" id="cb491-13" data-line-number="13"><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></a>
<a class="sourceLine" id="cb491-14" data-line-number="14"><span class="co">#&gt; (Intercept)    14.74       2.29    6.45  4.2e-10 ***</span></a>
<a class="sourceLine" id="cb491-15" data-line-number="15"><span class="co">#&gt; reserved        9.25       3.95    2.34     0.02 *  </span></a>
<a class="sourceLine" id="cb491-16" data-line-number="16"><span class="co">#&gt; ---</span></a>
<a class="sourceLine" id="cb491-17" data-line-number="17"><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></a>
<a class="sourceLine" id="cb491-18" data-line-number="18"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb491-19" data-line-number="19"><span class="co">#&gt; Residual standard error: 33.4 on 320 degrees of freedom</span></a>
<a class="sourceLine" id="cb491-20" data-line-number="20"><span class="co">#&gt; Multiple R-squared:  0.0169, Adjusted R-squared:  0.0138 </span></a>
<a class="sourceLine" id="cb491-21" data-line-number="21"><span class="co">#&gt; F-statistic: 5.49 on 1 and 320 DF,  p-value: 0.0197</span></a>
<a class="sourceLine" id="cb491-22" data-line-number="22"><span class="kw">tidy</span>(fit_women)</a>
<a class="sourceLine" id="cb491-23" data-line-number="23"><span class="co">#&gt;          term estimate std.error statistic  p.value</span></a>
<a class="sourceLine" id="cb491-24" data-line-number="24"><span class="co">#&gt; 1 (Intercept)    14.74      2.29      6.45 4.22e-10</span></a>
<a class="sourceLine" id="cb491-25" data-line-number="25"><span class="co">#&gt; 2    reserved     9.25      3.95      2.34 1.97e-02</span></a></code></pre></div>
<p>You need to set <code>conf.int = TRUE</code> for <a href="https://www.rdocumentation.org/packages/broom/topics/tidy.lm">tidy</a> to include the confidence interval:</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb492-1" data-line-number="1"><span class="kw">summary</span>(fit_minwage)</a>
<a class="sourceLine" id="cb492-2" data-line-number="2"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb492-3" data-line-number="3"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb492-4" data-line-number="4"><span class="co">#&gt; lm(formula = fullPropAfter ~ -1 + NJ + fullPropBefore + wageBefore + </span></a>
<a class="sourceLine" id="cb492-5" data-line-number="5"><span class="co">#&gt;     chain, data = minwage)</span></a>
<a class="sourceLine" id="cb492-6" data-line-number="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb492-7" data-line-number="7"><span class="co">#&gt; Residuals:</span></a>
<a class="sourceLine" id="cb492-8" data-line-number="8"><span class="co">#&gt;     Min      1Q  Median      3Q     Max </span></a>
<a class="sourceLine" id="cb492-9" data-line-number="9"><span class="co">#&gt; -0.4862 -0.1813 -0.0281  0.1513  0.7509 </span></a>
<a class="sourceLine" id="cb492-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb492-11" data-line-number="11"><span class="co">#&gt; Coefficients:</span></a>
<a class="sourceLine" id="cb492-12" data-line-number="12"><span class="co">#&gt;                 Estimate Std. Error t value Pr(&gt;|t|)   </span></a>
<a class="sourceLine" id="cb492-13" data-line-number="13"><span class="co">#&gt; NJ               -0.0542     0.0332   -1.63   0.1034   </span></a>
<a class="sourceLine" id="cb492-14" data-line-number="14"><span class="co">#&gt; fullPropBefore    0.1688     0.0566    2.98   0.0031 **</span></a>
<a class="sourceLine" id="cb492-15" data-line-number="15"><span class="co">#&gt; wageBefore        0.0813     0.0389    2.09   0.0374 * </span></a>
<a class="sourceLine" id="cb492-16" data-line-number="16"><span class="co">#&gt; chainburgerking  -0.0614     0.1755   -0.35   0.7266   </span></a>
<a class="sourceLine" id="cb492-17" data-line-number="17"><span class="co">#&gt; chainkfc         -0.0966     0.1793   -0.54   0.5904   </span></a>
<a class="sourceLine" id="cb492-18" data-line-number="18"><span class="co">#&gt; chainroys        -0.1522     0.1832   -0.83   0.4066   </span></a>
<a class="sourceLine" id="cb492-19" data-line-number="19"><span class="co">#&gt; chainwendys      -0.1659     0.1853   -0.90   0.3711   </span></a>
<a class="sourceLine" id="cb492-20" data-line-number="20"><span class="co">#&gt; ---</span></a>
<a class="sourceLine" id="cb492-21" data-line-number="21"><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></a>
<a class="sourceLine" id="cb492-22" data-line-number="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb492-23" data-line-number="23"><span class="co">#&gt; Residual standard error: 0.244 on 351 degrees of freedom</span></a>
<a class="sourceLine" id="cb492-24" data-line-number="24"><span class="co">#&gt; Multiple R-squared:  0.635,  Adjusted R-squared:  0.628 </span></a>
<a class="sourceLine" id="cb492-25" data-line-number="25"><span class="co">#&gt; F-statistic: 87.2 on 7 and 351 DF,  p-value: &lt;2e-16</span></a>
<a class="sourceLine" id="cb492-26" data-line-number="26"><span class="kw">tidy</span>(fit_minwage, <span class="dt">conf.int =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb492-27" data-line-number="27"><span class="co">#&gt;              term estimate std.error statistic p.value conf.low conf.high</span></a>
<a class="sourceLine" id="cb492-28" data-line-number="28"><span class="co">#&gt; 1              NJ  -0.0542    0.0332    -1.633 0.10343 -0.11953    0.0111</span></a>
<a class="sourceLine" id="cb492-29" data-line-number="29"><span class="co">#&gt; 2  fullPropBefore   0.1688    0.0566     2.981 0.00307  0.05744    0.2801</span></a>
<a class="sourceLine" id="cb492-30" data-line-number="30"><span class="co">#&gt; 3      wageBefore   0.0813    0.0389     2.090 0.03737  0.00478    0.1579</span></a>
<a class="sourceLine" id="cb492-31" data-line-number="31"><span class="co">#&gt; 4 chainburgerking  -0.0614    0.1755    -0.350 0.72657 -0.40648    0.2837</span></a>
<a class="sourceLine" id="cb492-32" data-line-number="32"><span class="co">#&gt; 5        chainkfc  -0.0966    0.1793    -0.539 0.59044 -0.44919    0.2560</span></a>
<a class="sourceLine" id="cb492-33" data-line-number="33"><span class="co">#&gt; 6       chainroys  -0.1522    0.1832    -0.831 0.40664 -0.51238    0.2080</span></a>
<a class="sourceLine" id="cb492-34" data-line-number="34"><span class="co">#&gt; 7     chainwendys  -0.1659    0.1853    -0.895 0.37115 -0.53031    0.1985</span></a></code></pre></div>
</div>
<div id="inference-about-predictions" class="section level3">
<h3><span class="header-section-number">7.3.3</span> Inference about predictions</h3>
<div class="sourceCode" id="cb493"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb493-1" data-line-number="1"><span class="kw">data</span>(<span class="st">&quot;MPs&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;qss&quot;</span>)</a>
<a class="sourceLine" id="cb493-2" data-line-number="2">MPs_labour &lt;-<span class="st"> </span><span class="kw">filter</span>(MPs, party <span class="op">==</span><span class="st"> &quot;labour&quot;</span>)</a>
<a class="sourceLine" id="cb493-3" data-line-number="3">MPs_tory &lt;-<span class="st"> </span><span class="kw">filter</span>(MPs, party <span class="op">==</span><span class="st"> &quot;tory&quot;</span>)</a>
<a class="sourceLine" id="cb493-4" data-line-number="4">labour_fit1 &lt;-<span class="st"> </span><span class="kw">lm</span>(ln.net <span class="op">~</span><span class="st"> </span>margin, <span class="dt">data =</span> <span class="kw">filter</span>(MPs_labour, margin <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>))</a>
<a class="sourceLine" id="cb493-5" data-line-number="5">labour_fit2 &lt;-<span class="st"> </span><span class="kw">lm</span>(ln.net <span class="op">~</span><span class="st"> </span>margin, <span class="dt">data =</span> <span class="kw">filter</span>(MPs_labour, margin <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>))</a>
<a class="sourceLine" id="cb493-6" data-line-number="6">tory_fit1 &lt;-<span class="st"> </span><span class="kw">lm</span>(ln.net <span class="op">~</span><span class="st"> </span>margin, <span class="dt">data =</span> <span class="kw">filter</span>(MPs_tory, margin <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>))</a>
<a class="sourceLine" id="cb493-7" data-line-number="7">tory_fit2 &lt;-<span class="st"> </span><span class="kw">lm</span>(ln.net <span class="op">~</span><span class="st"> </span>margin, <span class="dt">data =</span> <span class="kw">filter</span>(MPs_tory, margin <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>))</a></code></pre></div>
<p>Predictions at the threshold.
The <a href="https://cran.r-project.org/package=broom">broom</a> function <a href="https://www.rdocumentation.org/packages/broom/topics/augment">augment</a> will return prediction fitted values and standard errors for each value, but not the confidence intervals themselves (we’d have to multiply the correct t-distribution with degrees of freedom.)
So instead, we’ll directly use the <a href="https://www.rdocumentation.org/packages/stats/topics/predict.lm">predict</a> function:</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb494-1" data-line-number="1">tory_y0 &lt;-</a>
<a class="sourceLine" id="cb494-2" data-line-number="2"><span class="st">  </span><span class="kw">predict</span>(tory_fit1, <span class="dt">interval =</span> <span class="st">&quot;confidence&quot;</span>,</a>
<a class="sourceLine" id="cb494-3" data-line-number="3">          <span class="dt">newdata =</span> <span class="kw">tibble</span>(<span class="dt">margin =</span> <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>()</a>
<a class="sourceLine" id="cb494-4" data-line-number="4">tory_y0</a>
<a class="sourceLine" id="cb494-5" data-line-number="5"><span class="co">#&gt; # A tibble: 1 x 3</span></a>
<a class="sourceLine" id="cb494-6" data-line-number="6"><span class="co">#&gt;     fit   lwr   upr</span></a>
<a class="sourceLine" id="cb494-7" data-line-number="7"><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb494-8" data-line-number="8"><span class="co">#&gt; 1  12.5  12.1  13.0</span></a>
<a class="sourceLine" id="cb494-9" data-line-number="9">tory_y1 &lt;-</a>
<a class="sourceLine" id="cb494-10" data-line-number="10"><span class="st">  </span><span class="kw">predict</span>(tory_fit2, <span class="dt">interval =</span> <span class="st">&quot;confidence&quot;</span>,</a>
<a class="sourceLine" id="cb494-11" data-line-number="11">          <span class="dt">newdata =</span> <span class="kw">tibble</span>(<span class="dt">margin =</span> <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_tibble</span>()</a>
<a class="sourceLine" id="cb494-12" data-line-number="12">tory_y1</a>
<a class="sourceLine" id="cb494-13" data-line-number="13"><span class="co">#&gt; # A tibble: 1 x 3</span></a>
<a class="sourceLine" id="cb494-14" data-line-number="14"><span class="co">#&gt;     fit   lwr   upr</span></a>
<a class="sourceLine" id="cb494-15" data-line-number="15"><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></a>
<a class="sourceLine" id="cb494-16" data-line-number="16"><span class="co">#&gt; 1  13.2  12.8  13.6</span></a></code></pre></div>
<p>Alternatively, using <code>augment</code> (and assuming a normal distribution since the number of observations is so large its not worth worrying about the t-distribution):</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb495-1" data-line-number="1">tory_y0 &lt;-</a>
<a class="sourceLine" id="cb495-2" data-line-number="2"><span class="st">  </span><span class="kw">augment</span>(tory_fit1, <span class="dt">newdata =</span> <span class="kw">tibble</span>(<span class="dt">margin =</span> <span class="dv">0</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb495-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lwr =</span> .fitted <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.025</span>) <span class="op">*</span><span class="st"> </span>.se.fit,</a>
<a class="sourceLine" id="cb495-4" data-line-number="4">         <span class="dt">upr =</span> .fitted <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.975</span>) <span class="op">*</span><span class="st"> </span>.se.fit)</a>
<a class="sourceLine" id="cb495-5" data-line-number="5">tory_y0</a>
<a class="sourceLine" id="cb495-6" data-line-number="6"><span class="co">#&gt;   margin .fitted .se.fit  lwr upr</span></a>
<a class="sourceLine" id="cb495-7" data-line-number="7"><span class="co">#&gt; 1      0    12.5   0.214 12.1  13</span></a>
<a class="sourceLine" id="cb495-8" data-line-number="8">tory_y1 &lt;-</a>
<a class="sourceLine" id="cb495-9" data-line-number="9"><span class="st">  </span><span class="kw">augment</span>(tory_fit2, <span class="dt">newdata =</span> <span class="kw">tibble</span>(<span class="dt">margin =</span> <span class="dv">0</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb495-10" data-line-number="10"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">lwr =</span> .fitted <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.025</span>) <span class="op">*</span><span class="st"> </span>.se.fit,</a>
<a class="sourceLine" id="cb495-11" data-line-number="11">         <span class="dt">upr =</span> .fitted <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.975</span>) <span class="op">*</span><span class="st"> </span>.se.fit)</a>
<a class="sourceLine" id="cb495-12" data-line-number="12">tory_y1</a>
<a class="sourceLine" id="cb495-13" data-line-number="13"><span class="co">#&gt;   margin .fitted .se.fit  lwr  upr</span></a>
<a class="sourceLine" id="cb495-14" data-line-number="14"><span class="co">#&gt; 1      0    13.2   0.192 12.8 13.6</span></a></code></pre></div>
<div class="sourceCode" id="cb496"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb496-1" data-line-number="1">y1_range &lt;-<span class="st"> </span><span class="kw">data_grid</span>(<span class="kw">filter</span>(MPs_tory, margin <span class="op">&lt;=</span><span class="st"> </span><span class="dv">0</span>), margin)</a>
<a class="sourceLine" id="cb496-2" data-line-number="2">tory_y0 &lt;-<span class="st"> </span><span class="kw">augment</span>(tory_fit1, <span class="dt">newdata =</span> y1_range)</a>
<a class="sourceLine" id="cb496-3" data-line-number="3">y2_range &lt;-<span class="st"> </span><span class="kw">data_grid</span>(<span class="kw">filter</span>(MPs_tory, margin <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span>), margin)</a>
<a class="sourceLine" id="cb496-4" data-line-number="4">tory_y1 &lt;-<span class="st"> </span><span class="kw">augment</span>(tory_fit2, <span class="dt">newdata =</span> y2_range)</a></code></pre></div>
<div class="sourceCode" id="cb497"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb497-1" data-line-number="1"><span class="kw">ggplot</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb497-2" data-line-number="2"><span class="st">  </span><span class="kw">geom_ref_line</span>(<span class="dt">v =</span> <span class="dv">0</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb497-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">y =</span> ln.net, <span class="dt">x =</span> margin), <span class="dt">data =</span> MPs_tory) <span class="op">+</span></a>
<a class="sourceLine" id="cb497-4" data-line-number="4"><span class="st">  </span><span class="co"># plot losers</span></a>
<a class="sourceLine" id="cb497-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> margin,</a>
<a class="sourceLine" id="cb497-6" data-line-number="6">                  <span class="dt">ymin =</span> .fitted <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.025</span>) <span class="op">*</span><span class="st"> </span>.se.fit,</a>
<a class="sourceLine" id="cb497-7" data-line-number="7">                  <span class="dt">ymax =</span> .fitted <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.975</span>) <span class="op">*</span><span class="st"> </span>.se.fit),</a>
<a class="sourceLine" id="cb497-8" data-line-number="8">              <span class="dt">data =</span> tory_y0, <span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb497-9" data-line-number="9"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> margin, <span class="dt">y =</span> .fitted), <span class="dt">data =</span> tory_y0) <span class="op">+</span></a>
<a class="sourceLine" id="cb497-10" data-line-number="10"><span class="st">  </span><span class="co"># plot winners</span></a>
<a class="sourceLine" id="cb497-11" data-line-number="11"><span class="st">  </span><span class="kw">geom_ribbon</span>(<span class="kw">aes</span>(<span class="dt">x =</span> margin,</a>
<a class="sourceLine" id="cb497-12" data-line-number="12">                  <span class="dt">ymin =</span> .fitted <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.025</span>) <span class="op">*</span><span class="st"> </span>.se.fit,</a>
<a class="sourceLine" id="cb497-13" data-line-number="13">                  <span class="dt">ymax =</span> .fitted <span class="op">+</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.975</span>) <span class="op">*</span><span class="st"> </span>.se.fit),</a>
<a class="sourceLine" id="cb497-14" data-line-number="14">              <span class="dt">data =</span> tory_y1, <span class="dt">alpha =</span> <span class="fl">0.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb497-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">x =</span> margin, <span class="dt">y =</span> .fitted), <span class="dt">data =</span> tory_y1) <span class="op">+</span></a>
<a class="sourceLine" id="cb497-16" data-line-number="16"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">x =</span> <span class="st">&quot;Margin of vitory&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;log net wealth&quot;</span>)</a></code></pre></div>
<p><img src="uncertainty_files/figure-html/unnamed-chunk-81-1.png" width="70%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb498"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb498-1" data-line-number="1">tory_y1 &lt;-<span class="st"> </span><span class="kw">augment</span>(tory_fit1, <span class="dt">newdata =</span> <span class="kw">tibble</span>(<span class="dt">margin =</span> <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb498-2" data-line-number="2">tory_y1</a>
<a class="sourceLine" id="cb498-3" data-line-number="3"><span class="co">#&gt;   margin .fitted .se.fit</span></a>
<a class="sourceLine" id="cb498-4" data-line-number="4"><span class="co">#&gt; 1      0    12.5   0.214</span></a>
<a class="sourceLine" id="cb498-5" data-line-number="5">tory_y0 &lt;-<span class="st"> </span><span class="kw">augment</span>(tory_fit2, <span class="dt">newdata =</span> <span class="kw">tibble</span>(<span class="dt">margin =</span> <span class="dv">0</span>))</a>
<a class="sourceLine" id="cb498-6" data-line-number="6">tory_y0</a>
<a class="sourceLine" id="cb498-7" data-line-number="7"><span class="co">#&gt;   margin .fitted .se.fit</span></a>
<a class="sourceLine" id="cb498-8" data-line-number="8"><span class="co">#&gt; 1      0    13.2   0.192</span></a>
<a class="sourceLine" id="cb498-9" data-line-number="9"><span class="kw">summary</span>(tory_fit1)</a>
<a class="sourceLine" id="cb498-10" data-line-number="10"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb498-11" data-line-number="11"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb498-12" data-line-number="12"><span class="co">#&gt; lm(formula = ln.net ~ margin, data = filter(MPs_tory, margin &lt; </span></a>
<a class="sourceLine" id="cb498-13" data-line-number="13"><span class="co">#&gt;     0))</span></a>
<a class="sourceLine" id="cb498-14" data-line-number="14"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb498-15" data-line-number="15"><span class="co">#&gt; Residuals:</span></a>
<a class="sourceLine" id="cb498-16" data-line-number="16"><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></a>
<a class="sourceLine" id="cb498-17" data-line-number="17"><span class="co">#&gt; -5.320 -0.472 -0.035  0.663  3.580 </span></a>
<a class="sourceLine" id="cb498-18" data-line-number="18"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb498-19" data-line-number="19"><span class="co">#&gt; Coefficients:</span></a>
<a class="sourceLine" id="cb498-20" data-line-number="20"><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></a>
<a class="sourceLine" id="cb498-21" data-line-number="21"><span class="co">#&gt; (Intercept)   12.538      0.214   58.54   &lt;2e-16 ***</span></a>
<a class="sourceLine" id="cb498-22" data-line-number="22"><span class="co">#&gt; margin         1.491      1.291    1.15     0.25    </span></a>
<a class="sourceLine" id="cb498-23" data-line-number="23"><span class="co">#&gt; ---</span></a>
<a class="sourceLine" id="cb498-24" data-line-number="24"><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></a>
<a class="sourceLine" id="cb498-25" data-line-number="25"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb498-26" data-line-number="26"><span class="co">#&gt; Residual standard error: 1.43 on 119 degrees of freedom</span></a>
<a class="sourceLine" id="cb498-27" data-line-number="27"><span class="co">#&gt; Multiple R-squared:  0.0111, Adjusted R-squared:  0.00277 </span></a>
<a class="sourceLine" id="cb498-28" data-line-number="28"><span class="co">#&gt; F-statistic: 1.33 on 1 and 119 DF,  p-value: 0.251</span></a>
<a class="sourceLine" id="cb498-29" data-line-number="29"><span class="kw">summary</span>(tory_fit2)</a>
<a class="sourceLine" id="cb498-30" data-line-number="30"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb498-31" data-line-number="31"><span class="co">#&gt; Call:</span></a>
<a class="sourceLine" id="cb498-32" data-line-number="32"><span class="co">#&gt; lm(formula = ln.net ~ margin, data = filter(MPs_tory, margin &gt; </span></a>
<a class="sourceLine" id="cb498-33" data-line-number="33"><span class="co">#&gt;     0))</span></a>
<a class="sourceLine" id="cb498-34" data-line-number="34"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb498-35" data-line-number="35"><span class="co">#&gt; Residuals:</span></a>
<a class="sourceLine" id="cb498-36" data-line-number="36"><span class="co">#&gt;    Min     1Q Median     3Q    Max </span></a>
<a class="sourceLine" id="cb498-37" data-line-number="37"><span class="co">#&gt; -3.858 -0.877  0.001  0.830  3.126 </span></a>
<a class="sourceLine" id="cb498-38" data-line-number="38"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb498-39" data-line-number="39"><span class="co">#&gt; Coefficients:</span></a>
<a class="sourceLine" id="cb498-40" data-line-number="40"><span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)    </span></a>
<a class="sourceLine" id="cb498-41" data-line-number="41"><span class="co">#&gt; (Intercept)   13.188      0.192   68.69   &lt;2e-16 ***</span></a>
<a class="sourceLine" id="cb498-42" data-line-number="42"><span class="co">#&gt; margin        -0.728      1.982   -0.37     0.71    </span></a>
<a class="sourceLine" id="cb498-43" data-line-number="43"><span class="co">#&gt; ---</span></a>
<a class="sourceLine" id="cb498-44" data-line-number="44"><span class="co">#&gt; Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></a>
<a class="sourceLine" id="cb498-45" data-line-number="45"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb498-46" data-line-number="46"><span class="co">#&gt; Residual standard error: 1.29 on 100 degrees of freedom</span></a>
<a class="sourceLine" id="cb498-47" data-line-number="47"><span class="co">#&gt; Multiple R-squared:  0.00135,    Adjusted R-squared:  -0.00864 </span></a>
<a class="sourceLine" id="cb498-48" data-line-number="48"><span class="co">#&gt; F-statistic: 0.135 on 1 and 100 DF,  p-value: 0.714</span></a></code></pre></div>
<p>Since we aren’t doing anything more with these values, there isn’t much benefit in keeping them in data frames.</p>
<div class="sourceCode" id="cb499"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb499-1" data-line-number="1"><span class="co"># standard error</span></a>
<a class="sourceLine" id="cb499-2" data-line-number="2">se_diff &lt;-<span class="st"> </span><span class="kw">sqrt</span>(tory_y0<span class="op">$</span>.se.fit <span class="op">^</span><span class="st"> </span><span class="dv">2</span> <span class="op">+</span><span class="st"> </span>tory_y1<span class="op">$</span>.se.fit <span class="op">^</span><span class="st"> </span><span class="dv">2</span>)</a>
<a class="sourceLine" id="cb499-3" data-line-number="3">se_diff</a>
<a class="sourceLine" id="cb499-4" data-line-number="4"><span class="co">#&gt; [1] 0.288</span></a>
<a class="sourceLine" id="cb499-5" data-line-number="5"><span class="co"># point estimate</span></a>
<a class="sourceLine" id="cb499-6" data-line-number="6">diff_est &lt;-<span class="st"> </span>tory_y1<span class="op">$</span>.fitted <span class="op">-</span><span class="st"> </span>tory_y0<span class="op">$</span>.fitted</a>
<a class="sourceLine" id="cb499-7" data-line-number="7">diff_est</a>
<a class="sourceLine" id="cb499-8" data-line-number="8"><span class="co">#&gt; [1] -0.65</span></a>
<a class="sourceLine" id="cb499-9" data-line-number="9"><span class="co"># confidence interval</span></a>
<a class="sourceLine" id="cb499-10" data-line-number="10">CI &lt;-<span class="st"> </span><span class="kw">c</span>(diff_est <span class="op">-</span><span class="st"> </span>se_diff <span class="op">*</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.975</span>),</a>
<a class="sourceLine" id="cb499-11" data-line-number="11">        diff_est <span class="op">+</span><span class="st"> </span>se_diff <span class="op">*</span><span class="st"> </span><span class="kw">qnorm</span>(<span class="fl">0.975</span>))</a>
<a class="sourceLine" id="cb499-12" data-line-number="12">CI</a>
<a class="sourceLine" id="cb499-13" data-line-number="13"><span class="co">#&gt; [1] -1.2134 -0.0859</span></a>
<a class="sourceLine" id="cb499-14" data-line-number="14"><span class="co"># hypothesis test</span></a>
<a class="sourceLine" id="cb499-15" data-line-number="15">z_score &lt;-<span class="st"> </span>diff_est <span class="op">/</span><span class="st"> </span>se_diff</a>
<a class="sourceLine" id="cb499-16" data-line-number="16"><span class="co"># two sided p value</span></a>
<a class="sourceLine" id="cb499-17" data-line-number="17">p_value &lt;-<span class="st"> </span><span class="dv">2</span> <span class="op">*</span><span class="st"> </span><span class="kw">pnorm</span>(<span class="kw">abs</span>(z_score), <span class="dt">lower.tail =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb499-18" data-line-number="18">p_value</a>
<a class="sourceLine" id="cb499-19" data-line-number="19"><span class="co">#&gt; [1] 0.0239</span></a></code></pre></div>

</div>
</div>
</div>







            </section>

          </div>
        </div>
      </div>
<a href="probability.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/jrnold/qss-tidy/edit/master/uncertainty.Rmd",
"text": "Edit"
},
"download": ["qss-tidy.pdf"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
